<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>고급 훈련 페이스 계산기 - 모바일 | Athlete Time</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', '맑은 고딕', sans-serif;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .gradient-text {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .training-zone-easy { background: linear-gradient(135deg, #10b981, #059669); }
    .training-zone-marathon { background: linear-gradient(135deg, #3b82f6, #2563eb); }
    .training-zone-threshold { background: linear-gradient(135deg, #f59e0b, #d97706); }
    .training-zone-interval { background: linear-gradient(135deg, #ef4444, #dc2626); }
    .training-zone-repetition { background: linear-gradient(135deg, #a855f7, #9333ea); }
    
    .zone-card {
      transition: all 0.3s ease;
    }
    
    .zone-card:active {
      transform: scale(0.98);
    }
    
    .checkbox-custom {
      width: 24px;
      height: 24px;
      accent-color: #9333ea;
    }
    
    .radio-custom {
      width: 24px;
      height: 24px;
      accent-color: #9333ea;
    }
    
    @keyframes slideIn {
      from {
        transform: translateY(20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    .slide-in {
      animation: slideIn 0.5s ease;
    }
    
    .training-day {
      transition: all 0.3s ease;
    }
    
    .high-intensity {
      border-left: 4px solid #ef4444;
      background: linear-gradient(to right, rgba(239, 68, 68, 0.1), transparent);
    }
    
    .medium-intensity {
      border-left: 4px solid #3b82f6;
      background: linear-gradient(to right, rgba(59, 130, 246, 0.1), transparent);
    }
    
    .low-intensity {
      border-left: 4px solid #10b981;
      background: linear-gradient(to right, rgba(16, 185, 129, 0.1), transparent);
    }
    
    .rest-day {
      border-left: 4px solid #6b7280;
      background: linear-gradient(to right, rgba(107, 114, 128, 0.1), transparent);
    }
    
    /* Mobile specific adjustments */
    input[type="number"], input[type="text"], select {
      font-size: 16px !important; /* Prevent zoom on iOS */
    }
    
    .step-indicator {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .step-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #e5e7eb;
      transition: all 0.3s ease;
    }
    
    .step-dot.active {
      background: #9333ea;
      transform: scale(1.2);
    }
    
    .step-line {
      flex: 1;
      height: 2px;
      background: #e5e7eb;
      margin: 0 5px;
    }
    
    .step-line.active {
      background: #9333ea;
    }
  </style>
</head>
<body class="bg-gray-50">
  <div class="min-h-screen">
    <!-- Header -->
    <div class="gradient-bg text-white p-3 sticky top-0 z-50">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-lg font-bold">고급 훈련 계산기</h1>
          <p class="text-xs opacity-90">개인 맞춤형 훈련 계획</p>
        </div>
        <button onclick="window.location.href='index.html'" class="p-2">
          <i class="fas fa-home text-xl"></i>
        </button>
      </div>
    </div>

    <!-- Step Indicator -->
    <div class="bg-white px-4 py-3 shadow-sm">
      <div class="step-indicator">
        <div class="step-dot active" id="step1-dot"></div>
        <div class="step-line" id="step1-line"></div>
        <div class="step-dot" id="step2-dot"></div>
        <div class="step-line" id="step2-line"></div>
        <div class="step-dot" id="step3-dot"></div>
      </div>
      <div class="flex justify-between text-xs text-gray-600 mt-1">
        <span>기본정보</span>
        <span>훈련설정</span>
        <span>상태체크</span>
      </div>
    </div>

    <!-- Main Content -->
    <div class="p-4 pb-20">
      <!-- Step 1: Basic Information -->
      <div id="step1" class="profile-section">
        <div class="bg-white rounded-lg shadow p-4 mb-4">
          <h2 class="text-lg font-bold mb-3 flex items-center">
            <i class="fas fa-user-circle mr-2 text-purple-600"></i>
            기본 정보 입력
          </h2>
          
          <!-- Gender Selection -->
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">성별</label>
            <div class="grid grid-cols-2 gap-2">
              <button onclick="selectGender('male')" id="male-btn" 
                class="p-3 border-2 rounded-lg transition-all text-center">
                <i class="fas fa-mars text-xl mb-1 text-blue-500"></i>
                <div class="text-sm">남성</div>
              </button>
              <button onclick="selectGender('female')" id="female-btn"
                class="p-3 border-2 rounded-lg transition-all text-center">
                <i class="fas fa-venus text-xl mb-1 text-pink-500"></i>
                <div class="text-sm">여성</div>
              </button>
            </div>
          </div>

          <!-- Base Record Input -->
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">
              <i class="fas fa-stopwatch mr-1 text-purple-600"></i>
              기준 기록 입력
            </label>
            <select id="eventSelect" class="w-full p-3 border rounded-lg mb-2 text-base">
              <option value="">종목 선택</option>
              <option value="800m">800m</option>
              <option value="1500m">1500m</option>
              <option value="3000m">3000m</option>
              <option value="5000m">5000m</option>
              <option value="10000m">10000m</option>
              <option value="half">하프마라톤</option>
              <option value="full">풀마라톤</option>
            </select>
            
            <div class="grid grid-cols-3 gap-2">
              <input type="number" id="hours" placeholder="시" min="0" max="23" 
                class="p-3 border rounded-lg text-center text-base">
              <input type="number" id="minutes" placeholder="분" min="0" max="59" 
                class="p-3 border rounded-lg text-center text-base">
              <input type="number" id="seconds" placeholder="초" min="0" max="59" 
                class="p-3 border rounded-lg text-center text-base">
            </div>
          </div>

          <button onclick="goToStep2()" 
            class="w-full bg-purple-600 text-white py-3 rounded-lg font-medium active:bg-purple-700">
            다음 단계 <i class="fas fa-arrow-right ml-2"></i>
          </button>
        </div>
      </div>

      <!-- Step 2: Training Settings -->
      <div id="step2" class="profile-section hidden">
        <div class="bg-white rounded-lg shadow p-4 mb-4">
          <h2 class="text-lg font-bold mb-3 flex items-center">
            <i class="fas fa-dumbbell mr-2 text-purple-600"></i>
            훈련 설정
          </h2>

          <!-- Training Frequency -->
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">훈련 빈도</label>
            <div class="grid grid-cols-2 gap-2">
              <button onclick="selectFrequency('1x')" id="freq-1x-btn"
                class="p-3 border-2 rounded-lg transition-all text-center">
                <i class="fas fa-calendar-day text-xl mb-1 text-green-500"></i>
                <div class="text-sm font-medium">1일 1회</div>
                <div class="text-xs text-gray-600">기본 훈련</div>
              </button>
              <button onclick="selectFrequency('2x')" id="freq-2x-btn"
                class="p-3 border-2 rounded-lg transition-all text-center">
                <i class="fas fa-calendar-week text-xl mb-1 text-blue-500"></i>
                <div class="text-sm font-medium">1일 2회</div>
                <div class="text-xs text-gray-600">집중 훈련</div>
              </button>
            </div>
          </div>

          <!-- Training Intensity -->
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">훈련 강도</label>
            <div class="space-y-2">
              <button onclick="selectIntensity('beginner')" id="intensity-beginner-btn"
                class="w-full p-3 border-2 rounded-lg transition-all text-left flex items-center">
                <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-3">
                  <span class="text-green-600 font-bold">초</span>
                </div>
                <div>
                  <div class="font-medium">초급</div>
                  <div class="text-xs text-gray-600">훈련 경력 1년 미만</div>
                </div>
              </button>
              
              <button onclick="selectIntensity('intermediate')" id="intensity-intermediate-btn"
                class="w-full p-3 border-2 rounded-lg transition-all text-left flex items-center">
                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                  <span class="text-blue-600 font-bold">중</span>
                </div>
                <div>
                  <div class="font-medium">중급</div>
                  <div class="text-xs text-gray-600">훈련 경력 1-3년</div>
                </div>
              </button>
              
              <button onclick="selectIntensity('advanced')" id="intensity-advanced-btn"
                class="w-full p-3 border-2 rounded-lg transition-all text-left flex items-center">
                <div class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center mr-3">
                  <span class="text-red-600 font-bold">고</span>
                </div>
                <div>
                  <div class="font-medium">고급</div>
                  <div class="text-xs text-gray-600">훈련 경력 3년 이상</div>
                </div>
              </button>
            </div>
          </div>

          <div class="flex gap-2">
            <button onclick="goToStep1()" 
              class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-medium">
              <i class="fas fa-arrow-left mr-2"></i> 이전
            </button>
            <button onclick="goToStep3()" 
              class="flex-1 bg-purple-600 text-white py-3 rounded-lg font-medium">
              다음 <i class="fas fa-arrow-right ml-2"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Step 3: Condition Checklist -->
      <div id="step3" class="profile-section hidden">
        <div class="bg-white rounded-lg shadow p-4 mb-4">
          <h2 class="text-lg font-bold mb-3 flex items-center">
            <i class="fas fa-clipboard-check mr-2 text-purple-600"></i>
            현재 상태 체크
          </h2>
          
          <p class="text-sm text-gray-600 mb-3">해당되는 항목을 모두 선택하세요</p>

          <div class="space-y-2 mb-4">
            <label class="flex items-center p-3 bg-gray-50 rounded-lg">
              <input type="checkbox" id="injury-recovery" class="checkbox-custom mr-3">
              <div>
                <div class="font-medium">부상 회복 중</div>
                <div class="text-xs text-gray-600">강도 30% 감소</div>
              </div>
            </label>

            <label class="flex items-center p-3 bg-gray-50 rounded-lg">
              <input type="checkbox" id="high-fatigue" class="checkbox-custom mr-3">
              <div>
                <div class="font-medium">높은 피로도</div>
                <div class="text-xs text-gray-600">회복 시간 증가</div>
              </div>
            </label>

            <label class="flex items-center p-3 bg-gray-50 rounded-lg">
              <input type="checkbox" id="competition-prep" class="checkbox-custom mr-3">
              <div>
                <div class="font-medium">대회 준비 (4주 이내)</div>
                <div class="text-xs text-gray-600">테이퍼링 적용</div>
              </div>
            </label>

            <label class="flex items-center p-3 bg-gray-50 rounded-lg">
              <input type="checkbox" id="off-season" class="checkbox-custom mr-3">
              <div>
                <div class="font-medium">비시즌 기간</div>
                <div class="text-xs text-gray-600">기초 체력 중심</div>
              </div>
            </label>

            <label class="flex items-center p-3 bg-gray-50 rounded-lg">
              <input type="checkbox" id="altitude-training" class="checkbox-custom mr-3">
              <div>
                <div class="font-medium">고지대 훈련</div>
                <div class="text-xs text-gray-600">강도 조절 필요</div>
              </div>
            </label>

            <label class="flex items-center p-3 bg-gray-50 rounded-lg">
              <input type="checkbox" id="hot-weather" class="checkbox-custom mr-3">
              <div>
                <div class="font-medium">더운 날씨 (30°C+)</div>
                <div class="text-xs text-gray-600">페이스 조절</div>
              </div>
            </label>

            <label class="flex items-center p-3 bg-gray-50 rounded-lg">
              <input type="checkbox" id="time-constraint" class="checkbox-custom mr-3">
              <div>
                <div class="font-medium">시간 제약</div>
                <div class="text-xs text-gray-600">효율적 훈련</div>
              </div>
            </label>

            <label class="flex items-center p-3 bg-gray-50 rounded-lg">
              <input type="checkbox" id="muscle-soreness" class="checkbox-custom mr-3">
              <div>
                <div class="font-medium">근육통</div>
                <div class="text-xs text-gray-600">회복 운동 추가</div>
              </div>
            </label>

            <label class="flex items-center p-3 bg-gray-50 rounded-lg">
              <input type="checkbox" id="stress" class="checkbox-custom mr-3">
              <div>
                <div class="font-medium">스트레스/수면 부족</div>
                <div class="text-xs text-gray-600">강도 20% 감소</div>
              </div>
            </label>

            <label class="flex items-center p-3 bg-gray-50 rounded-lg">
              <input type="checkbox" id="returning" class="checkbox-custom mr-3">
              <div>
                <div class="font-medium">훈련 복귀 (2주 이상 휴식)</div>
                <div class="text-xs text-gray-600">점진적 증가</div>
              </div>
            </label>

            <label class="flex items-center p-3 bg-gray-50 rounded-lg">
              <input type="checkbox" id="cross-training" class="checkbox-custom mr-3">
              <div>
                <div class="font-medium">크로스 트레이닝 병행</div>
                <div class="text-xs text-gray-600">달리기 볼륨 조절</div>
              </div>
            </label>
          </div>

          <div class="flex gap-2">
            <button onclick="goToStep2()" 
              class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-medium">
              <i class="fas fa-arrow-left mr-2"></i> 이전
            </button>
            <button onclick="generateTrainingPlan()" 
              class="flex-1 bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-lg font-medium">
              <i class="fas fa-calculator mr-2"></i> 계획 생성
            </button>
          </div>
        </div>
      </div>

      <!-- Results Section -->
      <div id="results" class="hidden">
        <!-- Profile Summary -->
        <div class="bg-white rounded-lg shadow p-4 mb-4">
          <h3 class="font-bold mb-2 text-sm">프로필 요약</h3>
          <div id="profileSummary" class="text-xs space-y-1"></div>
        </div>

        <!-- VDOT and Training Zones -->
        <div class="bg-white rounded-lg shadow p-4 mb-4">
          <h3 class="font-bold mb-2 text-sm">VDOT 및 훈련 구역</h3>
          <div id="vdotDisplay" class="text-2xl font-bold text-purple-600 mb-3"></div>
          
          <div id="trainingZones" class="space-y-2">
            <!-- Training zones will be inserted here -->
          </div>
        </div>

        <!-- 10-Day Training Cycle -->
        <div class="bg-white rounded-lg shadow p-4 mb-4">
          <h3 class="font-bold mb-3 text-sm">10일 훈련 주기</h3>
          <div id="trainingCycle" class="space-y-2">
            <!-- Training days will be inserted here -->
          </div>
        </div>

        <!-- Special Recommendations -->
        <div class="bg-white rounded-lg shadow p-4 mb-4">
          <h3 class="font-bold mb-2 text-sm flex items-center">
            <i class="fas fa-lightbulb mr-2 text-yellow-500"></i>
            맞춤 권장사항
          </h3>
          <div id="recommendations" class="text-xs space-y-2">
            <!-- Recommendations will be inserted here -->
          </div>
        </div>

        <!-- Reset Button -->
        <button onclick="resetCalculator()" 
          class="w-full bg-gray-200 text-gray-700 py-3 rounded-lg font-medium">
          <i class="fas fa-redo mr-2"></i> 다시 계산하기
        </button>
      </div>
    </div>

    <!-- Footer -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t px-4 py-2">
      <div class="text-center text-xs text-gray-600">
        <div>제작자: 장호준 코치</div>
        <div class="text-gray-400">© 2024 Athlete Time</div>
      </div>
    </div>
  </div>

  <script>
    // User profile object to store all selections
    let userProfile = {
      gender: null,
      frequency: null,
      intensity: null,
      baseRecord: {},
      vdot: 0,
      conditions: {},
      adjustments: {
        vdot: 1.0,
        volume: 1.0,
        intensity: 1.0
      }
    };

    // Navigation functions
    function goToStep1() {
      document.getElementById('step1').classList.remove('hidden');
      document.getElementById('step2').classList.add('hidden');
      document.getElementById('step3').classList.add('hidden');
      updateStepIndicator(1);
    }

    function goToStep2() {
      if (!validateStep1()) {
        alert('모든 필수 정보를 입력해주세요.');
        return;
      }
      document.getElementById('step1').classList.add('hidden');
      document.getElementById('step2').classList.remove('hidden');
      document.getElementById('step3').classList.add('hidden');
      updateStepIndicator(2);
    }

    function goToStep3() {
      if (!validateStep2()) {
        alert('훈련 빈도와 강도를 선택해주세요.');
        return;
      }
      document.getElementById('step1').classList.add('hidden');
      document.getElementById('step2').classList.add('hidden');
      document.getElementById('step3').classList.remove('hidden');
      updateStepIndicator(3);
    }

    function updateStepIndicator(step) {
      // Reset all
      document.querySelectorAll('.step-dot').forEach(dot => dot.classList.remove('active'));
      document.querySelectorAll('.step-line').forEach(line => line.classList.remove('active'));
      
      // Activate appropriate steps
      for (let i = 1; i <= step; i++) {
        document.getElementById(`step${i}-dot`).classList.add('active');
        if (i < step) {
          document.getElementById(`step${i}-line`).classList.add('active');
        }
      }
    }

    // Selection functions
    function selectGender(gender) {
      userProfile.gender = gender;
      
      // Update UI
      document.getElementById('male-btn').classList.remove('border-purple-600', 'bg-purple-50');
      document.getElementById('female-btn').classList.remove('border-purple-600', 'bg-purple-50');
      
      if (gender === 'male') {
        document.getElementById('male-btn').classList.add('border-purple-600', 'bg-purple-50');
      } else {
        document.getElementById('female-btn').classList.add('border-purple-600', 'bg-purple-50');
      }
    }

    function selectFrequency(freq) {
      userProfile.frequency = freq;
      
      // Update UI
      document.getElementById('freq-1x-btn').classList.remove('border-purple-600', 'bg-purple-50');
      document.getElementById('freq-2x-btn').classList.remove('border-purple-600', 'bg-purple-50');
      
      if (freq === '1x') {
        document.getElementById('freq-1x-btn').classList.add('border-purple-600', 'bg-purple-50');
      } else {
        document.getElementById('freq-2x-btn').classList.add('border-purple-600', 'bg-purple-50');
      }
    }

    function selectIntensity(intensity) {
      userProfile.intensity = intensity;
      
      // Update UI
      document.getElementById('intensity-beginner-btn').classList.remove('border-purple-600', 'bg-purple-50');
      document.getElementById('intensity-intermediate-btn').classList.remove('border-purple-600', 'bg-purple-50');
      document.getElementById('intensity-advanced-btn').classList.remove('border-purple-600', 'bg-purple-50');
      
      document.getElementById(`intensity-${intensity}-btn`).classList.add('border-purple-600', 'bg-purple-50');
    }

    // Validation functions
    function validateStep1() {
      if (!userProfile.gender) return false;
      
      const event = document.getElementById('eventSelect').value;
      const hours = parseInt(document.getElementById('hours').value) || 0;
      const minutes = parseInt(document.getElementById('minutes').value) || 0;
      const seconds = parseInt(document.getElementById('seconds').value) || 0;
      
      if (!event || (hours === 0 && minutes === 0 && seconds === 0)) {
        return false;
      }
      
      userProfile.baseRecord = {
        event: event,
        hours: hours,
        minutes: minutes,
        seconds: seconds,
        totalSeconds: hours * 3600 + minutes * 60 + seconds
      };
      
      return true;
    }

    function validateStep2() {
      return userProfile.frequency && userProfile.intensity;
    }

    // VDOT Calculation
    function calculateVDOT(event, timeInSeconds) {
      const distances = {
        '800m': 0.8,
        '1500m': 1.5,
        '3000m': 3,
        '5000m': 5,
        '10000m': 10,
        'half': 21.0975,
        'full': 42.195
      };
      
      const distance = distances[event];
      const timeInMinutes = timeInSeconds / 60;
      const velocity = (distance * 1000) / timeInMinutes;
      
      const percentMax = 0.8 + 0.1894393 * Math.exp(-0.012778 * timeInMinutes) + 
                        0.2989558 * Math.exp(-0.1932605 * timeInMinutes);
      const vo2 = -4.60 + 0.182258 * velocity + 0.000104 * velocity * velocity;
      const vdot = vo2 / percentMax;
      
      return Math.round(vdot * 10) / 10;
    }

    // Training pace calculation
    function calculateTrainingPaces(vdot) {
      const adjustedVdot = vdot * userProfile.adjustments.vdot;
      
      return {
        easy: calculatePaceForZone(adjustedVdot, 0.65),
        marathon: calculatePaceForZone(adjustedVdot, 0.75),
        threshold: calculatePaceForZone(adjustedVdot, 0.83),
        interval: calculatePaceForZone(adjustedVdot, 0.95),
        repetition: calculatePaceForZone(adjustedVdot, 1.05)
      };
    }

    function calculatePaceForZone(vdot, intensity) {
      const velocity = (vdot * intensity - 4.6) / 0.182258;
      const pacePerKm = 1000 / velocity;
      const minutes = Math.floor(pacePerKm);
      const seconds = Math.round((pacePerKm - minutes) * 60);
      return `${minutes}:${seconds.toString().padStart(2, '0')}`;
    }

    // Generate training plan
    function generateTrainingPlan() {
      // Collect conditions
      userProfile.conditions = {
        injuryRecovery: document.getElementById('injury-recovery').checked,
        highFatigue: document.getElementById('high-fatigue').checked,
        competitionPrep: document.getElementById('competition-prep').checked,
        offSeason: document.getElementById('off-season').checked,
        altitudeTraining: document.getElementById('altitude-training').checked,
        hotWeather: document.getElementById('hot-weather').checked,
        timeConstraint: document.getElementById('time-constraint').checked,
        muscleSoreness: document.getElementById('muscle-soreness').checked,
        stress: document.getElementById('stress').checked,
        returning: document.getElementById('returning').checked,
        crossTraining: document.getElementById('cross-training').checked
      };
      
      // Calculate adjustments
      calculateAdjustments();
      
      // Calculate VDOT
      userProfile.vdot = calculateVDOT(userProfile.baseRecord.event, userProfile.baseRecord.totalSeconds);
      
      // Display results
      displayResults();
    }

    function calculateAdjustments() {
      // Reset adjustments
      userProfile.adjustments = {
        vdot: 1.0,
        volume: 1.0,
        intensity: 1.0
      };
      
      // Gender adjustment
      if (userProfile.gender === 'female') {
        userProfile.adjustments.vdot *= 0.88;
      }
      
      // Intensity level adjustments
      if (userProfile.intensity === 'beginner') {
        userProfile.adjustments.volume *= 0.7;
        userProfile.adjustments.intensity *= 0.85;
      } else if (userProfile.intensity === 'intermediate') {
        userProfile.adjustments.volume *= 0.85;
        userProfile.adjustments.intensity *= 0.92;
      }
      
      // Condition-based adjustments
      if (userProfile.conditions.injuryRecovery) {
        userProfile.adjustments.intensity *= 0.7;
        userProfile.adjustments.volume *= 0.6;
      }
      
      if (userProfile.conditions.highFatigue) {
        userProfile.adjustments.intensity *= 0.85;
      }
      
      if (userProfile.conditions.stress) {
        userProfile.adjustments.intensity *= 0.8;
        userProfile.adjustments.volume *= 0.9;
      }
      
      if (userProfile.conditions.returning) {
        userProfile.adjustments.volume *= 0.5;
        userProfile.adjustments.intensity *= 0.75;
      }
      
      if (userProfile.conditions.hotWeather) {
        userProfile.adjustments.intensity *= 0.9;
      }
      
      if (userProfile.conditions.altitudeTraining) {
        userProfile.adjustments.intensity *= 0.85;
      }
    }

    function displayResults() {
      // Hide steps, show results
      document.getElementById('step3').classList.add('hidden');
      document.getElementById('results').classList.remove('hidden');
      
      // Display profile summary
      displayProfileSummary();
      
      // Display VDOT
      const adjustedVdot = Math.round(userProfile.vdot * userProfile.adjustments.vdot * 10) / 10;
      document.getElementById('vdotDisplay').innerHTML = `
        VDOT: ${adjustedVdot}
        ${userProfile.gender === 'female' ? '<span class="text-sm text-pink-500">(여성 보정)</span>' : ''}
      `;
      
      // Display training zones
      displayTrainingZones();
      
      // Display training cycle
      displayTrainingCycle();
      
      // Display recommendations
      displayRecommendations();
    }

    function displayProfileSummary() {
      const summaryHTML = `
        <div class="flex flex-wrap gap-2">
          <span class="px-2 py-1 bg-purple-100 text-purple-700 rounded">
            ${userProfile.gender === 'male' ? '남성' : '여성'}
          </span>
          <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded">
            ${userProfile.frequency === '1x' ? '1일 1회' : '1일 2회'}
          </span>
          <span class="px-2 py-1 bg-green-100 text-green-700 rounded">
            ${userProfile.intensity === 'beginner' ? '초급' : 
              userProfile.intensity === 'intermediate' ? '중급' : '고급'}
          </span>
          ${Object.entries(userProfile.conditions)
            .filter(([_, value]) => value)
            .map(([key, _]) => {
              const labels = {
                injuryRecovery: '부상회복',
                highFatigue: '피로누적',
                competitionPrep: '대회준비',
                offSeason: '비시즌',
                altitudeTraining: '고지대',
                hotWeather: '더운날씨',
                timeConstraint: '시간제약',
                muscleSoreness: '근육통',
                stress: '스트레스',
                returning: '훈련복귀',
                crossTraining: '크로스트레이닝'
              };
              return `<span class="px-2 py-1 bg-red-100 text-red-700 rounded">${labels[key]}</span>`;
            }).join('')}
        </div>
      `;
      document.getElementById('profileSummary').innerHTML = summaryHTML;
    }

    function displayTrainingZones() {
      const paces = calculateTrainingPaces(userProfile.vdot);
      const zones = [
        { name: 'Easy (E)', pace: paces.easy, color: 'training-zone-easy', icon: '🚶', description: '회복 및 기초 지구력' },
        { name: 'Marathon (M)', pace: paces.marathon, color: 'training-zone-marathon', icon: '🏃', description: '마라톤 페이스' },
        { name: 'Threshold (T)', pace: paces.threshold, color: 'training-zone-threshold', icon: '💪', description: '젖산 역치' },
        { name: 'Interval (I)', pace: paces.interval, color: 'training-zone-interval', icon: '⚡', description: 'VO2max 향상' },
        { name: 'Repetition (R)', pace: paces.repetition, color: 'training-zone-repetition', icon: '🚀', description: '스피드 및 폼' }
      ];
      
      const zonesHTML = zones.map(zone => `
        <div class="flex items-center justify-between p-2 rounded-lg ${zone.color} text-white">
          <div class="flex items-center">
            <span class="text-lg mr-2">${zone.icon}</span>
            <div>
              <div class="font-medium text-sm">${zone.name}</div>
              <div class="text-xs opacity-90">${zone.description}</div>
            </div>
          </div>
          <div class="text-lg font-bold">${zone.pace}/km</div>
        </div>
      `).join('');
      
      document.getElementById('trainingZones').innerHTML = zonesHTML;
    }

    function displayTrainingCycle() {
      const cycle = generate10DayCycle();
      const cycleHTML = cycle.map((day, index) => `
        <div class="training-day ${day.intensity} p-3 rounded-lg">
          <div class="flex justify-between items-start mb-1">
            <span class="font-bold text-sm">Day ${index + 1}</span>
            <span class="text-xs px-2 py-1 bg-white rounded">
              ${day.type}
            </span>
          </div>
          <div class="text-xs">
            ${day.description}
          </div>
          ${day.details ? `<div class="text-xs mt-1 opacity-80">${day.details}</div>` : ''}
        </div>
      `).join('');
      
      document.getElementById('trainingCycle').innerHTML = cycleHTML;
    }

    function generate10DayCycle() {
      let cycle = [];
      
      if (userProfile.frequency === '1x') {
        // Single session per day
        if (userProfile.intensity === 'beginner') {
          cycle = [
            { type: 'Easy', intensity: 'low-intensity', description: 'E pace 40-50분', details: '편안한 대화 가능한 속도' },
            { type: 'Threshold', intensity: 'medium-intensity', description: 'T pace 20분', details: '2x10분 (2분 휴식)' },
            { type: 'Easy', intensity: 'low-intensity', description: 'E pace 30-40분', details: '회복 조깅' },
            { type: 'Rest', intensity: 'rest-day', description: '완전 휴식 또는 가벼운 산책', details: '' },
            { type: 'Interval', intensity: 'high-intensity', description: 'I pace 15분', details: '5x3분 (3분 조깅 휴식)' },
            { type: 'Easy', intensity: 'low-intensity', description: 'E pace 30분', details: '회복 조깅' },
            { type: 'Long Run', intensity: 'low-intensity', description: 'E pace 60-70분', details: '주간 장거리' },
            { type: 'Rest', intensity: 'rest-day', description: '완전 휴식', details: '' },
            { type: 'Tempo', intensity: 'medium-intensity', description: 'M pace 30분', details: '지속 주행' },
            { type: 'Easy', intensity: 'low-intensity', description: 'E pace 30분', details: '회복 및 정리' }
          ];
        } else if (userProfile.intensity === 'intermediate') {
          cycle = [
            { type: 'Easy', intensity: 'low-intensity', description: 'E pace 50-60분', details: '기초 지구력' },
            { type: 'Threshold', intensity: 'medium-intensity', description: 'T pace 30분', details: '3x10분 (2분 휴식)' },
            { type: 'Easy', intensity: 'low-intensity', description: 'E pace 40-50분', details: '회복' },
            { type: 'Fartlek', intensity: 'medium-intensity', description: '변속주 40분', details: '1분 hard / 2분 easy x8' },
            { type: 'Interval', intensity: 'high-intensity', description: 'I pace 20분', details: '4x5분 (3분 휴식)' },
            { type: 'Easy', intensity: 'low-intensity', description: 'E pace 40분', details: '회복' },
            { type: 'Long Run', intensity: 'low-intensity', description: 'E/M pace 80-90분', details: '마지막 20분 M pace' },
            { type: 'Rest', intensity: 'rest-day', description: '능동적 회복', details: '수영 또는 자전거' },
            { type: 'Repetition', intensity: 'high-intensity', description: 'R pace 15분', details: '6x400m (완전 회복)' },
            { type: 'Easy', intensity: 'low-intensity', description: 'E pace 40분', details: '쿨다운' }
          ];
        } else {
          cycle = [
            { type: 'Easy', intensity: 'low-intensity', description: 'E pace 60-70분', details: 'AM 세션' },
            { type: 'Threshold', intensity: 'medium-intensity', description: 'T pace 40분', details: '2x20분 (3분 휴식)' },
            { type: 'Double', intensity: 'low-intensity', description: 'AM: E 40분, PM: E 30분', details: '이중 회복' },
            { type: 'Hills', intensity: 'high-intensity', description: '언덕 반복 x10', details: '2분 상승 / 조깅 하강' },
            { type: 'Interval', intensity: 'high-intensity', description: 'I pace 25분', details: '5x5분 (2분 휴식)' },
            { type: 'Easy', intensity: 'low-intensity', description: 'E pace 50분', details: '회복' },
            { type: 'Long Run', intensity: 'medium-intensity', description: 'Progressive 100-110분', details: 'E→M→T pace' },
            { type: 'Recovery', intensity: 'low-intensity', description: 'E pace 30-40분', details: '매우 편안한 속도' },
            { type: 'Repetition', intensity: 'high-intensity', description: 'R pace 20분', details: '8x400m + 4x200m' },
            { type: 'Easy', intensity: 'low-intensity', description: 'E pace 50분', details: '정리 및 회복' }
          ];
        }
      } else {
        // Double sessions per day
        if (userProfile.intensity === 'beginner') {
          cycle = [
            { type: 'Double Easy', intensity: 'low-intensity', description: 'AM: E 30분, PM: E 25분', details: '적응 단계' },
            { type: 'Threshold+Easy', intensity: 'medium-intensity', description: 'AM: T 20분, PM: E 20분', details: '' },
            { type: 'Recovery', intensity: 'low-intensity', description: 'AM: E 25분, PM: 휴식', details: '' },
            { type: 'Rest', intensity: 'rest-day', description: '완전 휴식', details: '' },
            { type: 'Interval+Easy', intensity: 'high-intensity', description: 'AM: I 15분, PM: E 20분', details: '' },
            { type: 'Double Easy', intensity: 'low-intensity', description: 'AM: E 30분, PM: E 20분', details: '' },
            { type: 'Long+Recovery', intensity: 'low-intensity', description: 'AM: E 60분, PM: 회복 조깅 15분', details: '' },
            { type: 'Rest', intensity: 'rest-day', description: '완전 휴식', details: '' },
            { type: 'Tempo+Easy', intensity: 'medium-intensity', description: 'AM: M 25분, PM: E 20분', details: '' },
            { type: 'Recovery', intensity: 'low-intensity', description: 'AM: E 30분, PM: 휴식', details: '' }
          ];
        } else if (userProfile.intensity === 'intermediate') {
          cycle = [
            { type: 'Double Easy', intensity: 'low-intensity', description: 'AM: E 40분, PM: E 30분', details: '' },
            { type: 'Threshold+Easy', intensity: 'medium-intensity', description: 'AM: T 30분, PM: E 30분', details: '' },
            { type: 'Easy+Strides', intensity: 'low-intensity', description: 'AM: E 40분, PM: E 20분 + 6x100m', details: '' },
            { type: 'Fartlek+Recovery', intensity: 'medium-intensity', description: 'AM: 변속 40분, PM: 회복 20분', details: '' },
            { type: 'Interval+Easy', intensity: 'high-intensity', description: 'AM: I 20분, PM: E 25분', details: '' },
            { type: 'Double Easy', intensity: 'low-intensity', description: 'AM: E 35분, PM: E 30분', details: '' },
            { type: 'Long+Recovery', intensity: 'low-intensity', description: 'AM: E/M 80분, PM: 회복 20분', details: '' },
            { type: 'Easy Only', intensity: 'low-intensity', description: 'AM: E 40분, PM: 휴식', details: '' },
            { type: 'Rep+Easy', intensity: 'high-intensity', description: 'AM: R 15분, PM: E 25분', details: '' },
            { type: 'Recovery', intensity: 'low-intensity', description: 'AM: E 35분, PM: E 20분', details: '' }
          ];
        } else {
          cycle = [
            { type: 'Double Base', intensity: 'low-intensity', description: 'AM: E 50분, PM: E 40분', details: '90분 총 볼륨' },
            { type: 'Threshold+Easy', intensity: 'medium-intensity', description: 'AM: T 40분, PM: E 40분', details: '젖산 역치 강화' },
            { type: 'Easy+Tempo', intensity: 'medium-intensity', description: 'AM: E 45분, PM: M 30분', details: '' },
            { type: 'Hills+Recovery', intensity: 'high-intensity', description: 'AM: 언덕 x12, PM: E 30분', details: '' },
            { type: 'Interval+Easy', intensity: 'high-intensity', description: 'AM: I 25분, PM: E 35분', details: 'VO2max 세션' },
            { type: 'Double Easy', intensity: 'low-intensity', description: 'AM: E 45분, PM: E 35분', details: '' },
            { type: 'Long+Shake', intensity: 'medium-intensity', description: 'AM: Progressive 100분, PM: 회복 20분', details: '' },
            { type: 'Recovery', intensity: 'low-intensity', description: 'AM: E 40분, PM: 휴식 또는 마사지', details: '' },
            { type: 'Rep+Easy', intensity: 'high-intensity', description: 'AM: R 20분, PM: E 30분', details: '스피드 세션' },
            { type: 'Taper', intensity: 'low-intensity', description: 'AM: E 40분, PM: E 25분', details: '다음 주기 준비' }
          ];
        }
      }
      
      // Apply condition-based modifications
      if (userProfile.conditions.injuryRecovery) {
        cycle = cycle.map(day => {
          if (day.intensity === 'high-intensity') {
            day.intensity = 'medium-intensity';
            day.description = day.description.replace(/I pace|R pace/, 'T pace');
          }
          return day;
        });
      }
      
      if (userProfile.conditions.competitionPrep) {
        // Tapering adjustments for last 3 days
        for (let i = 7; i < 10; i++) {
          if (cycle[i]) {
            cycle[i].description = cycle[i].description.replace(/\d+분/, (match) => {
              const minutes = parseInt(match);
              return Math.round(minutes * 0.6) + '분';
            });
          }
        }
      }
      
      return cycle;
    }

    function displayRecommendations() {
      let recommendations = [];
      
      // Gender-specific recommendations
      if (userProfile.gender === 'female') {
        recommendations.push({
          icon: '♀️',
          title: '여성 특화 조언',
          text: '철분 수치를 정기적으로 체크하고, 생리 주기에 따라 고강도 훈련 일정을 조정하세요.'
        });
      }
      
      // Frequency recommendations
      if (userProfile.frequency === '2x') {
        recommendations.push({
          icon: '⏰',
          title: '이중 세션 팁',
          text: 'AM/PM 세션 간 최소 6시간 간격을 유지하고, PM 세션은 가벼운 강도로 진행하세요.'
        });
      }
      
      // Condition-specific recommendations
      if (userProfile.conditions.injuryRecovery) {
        recommendations.push({
          icon: '🏥',
          title: '부상 회복',
          text: '통증이 있다면 즉시 중단하고, 크로스 트레이닝(수영, 자전거)을 병행하세요.'
        });
      }
      
      if (userProfile.conditions.highFatigue) {
        recommendations.push({
          icon: '😴',
          title: '피로 관리',
          text: '수면 시간을 8시간 이상 확보하고, 훈련 후 단백질 섭취를 늘리세요.'
        });
      }
      
      if (userProfile.conditions.competitionPrep) {
        recommendations.push({
          icon: '🏆',
          title: '대회 준비',
          text: '대회 2주 전부터 볼륨을 줄이고, 대회 3일 전부터 탄수화물 섭취를 늘리세요.'
        });
      }
      
      if (userProfile.conditions.hotWeather) {
        recommendations.push({
          icon: '☀️',
          title: '더운 날씨 대응',
          text: '훈련 전후 충분한 수분 섭취, 전해질 보충, 가능하면 이른 아침이나 저녁에 훈련하세요.'
        });
      }
      
      if (userProfile.conditions.altitudeTraining) {
        recommendations.push({
          icon: '⛰️',
          title: '고지대 적응',
          text: '처음 1주일은 강도를 70%로 제한하고, 철분 보충제 섭취를 고려하세요.'
        });
      }
      
      // Intensity-specific recommendations
      if (userProfile.intensity === 'beginner') {
        recommendations.push({
          icon: '🌱',
          title: '초보자 가이드',
          text: '주간 마일리지를 10% 이상 늘리지 마시고, 충분한 휴식을 취하세요.'
        });
      } else if (userProfile.intensity === 'advanced') {
        recommendations.push({
          icon: '💎',
          title: '고급 훈련',
          text: '주기적인 체력 테스트로 VDOT을 업데이트하고, 4주마다 회복 주간을 가지세요.'
        });
      }
      
      // Add nutrition recommendation
      recommendations.push({
        icon: '🥗',
        title: '영양 섭취',
        text: '훈련 후 30분 내 탄수화물과 단백질을 3:1 비율로 섭취하세요.'
      });
      
      // Add warm-up/cool-down
      recommendations.push({
        icon: '🔥',
        title: '준비/정리 운동',
        text: '모든 훈련 전 10분 워밍업, 훈련 후 10분 쿨다운과 스트레칭을 필수로 하세요.'
      });
      
      const recommendationsHTML = recommendations.map(rec => `
        <div class="flex items-start p-3 bg-yellow-50 rounded-lg">
          <span class="text-xl mr-3">${rec.icon}</span>
          <div>
            <div class="font-bold text-sm mb-1">${rec.title}</div>
            <div class="text-xs text-gray-700">${rec.text}</div>
          </div>
        </div>
      `).join('');
      
      document.getElementById('recommendations').innerHTML = recommendationsHTML;
    }

    function resetCalculator() {
      // Reset user profile
      userProfile = {
        gender: null,
        frequency: null,
        intensity: null,
        baseRecord: {},
        vdot: 0,
        conditions: {},
        adjustments: {
          vdot: 1.0,
          volume: 1.0,
          intensity: 1.0
        }
      };
      
      // Reset UI
      document.querySelectorAll('button[id$="-btn"]').forEach(btn => {
        btn.classList.remove('border-purple-600', 'bg-purple-50');
      });
      
      document.getElementById('eventSelect').value = '';
      document.getElementById('hours').value = '';
      document.getElementById('minutes').value = '';
      document.getElementById('seconds').value = '';
      
      document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
        cb.checked = false;
      });
      
      // Show step 1, hide results
      document.getElementById('results').classList.add('hidden');
      goToStep1();
    }
  </script>
</body>
</html>