<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>애슬리트 타임 | 러닝 페이스 계산기</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Malgun Gothic', '맑은 고딕', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    
    .device-card {
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    
    .device-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.1), transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .device-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    }
    
    .device-card:hover::before {
      opacity: 1;
    }
    
    .recommended {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    .logo-text {
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .auto-detect-badge {
      animation: slideIn 0.5s ease;
    }
    
    @keyframes slideIn {
      from { 
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* 채팅 플로팅 버튼 */
    .chat-fab {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      transition: all 0.3s;
      color: white;
    }
    
    .chat-fab:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 30px rgba(0, 0, 0, 0.4);
    }
    
    .chat-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ef4444;
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      animation: pulse 2s infinite;
    }
    
    /* 미니 채팅창 */
    .mini-chat {
      position: fixed;
      bottom: 100px;
      right: 30px;
      width: 380px;
      height: 500px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      display: none;
      flex-direction: column;
      z-index: 999;
      animation: slideUp 0.3s ease-out;
    }
    
    .mini-chat.active {
      display: flex;
    }
    
    @keyframes slideUp {
      from {
        transform: translateY(20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    .mini-chat-header {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 15px 20px;
      border-radius: 16px 16px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
    }
    
    .chat-online {
      font-size: 12px;
      color: #4ade80;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .mini-chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      background: #f9fafb;
    }
    
    .mini-message {
      margin: 8px 0;
      padding: 10px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .mini-message.own {
      background: linear-gradient(135deg, #f3e8ff, #ede9fe);
      margin-left: 20%;
    }
    
    .mini-message strong {
      color: #667eea;
      font-size: 13px;
      display: block;
      margin-bottom: 4px;
    }
    
    .mini-message .text {
      color: #374151;
      font-size: 14px;
    }
    
    .mini-message .time {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 4px;
    }
    
    .mini-chat-input {
      display: flex;
      gap: 10px;
      padding: 15px;
      background: white;
      border-top: 1px solid #e5e7eb;
      border-radius: 0 0 16px 16px;
    }
    
    .mini-chat-input input {
      flex: 1;
      padding: 10px 15px;
      background: #f3f4f6;
      border: 1px solid #e5e7eb;
      border-radius: 25px;
      font-size: 14px;
      outline: none;
      transition: all 0.3s;
    }
    
    .mini-chat-input input:focus {
      border-color: #667eea;
      background: white;
    }
    
    .mini-chat-input button {
      padding: 10px 20px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      transition: all 0.3s;
    }
    
    .mini-chat-input button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    /* 실시간 활동 알림 */
    .activity-toast {
      position: fixed;
      bottom: 30px;
      left: 30px;
      background: white;
      border-radius: 12px;
      padding: 15px 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      display: none;
      align-items: center;
      gap: 12px;
      animation: slideInLeft 0.5s ease-out;
      max-width: 350px;
    }
    
    @keyframes slideInLeft {
      from {
        transform: translateX(-100%);
      }
      to {
        transform: translateX(0);
      }
    }
    
    .activity-toast.show {
      display: flex;
    }
    
    @media (max-width: 768px) {
      .mini-chat {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        width: 100%;
        height: 70vh;
        border-radius: 20px 20px 0 0;
      }
      
      .activity-toast {
        left: 10px;
        right: 10px;
        max-width: none;
      }
    }
  </style>
</head>
<body class="flex items-center justify-center p-4">
  <div class="max-w-5xl w-full">
    <!-- 헤더 -->
    <div class="text-center mb-8 text-white">
      <div class="mb-4">
        <i class="fas fa-running text-6xl md:text-7xl"></i>
      </div>
      <h1 class="text-3xl md:text-5xl font-bold mb-2">ATHLETE TIME</h1>
      <p class="text-lg md:text-xl opacity-90">러닝 페이스 계산기 & 트레이닝 차트</p>
    </div>

    <!-- 자동 감지 알림 -->
    <div id="autoDetectBadge" class="auto-detect-badge bg-white/20 backdrop-blur rounded-full px-6 py-3 mb-8 text-white text-center mx-auto w-fit">
      <i class="fas fa-magic mr-2"></i>
      <span id="detectedDevice">디바이스 감지 중...</span>
    </div>

    <!-- 디바이스 선택 카드 -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      <!-- 모바일 버전 카드 -->
      <div id="mobileCard" class="device-card bg-white rounded-2xl p-8 shadow-xl">
        <div class="text-center">
          <div class="mb-4">
            <i class="fas fa-mobile-alt text-6xl md:text-7xl text-purple-600"></i>
          </div>
          <h2 class="text-2xl font-bold mb-2">모바일 버전</h2>
          <p class="text-gray-600 mb-4">스마트폰 & 태블릿 최적화</p>
          
          <div class="space-y-2 text-sm text-left bg-purple-50 rounded-lg p-4 mb-6">
            <div class="flex items-center">
              <i class="fas fa-check-circle text-purple-600 mr-2"></i>
              <span>터치 친화적 인터페이스</span>
            </div>
            <div class="flex items-center">
              <i class="fas fa-check-circle text-purple-600 mr-2"></i>
              <span>세로 모드 최적화</span>
            </div>
            <div class="flex items-center">
              <i class="fas fa-check-circle text-purple-600 mr-2"></i>
              <span>실시간 채팅 통합</span>
            </div>
            <div class="flex items-center">
              <i class="fas fa-check-circle text-purple-600 mr-2"></i>
              <span>간소화된 테이블 뷰</span>
            </div>
          </div>
          
          <button onclick="selectVersion('mobile')" 
                  class="w-full bg-gradient-to-r from-purple-600 to-purple-700 text-white py-3 rounded-lg font-bold hover:from-purple-700 hover:to-purple-800 transition-all">
            모바일 버전으로 입장
            <i class="fas fa-arrow-right ml-2"></i>
          </button>
        </div>
      </div>

      <!-- PC 버전 카드 -->
      <div id="desktopCard" class="device-card bg-white rounded-2xl p-8 shadow-xl">
        <div class="text-center">
          <div class="mb-4">
            <i class="fas fa-desktop text-6xl md:text-7xl text-blue-600"></i>
          </div>
          <h2 class="text-2xl font-bold mb-2">PC 버전</h2>
          <p class="text-gray-600 mb-4">데스크톱 & 노트북 최적화</p>
          
          <div class="space-y-2 text-sm text-left bg-blue-50 rounded-lg p-4 mb-6">
            <div class="flex items-center">
              <i class="fas fa-check-circle text-blue-600 mr-2"></i>
              <span>넓은 화면 활용</span>
            </div>
            <div class="flex items-center">
              <i class="fas fa-check-circle text-blue-600 mr-2"></i>
              <span>다중 차트 동시 표시</span>
            </div>
            <div class="flex items-center">
              <i class="fas fa-check-circle text-blue-600 mr-2"></i>
              <span>실시간 채팅 패널</span>
            </div>
            <div class="flex items-center">
              <i class="fas fa-check-circle text-blue-600 mr-2"></i>
              <span>상세 통계 분석</span>
            </div>
          </div>
          
          <button onclick="selectVersion('desktop')" 
                  class="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white py-3 rounded-lg font-bold hover:from-blue-700 hover:to-blue-800 transition-all">
            PC 버전으로 입장
            <i class="fas fa-arrow-right ml-2"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- 추가 기능 소개 -->
    <div class="bg-white/10 backdrop-blur rounded-2xl p-6 mb-8">
      <h3 class="text-white text-xl font-bold mb-4 text-center">
        <i class="fas fa-star mr-2"></i>
        주요 기능
      </h3>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-white text-center">
        <div class="bg-white/10 rounded-lg p-4">
          <i class="fas fa-calculator text-2xl mb-2"></i>
          <p class="text-sm">페이스 계산기</p>
        </div>
        <div class="bg-white/10 rounded-lg p-4">
          <i class="fas fa-route text-2xl mb-2"></i>
          <p class="text-sm">트랙 레인 계산</p>
        </div>
        <div class="bg-white/10 rounded-lg p-4">
          <i class="fas fa-comments text-2xl mb-2"></i>
          <p class="text-sm">실시간 채팅</p>
        </div>
        <div class="bg-white/10 rounded-lg p-4">
          <i class="fas fa-chart-line text-2xl mb-2"></i>
          <p class="text-sm">스플릿 차트</p>
        </div>
      </div>
    </div>

    <!-- 빠른 링크 -->
    <div class="text-center text-white/80 text-sm">
      <div class="flex justify-center gap-6 mb-4">
        <a href="chat-websocket.html" class="hover:text-white transition">
          <i class="fas fa-comments mr-1"></i> 채팅방
        </a>
        <a href="community.html" class="hover:text-white transition">
          <i class="fas fa-users mr-1"></i> 커뮤니티
        </a>
        <a href="#" onclick="showAbout(); return false;" class="hover:text-white transition">
          <i class="fas fa-info-circle mr-1"></i> 소개
        </a>
      </div>
      <p class="opacity-60">© 2024 Athlete Time. All rights reserved.</p>
    </div>
  </div>

  <!-- 채팅 플로팅 버튼 -->
  <div class="chat-fab" id="chatFab" onclick="toggleChat()">
    <i class="fas fa-comments text-2xl"></i>
    <div class="chat-badge" id="chatBadge" style="display: none;">0</div>
  </div>

  <!-- 미니 채팅창 -->
  <div class="mini-chat" id="miniChat">
    <div class="mini-chat-header">
      <div>
        <span>💬 러닝톡</span>
        <div class="chat-online">
          <i class="fas fa-circle text-xs"></i>
          <span id="onlineCount">연결 중...</span>
        </div>
      </div>
      <button onclick="toggleChat()" style="background: none; border: none; color: white; font-size: 20px; cursor: pointer;">✕</button>
    </div>
    <div class="mini-chat-messages" id="miniChatMessages">
      <div class="text-center py-10 text-gray-400">
        <i class="fas fa-comments text-3xl mb-3"></i>
        <p>다른 러너들과 대화해보세요!</p>
      </div>
    </div>
    <div class="mini-chat-input">
      <input type="text" id="miniChatInput" placeholder="메시지를 입력하세요..." 
             onkeypress="if(event.key==='Enter') sendMessage()">
      <button onclick="sendMessage()">전송</button>
    </div>
  </div>

  <!-- 실시간 활동 알림 -->
  <div class="activity-toast" id="activityToast">
    <i class="fas fa-bell text-purple-600"></i>
    <div>
      <div class="font-bold text-sm" id="activityTitle">새로운 활동</div>
      <div class="text-xs text-gray-600" id="activityText"></div>
    </div>
  </div>

  <script>
    // 디바이스 감지
    function detectDevice() {
      const userAgent = navigator.userAgent.toLowerCase();
      const isMobile = /mobile|android|iphone|ipad|phone/i.test(userAgent);
      const isTablet = /tablet|ipad/i.test(userAgent);
      
      const badge = document.getElementById('detectedDevice');
      const mobileCard = document.getElementById('mobileCard');
      const desktopCard = document.getElementById('desktopCard');
      
      if (isMobile || isTablet) {
        badge.textContent = '모바일 디바이스 감지됨';
        mobileCard.classList.add('recommended');
        mobileCard.style.border = '2px solid #8b5cf6';
      } else {
        badge.textContent = 'PC 환경 감지됨';
        desktopCard.classList.add('recommended');
        desktopCard.style.border = '2px solid #3b82f6';
      }
    }
    
    // 버전 선택
    function selectVersion(version) {
      if (version === 'mobile') {
        window.location.href = 'pace-calculator-mobile.html';
      } else {
        window.location.href = 'pace-calculator.html';
      }
    }
    
    // 채팅 관련
    let ws = null;
    let reconnectAttempts = 0;
    const maxReconnectAttempts = 5;
    let unreadCount = 0;
    
    function toggleChat() {
      const chat = document.getElementById('miniChat');
      const badge = document.getElementById('chatBadge');
      
      chat.classList.toggle('active');
      
      if (chat.classList.contains('active')) {
        badge.style.display = 'none';
        unreadCount = 0;
        document.getElementById('miniChatInput').focus();
        
        // 처음 열 때 WebSocket 연결
        if (!ws) {
          connectWebSocket();
        }
      }
    }
    
    function connectWebSocket() {
      const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
      
      try {
        ws = new WebSocket(`${protocol}//${window.location.hostname}:3002`);
        
        ws.onopen = () => {
          console.log('채팅 서버 연결됨');
          reconnectAttempts = 0;
          document.getElementById('onlineCount').textContent = '온라인';
          
          const username = localStorage.getItem('username') || `러너${Math.floor(Math.random() * 1000)}`;
          localStorage.setItem('username', username);
          
          ws.send(JSON.stringify({
            type: 'join',
            data: { username, page: 'landing' }
          }));
          
          addSystemMessage('채팅 서버에 연결되었습니다');
        };
        
        ws.onmessage = (event) => {
          const data = JSON.parse(event.data);
          handleMessage(data);
        };
        
        ws.onclose = () => {
          console.log('채팅 연결 종료');
          document.getElementById('onlineCount').textContent = '오프라인';
          
          if (reconnectAttempts < maxReconnectAttempts) {
            reconnectAttempts++;
            setTimeout(connectWebSocket, Math.min(1000 * Math.pow(2, reconnectAttempts), 10000));
          }
        };
        
        ws.onerror = (error) => {
          console.error('채팅 연결 오류:', error);
        };
        
      } catch (error) {
        console.error('WebSocket 연결 실패:', error);
        useFallbackMode();
      }
    }
    
    function handleMessage(data) {
      switch(data.type) {
        case 'message':
          addChatMessage(data.data.username, data.data.text, false);
          showNotification();
          break;
          
        case 'activity':
          addChatMessage(data.data.username, data.data.text, false);
          showActivityToast(data.data);
          break;
          
        case 'user_joined':
          addSystemMessage(`${data.data.username}님이 입장했습니다`);
          break;
          
        case 'user_left':
          addSystemMessage(`${data.data.username}님이 퇴장했습니다`);
          break;
          
        case 'users_online':
          document.getElementById('onlineCount').textContent = `온라인 (${data.data.count}명)`;
          break;
      }
    }
    
    function sendMessage() {
      const input = document.getElementById('miniChatInput');
      const text = input.value.trim();
      if (!text) return;
      
      const username = localStorage.getItem('username') || '나';
      
      if (ws && ws.readyState === WebSocket.OPEN) {
        ws.send(JSON.stringify({
          type: 'message',
          data: {
            text,
            username,
            source: 'landing',
            timestamp: new Date().toISOString()
          }
        }));
        
        addChatMessage(username, text, true);
      } else {
        // 폴백 모드
        addChatMessage(username, text, true);
        saveToLocalStorage(username, text);
      }
      
      input.value = '';
    }
    
    function addChatMessage(username, text, isOwn = false) {
      const container = document.getElementById('miniChatMessages');
      const msgDiv = document.createElement('div');
      msgDiv.className = `mini-message ${isOwn ? 'own' : ''}`;
      
      const time = new Date().toLocaleTimeString('ko-KR', { 
        hour: '2-digit', 
        minute: '2-digit' 
      });
      
      msgDiv.innerHTML = `
        <strong>${username}</strong>
        <div class="text">${text}</div>
        <div class="time">${time}</div>
      `;
      
      container.appendChild(msgDiv);
      container.scrollTop = container.scrollHeight;
    }
    
    function addSystemMessage(text) {
      const container = document.getElementById('miniChatMessages');
      const msgDiv = document.createElement('div');
      msgDiv.className = 'text-center text-gray-500 text-sm py-2';
      msgDiv.textContent = text;
      container.appendChild(msgDiv);
      container.scrollTop = container.scrollHeight;
    }
    
    function showNotification() {
      const chat = document.getElementById('miniChat');
      const badge = document.getElementById('chatBadge');
      
      if (!chat.classList.contains('active')) {
        unreadCount++;
        badge.textContent = unreadCount;
        badge.style.display = 'flex';
      }
    }
    
    function showActivityToast(data) {
      const toast = document.getElementById('activityToast');
      const title = document.getElementById('activityTitle');
      const text = document.getElementById('activityText');
      
      title.textContent = data.username;
      text.textContent = data.text;
      
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 5000);
    }
    
    function useFallbackMode() {
      document.getElementById('onlineCount').textContent = '로컬 모드';
      addSystemMessage('로컬 모드로 실행 중입니다');
      
      // 로컬 스토리지에서 메시지 로드
      const messages = JSON.parse(localStorage.getItem('fallbackMessages') || '[]');
      messages.slice(-10).forEach(msg => {
        addChatMessage(msg.username, msg.text);
      });
    }
    
    function saveToLocalStorage(username, text) {
      const messages = JSON.parse(localStorage.getItem('fallbackMessages') || '[]');
      messages.push({ username, text, timestamp: new Date().toISOString() });
      if (messages.length > 100) messages.shift();
      localStorage.setItem('fallbackMessages', JSON.stringify(messages));
    }
    
    function showAbout() {
      alert('애슬리트 타임\n\n러너를 위한 종합 트레이닝 도구\n• 정확한 페이스 계산\n• 트랙 레인별 거리 계산\n• 실시간 채팅 커뮤니티\n• 스플릿 차트 생성\n\nVersion 2.0');
    }
    
    // 초기화
    document.addEventListener('DOMContentLoaded', () => {
      detectDevice();
    });
  </script>
</body>
</html>