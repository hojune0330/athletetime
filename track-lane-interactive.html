<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>인터랙티브 400m 트랙 시뮬레이터 | Athlete Time</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', '맑은 고딕', sans-serif;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    /* 3D Track perspective */
    .track-3d {
      perspective: 1000px;
      transform-style: preserve-3d;
    }
    
    .track-container {
      transform: rotateX(30deg);
      transition: transform 0.5s ease;
    }
    
    .track-container:hover {
      transform: rotateX(20deg) scale(1.05);
    }
    
    /* Runner animation */
    @keyframes run {
      0% { offset-distance: 0%; }
      100% { offset-distance: 100%; }
    }
    
    .runner {
      offset-rotate: 0deg;
      animation: run var(--duration) linear;
      animation-fill-mode: forwards;
    }
    
    /* Pulsing effect for active elements */
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.8; }
    }
    
    .pulse {
      animation: pulse 2s infinite;
    }
    
    /* Track gradient effect */
    .track-gradient {
      background: linear-gradient(90deg, 
        #ef4444 0%, 
        #f97316 14%, 
        #eab308 28%, 
        #84cc16 42%, 
        #22c55e 56%, 
        #06b6d4 70%, 
        #3b82f6 84%, 
        #8b5cf6 100%
      );
      background-size: 200% 100%;
      animation: gradient-shift 10s ease infinite;
    }
    
    @keyframes gradient-shift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    
    /* Speed indicator */
    .speed-bar {
      transition: width 0.3s ease;
      background: linear-gradient(90deg, #10b981, #3b82f6, #8b5cf6);
    }
    
    /* Info card animations */
    .info-card {
      transform: translateY(0);
      transition: all 0.3s ease;
    }
    
    .info-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }
    
    /* Lane highlight effect */
    .lane-highlight {
      filter: drop-shadow(0 0 10px currentColor);
      animation: glow 2s ease-in-out infinite alternate;
    }
    
    @keyframes glow {
      from { filter: drop-shadow(0 0 5px currentColor); }
      to { filter: drop-shadow(0 0 20px currentColor); }
    }
  </style>
</head>
<body class="bg-gray-50">
  <div class="max-w-7xl mx-auto p-6">
    <!-- Header -->
    <div class="gradient-bg text-white p-6 rounded-xl mb-6">
      <div class="flex justify-between items-start">
        <div>
          <h1 class="text-3xl font-bold mb-2">🏃‍♂️ 인터랙티브 400m 트랙 시뮬레이터</h1>
          <p class="opacity-90">실시간으로 레인별 차이를 체험해보세요!</p>
        </div>
        <div class="flex gap-2">
          <button onclick="window.location.href='track-lane-visualizer.html'" class="bg-white/20 hover:bg-white/30 p-3 rounded-lg transition" title="기본 시각화">
            <i class="fas fa-chart-line text-xl"></i>
          </button>
          <button onclick="window.location.href='pace-calculator.html'" class="bg-white/20 hover:bg-white/30 p-3 rounded-lg transition" title="페이스 계산기">
            <i class="fas fa-calculator text-xl"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Control Panel -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
      <h2 class="text-xl font-bold mb-4">🎮 시뮬레이션 컨트롤</h2>
      
      <div class="grid md:grid-cols-4 gap-4">
        <!-- Race Mode -->
        <div>
          <label class="block text-sm font-medium mb-2">경기 모드</label>
          <select id="raceMode" class="w-full p-3 border-2 rounded-lg focus:border-purple-500">
            <option value="single">단독 주행</option>
            <option value="comparison">레인 비교</option>
            <option value="race">8레인 경주</option>
          </select>
        </div>
        
        <!-- Selected Lane -->
        <div>
          <label class="block text-sm font-medium mb-2">내 레인</label>
          <select id="myLane" class="w-full p-3 border-2 rounded-lg focus:border-purple-500">
            <option value="1">레인 1 (내측)</option>
            <option value="2">레인 2</option>
            <option value="3">레인 3</option>
            <option value="4" selected>레인 4</option>
            <option value="5">레인 5</option>
            <option value="6">레인 6</option>
            <option value="7">레인 7</option>
            <option value="8">레인 8 (외측)</option>
          </select>
        </div>
        
        <!-- Speed -->
        <div>
          <label class="block text-sm font-medium mb-2">주행 속도</label>
          <input type="range" id="speed" min="40" max="60" value="50" 
                 class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
          <div class="text-center text-sm mt-1">
            <span id="speedValue">50</span>초 (400m 기준)
          </div>
        </div>
        
        <!-- Controls -->
        <div>
          <label class="block text-sm font-medium mb-2">컨트롤</label>
          <div class="flex gap-2">
            <button onclick="startRace()" id="startBtn" 
                    class="flex-1 bg-green-600 text-white p-3 rounded-lg hover:bg-green-700 transition">
              <i class="fas fa-play mr-2"></i>시작
            </button>
            <button onclick="resetRace()" 
                    class="flex-1 bg-gray-600 text-white p-3 rounded-lg hover:bg-gray-700 transition">
              <i class="fas fa-redo mr-2"></i>리셋
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- 3D Track View -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
      <h2 class="text-xl font-bold mb-4">🏟️ 트랙 뷰</h2>
      
      <div class="track-3d">
        <canvas id="trackCanvas" width="800" height="600" class="w-full h-auto border rounded-lg"></canvas>
      </div>
      
      <!-- Real-time Info Display -->
      <div class="grid grid-cols-4 gap-4 mt-4">
        <div class="text-center p-3 bg-blue-50 rounded-lg">
          <div class="text-2xl font-bold text-blue-600" id="distance">0</div>
          <div class="text-xs text-gray-600">거리 (m)</div>
        </div>
        <div class="text-center p-3 bg-green-50 rounded-lg">
          <div class="text-2xl font-bold text-green-600" id="time">0.0</div>
          <div class="text-xs text-gray-600">시간 (초)</div>
        </div>
        <div class="text-center p-3 bg-purple-50 rounded-lg">
          <div class="text-2xl font-bold text-purple-600" id="pace">--</div>
          <div class="text-xs text-gray-600">페이스 (/km)</div>
        </div>
        <div class="text-center p-3 bg-orange-50 rounded-lg">
          <div class="text-2xl font-bold text-orange-600" id="position">--</div>
          <div class="text-xs text-gray-600">순위</div>
        </div>
      </div>
    </div>

    <!-- Lane Comparison Table -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
      <h2 class="text-xl font-bold mb-4">📊 레인별 실시간 데이터</h2>
      
      <div id="laneComparison" class="overflow-x-auto">
        <table class="w-full">
          <thead>
            <tr class="border-b-2">
              <th class="p-2 text-left">레인</th>
              <th class="p-2 text-center">실제 거리</th>
              <th class="p-2 text-center">스태거</th>
              <th class="p-2 text-center">현재 위치</th>
              <th class="p-2 text-center">진행률</th>
              <th class="p-2 text-center">예상 기록</th>
            </tr>
          </thead>
          <tbody id="laneTableBody">
            <!-- Dynamically generated -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Educational Info -->
    <div class="grid md:grid-cols-2 gap-6 mb-6">
      <!-- Physics Explanation -->
      <div class="bg-white rounded-xl shadow-lg p-6 info-card">
        <h3 class="text-lg font-bold mb-3 text-blue-600">
          <i class="fas fa-atom mr-2"></i>물리학적 원리
        </h3>
        <div class="space-y-2 text-sm">
          <div class="p-3 bg-blue-50 rounded">
            <strong>곡선 반경 차이</strong>
            <p class="text-gray-600 mt-1">
              레인 1: 반경 36.50m<br>
              레인 8: 반경 45.04m<br>
              차이: 8.54m (23% 증가)
            </p>
          </div>
          <div class="p-3 bg-green-50 rounded">
            <strong>원심력 영향</strong>
            <p class="text-gray-600 mt-1">
              외측 레인일수록 원심력이 감소하여<br>
              코너링이 더 쉬워집니다.
            </p>
          </div>
        </div>
      </div>
      
      <!-- Strategy Tips -->
      <div class="bg-white rounded-xl shadow-lg p-6 info-card">
        <h3 class="text-lg font-bold mb-3 text-purple-600">
          <i class="fas fa-chess mr-2"></i>레인별 전략
        </h3>
        <div class="space-y-2 text-sm">
          <div class="p-3 bg-purple-50 rounded">
            <strong>내측 레인 (1-3)</strong>
            <p class="text-gray-600 mt-1">
              • 타이트한 코너링 필요<br>
              • 경쟁자 확인 용이<br>
              • 심리적 압박 적음
            </p>
          </div>
          <div class="p-3 bg-orange-50 rounded">
            <strong>외측 레인 (6-8)</strong>
            <p class="text-gray-600 mt-1">
              • 스태거로 앞서 출발<br>
              • 경쟁자 확인 어려움<br>
              • 자기 페이스 유지 중요
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Interactive Features -->
    <div class="bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl p-6 mb-6">
      <h3 class="text-lg font-bold mb-3">✨ 인터랙티브 기능</h3>
      <div class="grid md:grid-cols-3 gap-4 text-sm">
        <div class="flex items-start">
          <i class="fas fa-mouse-pointer text-purple-600 mr-2 mt-1"></i>
          <div>
            <strong>마우스 호버</strong>
            <p class="text-gray-600">트랙 위에 마우스를 올려 상세 정보 확인</p>
          </div>
        </div>
        <div class="flex items-start">
          <i class="fas fa-keyboard text-blue-600 mr-2 mt-1"></i>
          <div>
            <strong>키보드 단축키</strong>
            <p class="text-gray-600">Space: 시작/정지, R: 리셋</p>
          </div>
        </div>
        <div class="flex items-start">
          <i class="fas fa-chart-line text-green-600 mr-2 mt-1"></i>
          <div>
            <strong>실시간 분석</strong>
            <p class="text-gray-600">레인별 속도와 위치 실시간 비교</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Creator Credit -->
    <div class="text-center text-sm text-gray-600">
      제작자: 장호준 코치 | 🏃‍♂️ 더 빠른 당신을 위한 과학적 트레이닝
    </div>
  </div>

  <script>
    // Canvas setup
    const canvas = document.getElementById('trackCanvas');
    const ctx = canvas.getContext('2d');
    
    // Track data
    const trackData = {
      lanes: [
        { num: 1, distance: 400.00, stagger: 0.00, radius: 36.50, color: '#ef4444' },
        { num: 2, distance: 407.04, stagger: 7.04, radius: 37.72, color: '#f97316' },
        { num: 3, distance: 414.70, stagger: 14.70, radius: 38.94, color: '#eab308' },
        { num: 4, distance: 422.37, stagger: 22.37, radius: 40.16, color: '#84cc16' },
        { num: 5, distance: 430.03, stagger: 30.03, radius: 41.38, color: '#22c55e' },
        { num: 6, distance: 437.70, stagger: 37.70, radius: 42.60, color: '#06b6d4' },
        { num: 7, distance: 445.36, stagger: 45.36, radius: 43.82, color: '#3b82f6' },
        { num: 8, distance: 453.03, stagger: 53.03, radius: 45.04, color: '#8b5cf6' }
      ]
    };
    
    // Race state
    let raceState = {
      running: false,
      runners: [],
      startTime: 0,
      animationId: null
    };
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      setupEventListeners();
      drawTrack();
      updateLaneTable();
    });
    
    function setupEventListeners() {
      document.getElementById('speed').addEventListener('input', function(e) {
        document.getElementById('speedValue').textContent = e.target.value;
      });
      
      document.getElementById('raceMode').addEventListener('change', updateLaneTable);
      document.getElementById('myLane').addEventListener('change', updateLaneTable);
      
      // Keyboard shortcuts
      document.addEventListener('keydown', function(e) {
        if (e.code === 'Space') {
          e.preventDefault();
          if (raceState.running) {
            pauseRace();
          } else {
            startRace();
          }
        } else if (e.code === 'KeyR') {
          resetRace();
        }
      });
    }
    
    function drawTrack() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Draw background
      ctx.fillStyle = '#f3f4f6';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Draw lanes
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const laneWidth = 10;
      
      trackData.lanes.forEach((lane, index) => {
        const radius = 100 + index * 15;
        
        // Draw lane
        ctx.strokeStyle = lane.color;
        ctx.lineWidth = laneWidth;
        ctx.globalAlpha = 0.3;
        
        // Draw oval track
        ctx.beginPath();
        ctx.ellipse(centerX - 100, centerY, radius, radius * 0.7, 0, 0, Math.PI);
        ctx.stroke();
        
        ctx.beginPath();
        ctx.ellipse(centerX + 100, centerY, radius, radius * 0.7, 0, Math.PI, 2 * Math.PI);
        ctx.stroke();
        
        // Connect curves with straight lines
        ctx.beginPath();
        ctx.moveTo(centerX - 100, centerY - radius * 0.7);
        ctx.lineTo(centerX + 100, centerY - radius * 0.7);
        ctx.stroke();
        
        ctx.beginPath();
        ctx.moveTo(centerX - 100, centerY + radius * 0.7);
        ctx.lineTo(centerX + 100, centerY + radius * 0.7);
        ctx.stroke();
        
        ctx.globalAlpha = 1;
        
        // Draw lane number
        ctx.fillStyle = lane.color;
        ctx.font = 'bold 14px Arial';
        ctx.fillText(lane.num, centerX - 250 + index * 20, centerY);
      });
      
      // Draw start/finish line
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 3;
      ctx.setLineDash([5, 5]);
      ctx.beginPath();
      ctx.moveTo(centerX, centerY - 200);
      ctx.lineTo(centerX, centerY + 200);
      ctx.stroke();
      ctx.setLineDash([]);
      
      // Draw stagger lines
      trackData.lanes.forEach((lane) => {
        if (lane.stagger > 0) {
          const staggerX = centerX + lane.stagger * 2;
          ctx.strokeStyle = lane.color;
          ctx.lineWidth = 1;
          ctx.globalAlpha = 0.5;
          ctx.beginPath();
          ctx.moveTo(staggerX, centerY - 100 - lane.num * 15);
          ctx.lineTo(staggerX, centerY - 80 - lane.num * 15);
          ctx.stroke();
          ctx.globalAlpha = 1;
        }
      });
    }
    
    function startRace() {
      if (raceState.running) return;
      
      raceState.running = true;
      raceState.startTime = Date.now();
      raceState.runners = [];
      
      const mode = document.getElementById('raceMode').value;
      const myLane = parseInt(document.getElementById('myLane').value);
      const speed = parseInt(document.getElementById('speed').value);
      
      // Create runners based on mode
      if (mode === 'single') {
        raceState.runners.push(createRunner(myLane, speed));
      } else if (mode === 'comparison') {
        raceState.runners.push(createRunner(myLane, speed));
        raceState.runners.push(createRunner(myLane === 1 ? 8 : 1, speed));
      } else if (mode === 'race') {
        for (let i = 1; i <= 8; i++) {
          const laneSpeed = speed + (Math.random() - 0.5) * 4; // Random variation
          raceState.runners.push(createRunner(i, laneSpeed));
        }
      }
      
      document.getElementById('startBtn').innerHTML = '<i class="fas fa-pause mr-2"></i>일시정지';
      animate();
    }
    
    function createRunner(lane, time400m) {
      const laneData = trackData.lanes[lane - 1];
      return {
        lane: lane,
        distance: 0,
        totalDistance: laneData.distance,
        stagger: laneData.stagger,
        speed: laneData.distance / time400m, // m/s
        color: laneData.color,
        position: { x: 0, y: 0 },
        finished: false,
        finishTime: 0
      };
    }
    
    function animate() {
      if (!raceState.running) return;
      
      const currentTime = (Date.now() - raceState.startTime) / 1000;
      
      // Update display
      document.getElementById('time').textContent = currentTime.toFixed(1);
      
      // Clear and redraw
      drawTrack();
      
      // Update and draw runners
      let allFinished = true;
      raceState.runners.forEach((runner, index) => {
        if (!runner.finished) {
          runner.distance = runner.speed * currentTime;
          
          if (runner.distance >= runner.totalDistance) {
            runner.finished = true;
            runner.finishTime = currentTime;
            runner.distance = runner.totalDistance;
          } else {
            allFinished = false;
          }
        }
        
        drawRunner(runner);
        
        // Update display for selected runner
        if (runner.lane === parseInt(document.getElementById('myLane').value)) {
          document.getElementById('distance').textContent = Math.round(runner.distance);
          const pace = runner.speed > 0 ? (1000 / runner.speed / 60).toFixed(2) : '--';
          document.getElementById('pace').textContent = pace + '/km';
        }
      });
      
      // Update positions
      updatePositions();
      
      // Continue animation
      if (!allFinished) {
        raceState.animationId = requestAnimationFrame(animate);
      } else {
        finishRace();
      }
    }
    
    function drawRunner(runner) {
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const laneRadius = 100 + (runner.lane - 1) * 15;
      
      // Calculate position on track
      const progress = runner.distance / runner.totalDistance;
      const angle = progress * 2 * Math.PI - Math.PI / 2;
      
      // Simplified position calculation
      let x, y;
      if (progress < 0.25) {
        // First straight
        x = centerX + runner.stagger * 2;
        y = centerY - laneRadius * 0.7 + progress * 4 * laneRadius * 1.4;
      } else if (progress < 0.5) {
        // First curve
        const curveProgress = (progress - 0.25) * 4;
        const curveAngle = curveProgress * Math.PI;
        x = centerX + 100 + Math.cos(curveAngle) * laneRadius;
        y = centerY + Math.sin(curveAngle) * laneRadius * 0.7;
      } else if (progress < 0.75) {
        // Second straight
        x = centerX - (progress - 0.5) * 4 * 200;
        y = centerY + laneRadius * 0.7;
      } else {
        // Second curve
        const curveProgress = (progress - 0.75) * 4;
        const curveAngle = Math.PI + curveProgress * Math.PI;
        x = centerX - 100 + Math.cos(curveAngle) * laneRadius;
        y = centerY + Math.sin(curveAngle) * laneRadius * 0.7;
      }
      
      // Draw runner
      ctx.fillStyle = runner.color;
      ctx.beginPath();
      ctx.arc(x, y, 8, 0, 2 * Math.PI);
      ctx.fill();
      
      // Draw trail
      ctx.strokeStyle = runner.color;
      ctx.lineWidth = 2;
      ctx.globalAlpha = 0.3;
      ctx.beginPath();
      ctx.arc(x, y, 12, 0, 2 * Math.PI);
      ctx.stroke();
      ctx.globalAlpha = 1;
      
      // Draw lane number
      ctx.fillStyle = '#fff';
      ctx.font = 'bold 10px Arial';
      ctx.textAlign = 'center';
      ctx.fillText(runner.lane, x, y + 3);
    }
    
    function updatePositions() {
      // Sort runners by distance covered
      const sorted = [...raceState.runners].sort((a, b) => b.distance - a.distance);
      
      sorted.forEach((runner, index) => {
        if (runner.lane === parseInt(document.getElementById('myLane').value)) {
          document.getElementById('position').textContent = (index + 1) + '/8';
        }
      });
      
      // Update table
      updateLaneTable();
    }
    
    function updateLaneTable() {
      const tbody = document.getElementById('laneTableBody');
      tbody.innerHTML = '';
      
      trackData.lanes.forEach((lane) => {
        const runner = raceState.runners.find(r => r.lane === lane.num);
        const tr = document.createElement('tr');
        tr.className = 'border-b hover:bg-gray-50';
        
        const progress = runner ? (runner.distance / runner.totalDistance * 100).toFixed(1) : 0;
        const expectedTime = runner && runner.speed > 0 ? 
          (lane.distance / runner.speed).toFixed(2) : '--';
        
        tr.innerHTML = `
          <td class="p-2">
            <span class="inline-block w-6 h-6 rounded-full" 
                  style="background: ${lane.color}"></span>
            레인 ${lane.num}
          </td>
          <td class="p-2 text-center">${lane.distance.toFixed(2)}m</td>
          <td class="p-2 text-center">${lane.stagger.toFixed(2)}m</td>
          <td class="p-2 text-center">
            ${runner ? runner.distance.toFixed(1) + 'm' : '--'}
          </td>
          <td class="p-2 text-center">
            <div class="w-full bg-gray-200 rounded-full h-2">
              <div class="speed-bar h-2 rounded-full" style="width: ${progress}%"></div>
            </div>
            <span class="text-xs">${progress}%</span>
          </td>
          <td class="p-2 text-center">${expectedTime}s</td>
        `;
        
        tbody.appendChild(tr);
      });
    }
    
    function pauseRace() {
      raceState.running = false;
      document.getElementById('startBtn').innerHTML = '<i class="fas fa-play mr-2"></i>재개';
    }
    
    function resetRace() {
      raceState.running = false;
      raceState.runners = [];
      raceState.startTime = 0;
      
      if (raceState.animationId) {
        cancelAnimationFrame(raceState.animationId);
      }
      
      document.getElementById('startBtn').innerHTML = '<i class="fas fa-play mr-2"></i>시작';
      document.getElementById('distance').textContent = '0';
      document.getElementById('time').textContent = '0.0';
      document.getElementById('pace').textContent = '--';
      document.getElementById('position').textContent = '--';
      
      drawTrack();
      updateLaneTable();
    }
    
    function finishRace() {
      raceState.running = false;
      document.getElementById('startBtn').innerHTML = '<i class="fas fa-trophy mr-2"></i>완료';
      
      // Show results
      const myLane = parseInt(document.getElementById('myLane').value);
      const myRunner = raceState.runners.find(r => r.lane === myLane);
      
      if (myRunner) {
        alert(`레이스 완료!\n레인 ${myLane}: ${myRunner.finishTime.toFixed(2)}초`);
      }
    }
  </script>
</body>
</html>