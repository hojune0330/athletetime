<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VDOT Formula Test - Exact vs Table</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', '맑은 고딕', sans-serif;
    }
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .pass { color: #10b981; font-weight: bold; }
    .fail { color: #ef4444; font-weight: bold; }
  </style>
</head>
<body class="bg-gray-50">
  <div class="max-w-7xl mx-auto p-6">
    <div class="gradient-bg text-white p-6 rounded-xl mb-6">
      <h1 class="text-3xl font-bold mb-2">VDOT Formula Accuracy Test</h1>
      <p class="opacity-90">Comparing Exact Daniels-Gilbert Formula vs Table-Based Approach</p>
    </div>

    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
      <h2 class="text-2xl font-bold mb-4">Test Results</h2>
      <div id="testResults" class="space-y-2"></div>
    </div>

    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
      <h2 class="text-2xl font-bold mb-4">Summary Statistics</h2>
      <div id="summary" class="grid md:grid-cols-3 gap-4"></div>
    </div>

    <!-- Footer -->
    <div class="text-center mt-8 text-gray-600">
      <p class="text-sm">제작자: 장호준 코치</p>
      <p class="text-xs mt-1">© 2024 Athlete Time</p>
    </div>
  </div>

  <script>
    // Exact Daniels-Gilbert VDOT Formula
    function calculateExactVDOT(distanceMeters, timeSeconds) {
      const velocity = distanceMeters / (timeSeconds / 60);
      const time = timeSeconds / 60;
      
      const vo2 = -4.60 + 0.182258 * velocity + 0.000104 * Math.pow(velocity, 2);
      const percentVO2max = 0.8 + 0.1894393 * Math.exp(-0.012778 * time) + 
                            0.2989558 * Math.exp(-0.1932605 * time);
      
      const vdot = vo2 / percentVO2max;
      return Math.max(20, Math.min(90, vdot));
    }

    // Table-based VDOT (old method)
    const vdotTables = {
      30: { 800: 316, 1500: 681, 3000: 1520, 5000: 2680, 10000: 5560 },
      35: { 800: 279, 1500: 598, 3000: 1330, 5000: 2340, 10000: 4860 },
      40: { 800: 249, 1500: 532, 3000: 1178, 5000: 2070, 10000: 4290 },
      45: { 800: 224, 1500: 477, 3000: 1053, 5000: 1845, 10000: 3825 },
      50: { 800: 203, 1500: 431, 3000: 948, 5000: 1658, 10000: 3435 },
      55: { 800: 185, 1500: 392, 3000: 859, 5000: 1500, 10000: 3105 },
      60: { 800: 169, 1500: 357, 3000: 781, 5000: 1362, 10000: 2820 },
      65: { 800: 155, 1500: 327, 3000: 713, 5000: 1242, 10000: 2565 },
      70: { 800: 143, 1500: 301, 3000: 654, 5000: 1137, 10000: 2346 },
      75: { 800: 132, 1500: 277, 3000: 601, 5000: 1044, 10000: 2154 },
      80: { 800: 122, 1500: 256, 3000: 554, 5000: 961, 10000: 1983 }
    };

    function calculateTableVDOT(distanceMeters, timeSeconds) {
      let closestVDOT = 30;
      let minDiff = Infinity;
      
      for (const [vdot, times] of Object.entries(vdotTables)) {
        if (times[distanceMeters]) {
          const diff = Math.abs(times[distanceMeters] - timeSeconds);
          if (diff < minDiff) {
            minDiff = diff;
            closestVDOT = parseInt(vdot);
          }
        }
      }
      
      // Linear interpolation
      const vdotKeys = Object.keys(vdotTables).map(v => parseInt(v)).sort((a, b) => a - b);
      for (let i = 0; i < vdotKeys.length - 1; i++) {
        const lowerVDOT = vdotKeys[i];
        const upperVDOT = vdotKeys[i + 1];
        
        if (vdotTables[lowerVDOT][distanceMeters] && vdotTables[upperVDOT][distanceMeters]) {
          const lowerTime = vdotTables[lowerVDOT][distanceMeters];
          const upperTime = vdotTables[upperVDOT][distanceMeters];
          
          if (timeSeconds <= lowerTime && timeSeconds >= upperTime) {
            const ratio = (lowerTime - timeSeconds) / (lowerTime - upperTime);
            closestVDOT = lowerVDOT + (upperVDOT - lowerVDOT) * ratio;
            break;
          }
        }
      }
      
      return closestVDOT;
    }

    // Test cases
    const testCases = [
      { name: "Elite 1500m", distance: 1500, time: 210, expectedVDOT: 75 },
      { name: "Elite 5000m", distance: 5000, time: 780, expectedVDOT: 75 },
      { name: "Sub-Elite 1500m", distance: 1500, time: 240, expectedVDOT: 65 },
      { name: "Sub-Elite 10000m", distance: 10000, time: 1800, expectedVDOT: 65 },
      { name: "Advanced 800m", distance: 800, time: 120, expectedVDOT: 60 },
      { name: "Advanced 3000m", distance: 3000, time: 540, expectedVDOT: 60 },
      { name: "Intermediate 5000m", distance: 5000, time: 1200, expectedVDOT: 50 },
      { name: "Intermediate 1500m", distance: 1500, time: 300, expectedVDOT: 50 },
      { name: "Beginner 3000m", distance: 3000, time: 900, expectedVDOT: 40 },
      { name: "Beginner 800m", distance: 800, time: 180, expectedVDOT: 40 }
    ];

    function runTests() {
      const results = document.getElementById('testResults');
      const summary = document.getElementById('summary');
      
      let totalError = 0;
      let maxError = 0;
      let passCount = 0;
      
      testCases.forEach(test => {
        const exactVDOT = calculateExactVDOT(test.distance, test.time);
        const tableVDOT = calculateTableVDOT(test.distance, test.time);
        
        const exactError = Math.abs(exactVDOT - test.expectedVDOT);
        const tableError = Math.abs(tableVDOT - test.expectedVDOT);
        
        totalError += exactError;
        maxError = Math.max(maxError, exactError);
        
        const pass = exactError < 2; // Allow 2 VDOT points tolerance
        if (pass) passCount++;
        
        const resultDiv = document.createElement('div');
        resultDiv.className = 'p-3 bg-gray-50 rounded-lg';
        resultDiv.innerHTML = `
          <div class="font-semibold">${test.name} (${test.distance}m in ${test.time}s)</div>
          <div class="grid grid-cols-3 gap-4 text-sm mt-2">
            <div>Expected: <span class="font-bold">${test.expectedVDOT.toFixed(1)}</span></div>
            <div>Exact Formula: <span class="${pass ? 'pass' : 'fail'}">${exactVDOT.toFixed(1)}</span> (±${exactError.toFixed(1)})</div>
            <div>Table Method: <span>${tableVDOT.toFixed(1)}</span> (±${tableError.toFixed(1)})</div>
          </div>
        `;
        results.appendChild(resultDiv);
      });
      
      const avgError = totalError / testCases.length;
      const accuracy = (passCount / testCases.length * 100).toFixed(1);
      
      summary.innerHTML = `
        <div class="bg-green-50 p-4 rounded-lg">
          <div class="text-2xl font-bold text-green-700">${accuracy}%</div>
          <div class="text-sm text-gray-600">Test Pass Rate</div>
        </div>
        <div class="bg-blue-50 p-4 rounded-lg">
          <div class="text-2xl font-bold text-blue-700">${avgError.toFixed(2)}</div>
          <div class="text-sm text-gray-600">Average Error (VDOT)</div>
        </div>
        <div class="bg-purple-50 p-4 rounded-lg">
          <div class="text-2xl font-bold text-purple-700">${maxError.toFixed(2)}</div>
          <div class="text-sm text-gray-600">Maximum Error (VDOT)</div>
        </div>
      `;
    }

    // Run tests on page load
    document.addEventListener('DOMContentLoaded', runTests);
  </script>
</body>
</html>