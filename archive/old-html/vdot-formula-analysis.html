<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>VDOT ê³µì‹ ë¶„ì„ ë° ë¹„êµ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50 p-8">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold mb-8">ğŸ”¬ VDOT ê³„ì‚° ê³µì‹ ë¶„ì„</h1>
    
    <!-- ê³µì‹ ë¹„êµ -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
      <h2 class="text-xl font-bold mb-4 text-red-600">âš ï¸ ë°œê²¬ëœ ë¬¸ì œì </h2>
      
      <div class="grid md:grid-cols-2 gap-6">
        <!-- Daniels-Gilbert ì‹¤ì œ ê³µì‹ -->
        <div class="bg-blue-50 p-4 rounded-lg">
          <h3 class="font-bold mb-3">ğŸ“ Daniels-Gilbert ì›ë³¸ ê³µì‹</h3>
          <div class="bg-white p-3 rounded font-mono text-sm mb-3">
            VO2max = (VO2) / (%VO2max)<br><br>
            VO2 = -4.60 + 0.182258 Ã— v + 0.000104 Ã— vÂ²<br><br>
            %VO2max = 0.8 + 0.1894393 Ã— e^(-0.012778Ã—t) <br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ 0.2989558 Ã— e^(-0.1932605Ã—t)
          </div>
          <div class="text-sm text-gray-600">
            <p>â€¢ v = ì†ë„ (m/min)</p>
            <p>â€¢ t = ì‹œê°„ (ë¶„)</p>
            <p>â€¢ ì—°ì†ì ì¸ ê³¡ì„  í•¨ìˆ˜</p>
            <p>â€¢ ëª¨ë“  ê±°ë¦¬ì— ì ìš© ê°€ëŠ¥</p>
          </div>
        </div>
        
        <!-- í˜„ì¬ í…Œì´ë¸” ë°©ì‹ -->
        <div class="bg-orange-50 p-4 rounded-lg">
          <h3 class="font-bold mb-3">ğŸ“Š í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ í…Œì´ë¸” ë°©ì‹</h3>
          <div class="bg-white p-3 rounded font-mono text-sm mb-3">
            vdotTables = {<br>
            &nbsp;&nbsp;30: { 5000: 2680 },<br>
            &nbsp;&nbsp;35: { 5000: 2340 },<br>
            &nbsp;&nbsp;40: { 5000: 2070 },<br>
            &nbsp;&nbsp;...<br>
            }
          </div>
          <div class="text-sm text-gray-600">
            <p>â€¢ ê³ ì •ëœ VDOT ê°’ (5ë‹¨ìœ„)</p>
            <p>â€¢ íŠ¹ì • ê±°ë¦¬ë§Œ ì •ì˜</p>
            <p>â€¢ ì„ í˜• ë³´ê°„ ì‚¬ìš©</p>
            <p class="text-red-600 font-bold">â€¢ ì •í™•ë„ ì œí•œ</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ì°¨ì´ì  ë¶„ì„ -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
      <h2 class="text-xl font-bold mb-4">ğŸ“ˆ ê³„ì‚° ë°©ì‹ ì°¨ì´ ë¹„êµ</h2>
      
      <canvas id="vdotChart" class="mb-4"></canvas>
      
      <div class="grid md:grid-cols-3 gap-4 mt-6">
        <div class="bg-red-50 p-4 rounded-lg">
          <h4 class="font-bold text-red-600 mb-2">ë¬¸ì œ 1: ì •í™•ë„</h4>
          <p class="text-sm">í…Œì´ë¸”ì€ 5 ë‹¨ìœ„ë¡œë§Œ ì¡´ì¬<br>
          ì‹¤ì œ: VDOT 52.3 â†’ í…Œì´ë¸”: 50 ë˜ëŠ” 55</p>
        </div>
        <div class="bg-yellow-50 p-4 rounded-lg">
          <h4 class="font-bold text-yellow-600 mb-2">ë¬¸ì œ 2: ë³´ê°„ ì˜¤ì°¨</h4>
          <p class="text-sm">ì„ í˜• ë³´ê°„ vs ì§€ìˆ˜ í•¨ìˆ˜<br>
          ì¤‘ê°„ê°’ì—ì„œ ìµœëŒ€ 3-5% ì˜¤ì°¨</p>
        </div>
        <div class="bg-purple-50 p-4 rounded-lg">
          <h4 class="font-bold text-purple-600 mb-2">ë¬¸ì œ 3: ê±°ë¦¬ ì œí•œ</h4>
          <p class="text-sm">ì •ì˜ë˜ì§€ ì•Šì€ ê±°ë¦¬<br>
          (ì˜ˆ: 3000m ì¥ì• ë¬¼)</p>
        </div>
      </div>
    </div>

    <!-- ì‹¤ì œ ê³„ì‚°ê¸° -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
      <h2 class="text-xl font-bold mb-4">ğŸ”§ ì •í™•í•œ VDOT ê³„ì‚°ê¸°</h2>
      
      <div class="grid md:grid-cols-3 gap-4 mb-4">
        <div>
          <label class="block text-sm font-medium mb-1">ê±°ë¦¬ (m)</label>
          <input type="number" id="distance" value="5000" class="border rounded p-2 w-full">
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">ì‹œê°„ (ë¶„:ì´ˆ)</label>
          <input type="text" id="time" value="20:00" placeholder="ì˜ˆ: 20:00" class="border rounded p-2 w-full">
        </div>
        <div class="flex items-end">
          <button onclick="calculateExactVDOT()" class="bg-blue-500 text-white px-6 py-2 rounded w-full">
            ì •í™•í•œ VDOT ê³„ì‚°
          </button>
        </div>
      </div>
      
      <div id="comparisonResult"></div>
    </div>

    <!-- ì˜¤ì°¨ ë¶„ì„ -->
    <div class="bg-white rounded-xl shadow-lg p-6">
      <h2 class="text-xl font-bold mb-4">ğŸ“Š ì˜¤ì°¨ ë¶„ì„ ê²°ê³¼</h2>
      
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="bg-gray-100">
              <th class="p-2">ê±°ë¦¬</th>
              <th class="p-2">ê¸°ë¡</th>
              <th class="p-2">ì •í™•í•œ VDOT</th>
              <th class="p-2">í…Œì´ë¸” VDOT</th>
              <th class="p-2">ì˜¤ì°¨</th>
              <th class="p-2">ì˜í–¥</th>
            </tr>
          </thead>
          <tbody id="errorAnalysis"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // Daniels-Gilbert ì •í™•í•œ ê³µì‹
    function calculateExactVDOTFormula(distanceMeters, timeSeconds) {
      const velocity = distanceMeters / (timeSeconds / 60); // m/min
      const time = timeSeconds / 60; // minutes
      
      // VO2 ê³„ì‚° (ì‚°ì†Œ ì†Œë¹„ëŸ‰)
      const vo2 = -4.60 + 0.182258 * velocity + 0.000104 * Math.pow(velocity, 2);
      
      // %VO2max ê³„ì‚° (ì§€ì† ê°€ëŠ¥í•œ ë¹„ìœ¨)
      const percentVO2max = 0.8 + 
        0.1894393 * Math.exp(-0.012778 * time) + 
        0.2989558 * Math.exp(-0.1932605 * time);
      
      // VDOT = VO2 / %VO2max
      const vdot = vo2 / percentVO2max;
      
      return vdot;
    }
    
    // í˜„ì¬ í…Œì´ë¸” ë°©ì‹ (ê°„ì†Œí™”)
    const vdotTables = {
      30: { 800: 316, 1500: 681, 3000: 1520, 5000: 2680, 10000: 5560 },
      35: { 800: 279, 1500: 598, 3000: 1330, 5000: 2340, 10000: 4860 },
      40: { 800: 249, 1500: 532, 3000: 1178, 5000: 2070, 10000: 4290 },
      45: { 800: 224, 1500: 477, 3000: 1053, 5000: 1845, 10000: 3825 },
      50: { 800: 203, 1500: 431, 3000: 948, 5000: 1658, 10000: 3435 },
      55: { 800: 185, 1500: 392, 3000: 859, 5000: 1500, 10000: 3105 },
      60: { 800: 169, 1500: 357, 3000: 781, 5000: 1362, 10000: 2820 },
      65: { 800: 155, 1500: 327, 3000: 713, 5000: 1242, 10000: 2565 },
      70: { 800: 143, 1500: 301, 3000: 654, 5000: 1137, 10000: 2346 },
      75: { 800: 132, 1500: 277, 3000: 601, 5000: 1044, 10000: 2154 },
      80: { 800: 122, 1500: 256, 3000: 554, 5000: 961, 10000: 1983 }
    };
    
    function calculateTableVDOT(distanceMeters, timeSeconds) {
      let closestVDOT = 30;
      let minDiff = Infinity;
      
      for (const [vdot, times] of Object.entries(vdotTables)) {
        if (times[distanceMeters]) {
          const diff = Math.abs(times[distanceMeters] - timeSeconds);
          if (diff < minDiff) {
            minDiff = diff;
            closestVDOT = parseInt(vdot);
          }
        }
      }
      
      // ì„ í˜• ë³´ê°„
      const vdotKeys = Object.keys(vdotTables).map(v => parseInt(v)).sort((a, b) => a - b);
      for (let i = 0; i < vdotKeys.length - 1; i++) {
        const lowerVDOT = vdotKeys[i];
        const upperVDOT = vdotKeys[i + 1];
        
        if (vdotTables[lowerVDOT][distanceMeters] && vdotTables[upperVDOT][distanceMeters]) {
          const lowerTime = vdotTables[lowerVDOT][distanceMeters];
          const upperTime = vdotTables[upperVDOT][distanceMeters];
          
          if (timeSeconds <= lowerTime && timeSeconds >= upperTime) {
            const ratio = (lowerTime - timeSeconds) / (lowerTime - upperTime);
            closestVDOT = lowerVDOT + (upperVDOT - lowerVDOT) * ratio;
            break;
          }
        }
      }
      
      return Math.round(closestVDOT * 10) / 10;
    }
    
    function parseTime(timeStr) {
      const parts = timeStr.split(':').map(p => parseInt(p));
      if (parts.length === 2) {
        return parts[0] * 60 + parts[1];
      }
      return 0;
    }
    
    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }
    
    function calculateExactVDOT() {
      const distance = parseFloat(document.getElementById('distance').value);
      const timeStr = document.getElementById('time').value;
      const timeSeconds = parseTime(timeStr);
      
      if (!distance || !timeSeconds) {
        alert('ê±°ë¦¬ì™€ ì‹œê°„ì„ ì…ë ¥í•˜ì„¸ìš”');
        return;
      }
      
      const exactVDOT = calculateExactVDOTFormula(distance, timeSeconds);
      const tableVDOT = calculateTableVDOT(distance, timeSeconds);
      const difference = exactVDOT - tableVDOT;
      const percentError = (difference / exactVDOT) * 100;
      
      const html = `
        <div class="grid md:grid-cols-2 gap-4 mt-4">
          <div class="bg-green-50 p-4 rounded-lg">
            <h4 class="font-bold text-green-600">ì •í™•í•œ ê³µì‹ ê³„ì‚°</h4>
            <div class="text-2xl font-bold mt-2">${exactVDOT.toFixed(2)}</div>
            <div class="text-sm text-gray-600 mt-2">
              <p>ì†ë„: ${(distance / (timeSeconds / 60)).toFixed(1)} m/min</p>
              <p>VO2: ${(-4.60 + 0.182258 * (distance / (timeSeconds / 60)) + 0.000104 * Math.pow(distance / (timeSeconds / 60), 2)).toFixed(2)} ml/kg/min</p>
            </div>
          </div>
          <div class="bg-orange-50 p-4 rounded-lg">
            <h4 class="font-bold text-orange-600">í…Œì´ë¸” ë°©ì‹ ê³„ì‚°</h4>
            <div class="text-2xl font-bold mt-2">${tableVDOT.toFixed(1)}</div>
            <div class="text-sm text-gray-600 mt-2">
              <p class="${Math.abs(difference) > 1 ? 'text-red-600 font-bold' : ''}">
                ì˜¤ì°¨: ${difference > 0 ? '+' : ''}${difference.toFixed(2)} (${percentError.toFixed(1)}%)
              </p>
              <p>${Math.abs(difference) > 1 ? 'âš ï¸ ìƒë‹¹í•œ ì˜¤ì°¨ ë°œìƒ!' : 'âœ… í—ˆìš© ë²”ìœ„ ë‚´'}</p>
            </div>
          </div>
        </div>
        
        ${Math.abs(difference) > 1 ? `
        <div class="bg-red-50 border-l-4 border-red-400 p-4 mt-4 rounded">
          <h4 class="font-bold text-red-600 mb-2">ğŸš¨ ì˜¤ì°¨ë¡œ ì¸í•œ ì˜í–¥</h4>
          <div class="text-sm">
            <p>â€¢ ì˜ëª»ëœ í›ˆë ¨ í˜ì´ìŠ¤: ì•½ ${Math.abs(difference * 2).toFixed(0)}ì´ˆ/km ì°¨ì´</p>
            <p>â€¢ ë¶€ì •í™•í•œ ëª©í‘œ ì„¤ì •: ${Math.abs(percentError).toFixed(1)}% ì˜¤ì°¨</p>
            <p>â€¢ ${difference > 0 ? 'ê³¼ì†Œí‰ê°€ëœ ëŠ¥ë ¥ (ë„ˆë¬´ ì‰¬ìš´ í›ˆë ¨)' : 'ê³¼ëŒ€í‰ê°€ëœ ëŠ¥ë ¥ (ë„ˆë¬´ í˜ë“  í›ˆë ¨)'}</p>
          </div>
        </div>` : ''}
      `;
      
      document.getElementById('comparisonResult').innerHTML = html;
    }
    
    // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
    function drawComparisonChart() {
      const ctx = document.getElementById('vdotChart').getContext('2d');
      
      // 5000m ê¸°ì¤€ ë°ì´í„° ìƒì„±
      const times = [];
      const exactVDOTs = [];
      const tableVDOTs = [];
      
      for (let seconds = 900; seconds <= 2100; seconds += 60) { // 15ë¶„ ~ 35ë¶„
        times.push(formatTime(seconds));
        exactVDOTs.push(calculateExactVDOTFormula(5000, seconds));
        tableVDOTs.push(calculateTableVDOT(5000, seconds));
      }
      
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: times,
          datasets: [{
            label: 'ì •í™•í•œ ê³µì‹',
            data: exactVDOTs,
            borderColor: 'rgb(34, 197, 94)',
            backgroundColor: 'rgba(34, 197, 94, 0.1)',
            tension: 0.4
          }, {
            label: 'í…Œì´ë¸” ë°©ì‹',
            data: tableVDOTs,
            borderColor: 'rgb(251, 146, 60)',
            backgroundColor: 'rgba(251, 146, 60, 0.1)',
            tension: 0.1,
            borderDash: [5, 5]
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: '5000m ê¸°ë¡ë³„ VDOT ê³„ì‚° ë¹„êµ'
            },
            legend: {
              position: 'top',
            }
          },
          scales: {
            y: {
              title: {
                display: true,
                text: 'VDOT'
              }
            },
            x: {
              title: {
                display: true,
                text: '5000m ê¸°ë¡'
              }
            }
          }
        }
      });
    }
    
    // ì˜¤ì°¨ ë¶„ì„ í…Œì´ë¸”
    function analyzeErrors() {
      const testCases = [
        { distance: 800, time: 150, desc: '800m 2:30' },
        { distance: 1500, time: 270, desc: '1500m 4:30' },
        { distance: 3000, time: 600, desc: '3000m 10:00' },
        { distance: 5000, time: 1110, desc: '5000m 18:30' },
        { distance: 10000, time: 2400, desc: '10000m 40:00' },
        { distance: 21097.5, time: 5400, desc: 'í•˜í”„ 1:30:00' },
        { distance: 42195, time: 12600, desc: 'í’€ë§ˆë¼í†¤ 3:30:00' }
      ];
      
      let html = '';
      testCases.forEach(test => {
        const exactVDOT = calculateExactVDOTFormula(test.distance, test.time);
        const tableVDOT = calculateTableVDOT(test.distance, test.time);
        const difference = exactVDOT - tableVDOT;
        const percentError = (difference / exactVDOT) * 100;
        
        const impact = Math.abs(percentError) > 3 ? 'ë†’ìŒ' : 
                      Math.abs(percentError) > 1 ? 'ì¤‘ê°„' : 'ë‚®ìŒ';
        const impactColor = impact === 'ë†’ìŒ' ? 'text-red-600' : 
                           impact === 'ì¤‘ê°„' ? 'text-yellow-600' : 'text-green-600';
        
        html += `
          <tr class="border-b hover:bg-gray-50">
            <td class="p-2">${test.desc.split(' ')[0]}</td>
            <td class="p-2">${test.desc.split(' ')[1]}</td>
            <td class="p-2 font-bold">${exactVDOT.toFixed(2)}</td>
            <td class="p-2">${tableVDOT.toFixed(1)}</td>
            <td class="p-2 ${Math.abs(percentError) > 3 ? 'text-red-600 font-bold' : ''}">
              ${percentError > 0 ? '+' : ''}${percentError.toFixed(1)}%
            </td>
            <td class="p-2 ${impactColor} font-bold">${impact}</td>
          </tr>
        `;
      });
      
      document.getElementById('errorAnalysis').innerHTML = html;
    }
    
    // ì´ˆê¸°í™”
    window.addEventListener('DOMContentLoaded', () => {
      drawComparisonChart();
      analyzeErrors();
      calculateExactVDOT(); // ê¸°ë³¸ê°’ìœ¼ë¡œ ê³„ì‚°
    });
  </script>
</body>
</html>