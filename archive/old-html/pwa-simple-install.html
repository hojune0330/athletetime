<!-- PWA 설치 UI - 모든 HTML 페이지 body 태그 직후에 붙여넣기 -->

<!-- 상단 고정 배너 -->
<div id="pwaInstallBanner" style="display: none; position: fixed; top: 0; left: 0; right: 0; background: linear-gradient(135deg, #00ffa3, #00d4ff); color: #0f0f0f; padding: 12px 20px; z-index: 10000; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
  <div style="max-width: 1200px; margin: 0 auto; display: flex; align-items: center; gap: 12px; justify-content: space-between; flex-wrap: wrap;">
    <div style="display: flex; align-items: center; gap: 12px; flex: 1; min-width: 200px;">
      <span style="font-size: 24px;">📱</span>
      <div>
        <div style="font-weight: 700; font-size: 0.95rem;">애슬리트 타임 앱으로 설치!</div>
        <div style="font-size: 0.8rem; opacity: 0.9;">홈 화면에 추가하세요</div>
      </div>
    </div>
    <button id="pwaInstallBtn" style="background: #0f172a; color: #00ffa3; border: none; padding: 10px 20px; border-radius: 8px; font-weight: 700; cursor: pointer; white-space: nowrap; margin-right: 8px;">지금 설치</button>
    <button id="pwaCloseBanner" style="background: rgba(15,23,42,0.2); border: none; color: #0f0f0f; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; font-size: 20px; font-weight: bold;">×</button>
  </div>
</div>

<!-- 우측 하단 플로팅 버튼 -->
<button id="pwaFloatingBtn" style="display: none; position: fixed; bottom: 20px; right: 20px; background: linear-gradient(135deg, #00ffa3, #00d4ff); color: #0f0f0f; border: none; padding: 14px 24px; border-radius: 50px; font-weight: 700; font-size: 0.95rem; cursor: pointer; box-shadow: 0 8px 24px rgba(0,255,163,0.5); z-index: 9999;">
  📱 앱 설치
</button>

<style>
@keyframes pwaPulse {
  0%, 100% { box-shadow: 0 8px 24px rgba(0,255,163,0.4); }
  50% { box-shadow: 0 8px 32px rgba(0,255,163,0.7); }
}
#pwaFloatingBtn {
  animation: pwaPulse 2s infinite;
}
#pwaFloatingBtn:hover {
  transform: translateY(-2px);
}
</style>

<script>
// PWA 설치 스크립트
(function() {
  let deferredPrompt;
  const banner = document.getElementById('pwaInstallBanner');
  const floatingBtn = document.getElementById('pwaFloatingBtn');
  const installBtn = document.getElementById('pwaInstallBtn');
  const closeBtn = document.getElementById('pwaCloseBanner');
  
  if (!banner || !floatingBtn) return;
  
  const isInstalled = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;
  if (isInstalled) {
    console.log('✅ PWA 이미 설치됨');
    return;
  }
  
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    showUI();
  });
  
  setTimeout(() => showUI(), 1500);
  
  function showUI() {
    const dismissed = localStorage.getItem('pwa-banner-dismissed');
    if (dismissed && (Date.now() - parseInt(dismissed)) / 3600000 < 24) return;
    banner.style.display = 'block';
    floatingBtn.style.display = 'block';
  }
  
  async function handleInstall() {
    const isIOS = /iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase());
    
    if (isIOS) {
      alert('📱 iOS 설치 방법:\n\n1. 하단 중앙의 공유 버튼(□↑)을 탭하세요\n2. "홈 화면에 추가"를 선택하세요\n3. "추가" 버튼을 탭하세요\n\n홈 화면에 앱 아이콘이 생성됩니다!');
    } else if (deferredPrompt) {
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      if (outcome === 'accepted') hideUI();
      deferredPrompt = null;
    } else {
      alert('💻 설치 방법:\n\n1. 브라우저 메뉴(⋮)를 여세요\n2. "홈 화면에 추가" 또는 "설치"를 선택하세요\n\n앱처럼 사용할 수 있습니다!');
    }
  }
  
  function hideUI() {
    banner.style.display = 'none';
    floatingBtn.style.display = 'none';
  }
  
  if (installBtn) installBtn.onclick = handleInstall;
  if (floatingBtn) floatingBtn.onclick = handleInstall;
  if (closeBtn) closeBtn.onclick = () => {
    hideUI();
    localStorage.setItem('pwa-banner-dismissed', Date.now().toString());
  };
  
  window.addEventListener('appinstalled', hideUI);
  console.log('✅ PWA 설치 UI 준비 완료');
})();
</script>
