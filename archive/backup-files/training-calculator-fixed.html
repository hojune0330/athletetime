<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>전문 훈련 페이스 계산기 | Athlete Time</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', '맑은 고딕', sans-serif;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .training-zone-easy { 
      background: linear-gradient(135deg, #10b981, #059669); 
    }
    .training-zone-marathon { 
      background: linear-gradient(135deg, #3b82f6, #2563eb); 
    }
    .training-zone-threshold { 
      background: linear-gradient(135deg, #f59e0b, #d97706); 
    }
    .training-zone-interval { 
      background: linear-gradient(135deg, #ef4444, #dc2626); 
    }
    .training-zone-repetition { 
      background: linear-gradient(135deg, #a855f7, #9333ea); 
    }
    
    .phase-card {
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .phase-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }
    
    .intensity-low { 
      border-left: 4px solid #10b981; 
      background: linear-gradient(to right, rgba(16, 185, 129, 0.05), transparent);
    }
    .intensity-medium { 
      border-left: 4px solid #3b82f6; 
      background: linear-gradient(to right, rgba(59, 130, 246, 0.05), transparent);
    }
    .intensity-high { 
      border-left: 4px solid #ef4444; 
      background: linear-gradient(to right, rgba(239, 68, 68, 0.05), transparent);
    }
    .intensity-rest { 
      border-left: 4px solid #6b7280; 
      background: linear-gradient(to right, rgba(107, 114, 128, 0.05), transparent);
    }
  </style>
</head>
<body class="bg-gray-50">
  <div class="max-w-7xl mx-auto p-6">
    <!-- Header -->
    <div class="gradient-bg text-white p-6 rounded-xl mb-6">
      <div class="flex justify-between items-start">
        <div>
          <h1 class="text-3xl font-bold mb-2">전문 훈련 페이스 계산기</h1>
          <p class="opacity-90">Jack Daniels VDOT 시스템 기반 과학적 훈련</p>
        </div>
        <button onclick="window.location.href='index.html'" class="bg-white/20 hover:bg-white/30 p-3 rounded-lg transition">
          <i class="fas fa-home text-xl"></i>
        </button>
      </div>
    </div>

    <!-- Step 1: Athlete Profile -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
      <h2 class="text-2xl font-bold mb-6 flex items-center">
        <span class="bg-purple-100 text-purple-600 w-10 h-10 rounded-full flex items-center justify-center mr-3">1</span>
        선수 프로필 설정
      </h2>
      
      <div class="grid md:grid-cols-3 gap-6">
        <!-- Basic Info -->
        <div>
          <h3 class="font-semibold mb-3 text-gray-700">기본 정보</h3>
          
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">성별</label>
            <div class="grid grid-cols-2 gap-2">
              <button onclick="selectGender('male')" id="btn-male" 
                class="p-3 border-2 rounded-lg transition text-center hover:border-purple-500">
                <i class="fas fa-mars text-blue-500 text-xl"></i>
                <div class="text-sm mt-1">남성</div>
              </button>
              <button onclick="selectGender('female')" id="btn-female"
                class="p-3 border-2 rounded-lg transition text-center hover:border-purple-500">
                <i class="fas fa-venus text-pink-500 text-xl"></i>
                <div class="text-sm mt-1">여성</div>
              </button>
            </div>
          </div>
          
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">연령대</label>
            <select id="ageGroup" class="w-full p-2 border rounded-lg">
              <option value="junior">주니어 (18세 이하)</option>
              <option value="senior" selected>시니어 (19-39세)</option>
              <option value="master40">마스터즈 40+ (40-49세)</option>
              <option value="master50">마스터즈 50+ (50-59세)</option>
              <option value="master60">마스터즈 60+ (60세 이상)</option>
            </select>
          </div>
        </div>

        <!-- Training Level -->
        <div>
          <h3 class="font-semibold mb-3 text-gray-700">훈련 수준</h3>
          
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">경력</label>
            <select id="experience" class="w-full p-2 border rounded-lg">
              <option value="beginner">초급 (1년 미만)</option>
              <option value="intermediate" selected>중급 (1-3년)</option>
              <option value="advanced">고급 (3-5년)</option>
              <option value="elite">엘리트 (5년 이상)</option>
            </select>
          </div>
          
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">주간 훈련량</label>
            <select id="weeklyVolume" class="w-full p-2 border rounded-lg">
              <option value="low">30km 이하</option>
              <option value="moderate" selected>30-60km</option>
              <option value="high">60-100km</option>
              <option value="very-high">100km 이상</option>
            </select>
          </div>
        </div>

        <!-- Training Pattern -->
        <div>
          <h3 class="font-semibold mb-3 text-gray-700">훈련 패턴</h3>
          
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">훈련 빈도</label>
            <select id="frequency" class="w-full p-2 border rounded-lg">
              <option value="3-4">주 3-4회</option>
              <option value="5-6" selected>주 5-6회</option>
              <option value="7">주 7회</option>
              <option value="double">2회/일 (엘리트)</option>
            </select>
          </div>
          
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">현재 훈련 단계</label>
            <select id="trainingPhase" class="w-full p-2 border rounded-lg">
              <option value="base">기초 체력기</option>
              <option value="build" selected>전문 체력기</option>
              <option value="peak">피킹 단계</option>
              <option value="taper">테이퍼링</option>
              <option value="recovery">회복기</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Step 2: Performance Input -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
      <h2 class="text-2xl font-bold mb-6 flex items-center">
        <span class="bg-purple-100 text-purple-600 w-10 h-10 rounded-full flex items-center justify-center mr-3">2</span>
        기준 기록 입력
      </h2>
      
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <label class="block text-sm font-medium mb-2">종목 선택</label>
          <select id="eventDistance" class="w-full p-3 border rounded-lg mb-4">
            <option value="">종목을 선택하세요</option>
            <option value="800">800m</option>
            <option value="1500">1500m (1.5km)</option>
            <option value="3000">3000m (3km)</option>
            <option value="5000">5000m (5km)</option>
            <option value="10000">10000m (10km)</option>
            <option value="21097.5">하프마라톤 (21.0975km)</option>
            <option value="42195">풀마라톤 (42.195km)</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">기록 입력</label>
          <div class="grid grid-cols-3 gap-2">
            <input type="number" id="hours" placeholder="시" min="0" max="23" 
              class="p-3 border rounded-lg text-center">
            <input type="number" id="minutes" placeholder="분" min="0" max="59" 
              class="p-3 border rounded-lg text-center">
            <input type="number" id="seconds" placeholder="초" min="0" max="59" step="0.1"
              class="p-3 border rounded-lg text-center">
          </div>
        </div>
      </div>
      
      <button onclick="calculateTraining()" 
        class="mt-6 bg-gradient-to-r from-purple-600 to-pink-600 text-white px-8 py-3 rounded-lg font-semibold hover:shadow-lg transition">
        <i class="fas fa-calculator mr-2"></i>훈련 계획 생성
      </button>
    </div>

    <!-- Step 3: Special Conditions -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
      <h2 class="text-2xl font-bold mb-6 flex items-center">
        <span class="bg-purple-100 text-purple-600 w-10 h-10 rounded-full flex items-center justify-center mr-3">3</span>
        특별 고려사항 (선택)
      </h2>
      
      <div class="grid md:grid-cols-3 gap-4">
        <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer">
          <input type="checkbox" id="injury_recovery" class="mr-3 w-5 h-5">
          <div>
            <div class="font-medium">부상 회복중</div>
            <div class="text-xs text-gray-600">훈련량 60%, 강도 70%</div>
          </div>
        </label>
        
        <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer">
          <input type="checkbox" id="high_fatigue" class="mr-3 w-5 h-5">
          <div>
            <div class="font-medium">피로 누적</div>
            <div class="text-xs text-gray-600">회복 위주 프로그램</div>
          </div>
        </label>
        
        <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer">
          <input type="checkbox" id="altitude" class="mr-3 w-5 h-5">
          <div>
            <div class="font-medium">고지대 훈련</div>
            <div class="text-xs text-gray-600">페이스 3% 조정</div>
          </div>
        </label>
        
        <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer">
          <input type="checkbox" id="hot_weather" class="mr-3 w-5 h-5">
          <div>
            <div class="font-medium">고온다습 환경</div>
            <div class="text-xs text-gray-600">페이스 5% 조정</div>
          </div>
        </label>
        
        <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer">
          <input type="checkbox" id="weight_loss" class="mr-3 w-5 h-5">
          <div>
            <div class="font-medium">체중 감량 목표</div>
            <div class="text-xs text-gray-600">유산소 비중 증가</div>
          </div>
        </label>
        
        <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer">
          <input type="checkbox" id="morning_only" class="mr-3 w-5 h-5">
          <div>
            <div class="font-medium">아침 훈련만 가능</div>
            <div class="text-xs text-gray-600">워밍업 시간 증가</div>
          </div>
        </label>
      </div>
    </div>

    <!-- Results Section -->
    <div id="resultsSection" class="hidden">
      <!-- VDOT Score -->
      <div class="bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl p-6 mb-6">
        <div class="grid md:grid-cols-3 gap-6">
          <div class="text-center">
            <div class="text-5xl font-bold" id="vdotScore">--</div>
            <div class="text-sm opacity-90 mt-1">VDOT 점수</div>
            <div class="text-xs opacity-75 mt-1" id="vdotAdjustment"></div>
          </div>
          <div class="text-center">
            <div class="text-3xl font-semibold" id="performanceLevel">--</div>
            <div class="text-sm opacity-90 mt-1">수준 평가</div>
          </div>
          <div class="text-center">
            <div class="text-2xl" id="predictedVO2max">--</div>
            <div class="text-sm opacity-90 mt-1">예상 VO₂max (ml/kg/min)</div>
          </div>
        </div>
      </div>

      <!-- Training Zones -->
      <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
        <h3 class="text-xl font-bold mb-4">훈련 구역별 페이스</h3>
        
        <div class="space-y-3">
          <!-- Easy Zone -->
          <div class="training-zone-easy text-white p-4 rounded-lg">
            <div class="flex justify-between items-center">
              <div>
                <div class="font-bold text-lg">Easy (E) - 회복/기초지구력</div>
                <div class="text-sm opacity-90">최대심박수의 65-79% | 편안한 대화 가능</div>
              </div>
              <div class="text-2xl font-bold" id="easyPace">--</div>
            </div>
          </div>
          
          <!-- Marathon Zone -->
          <div class="training-zone-marathon text-white p-4 rounded-lg">
            <div class="flex justify-between items-center">
              <div>
                <div class="font-bold text-lg">Marathon (M) - 마라톤 페이스</div>
                <div class="text-sm opacity-90">최대심박수의 80-85% | 2-3시간 유지 가능</div>
              </div>
              <div class="text-2xl font-bold" id="marathonPace">--</div>
            </div>
          </div>
          
          <!-- Threshold Zone -->
          <div class="training-zone-threshold text-white p-4 rounded-lg">
            <div class="flex justify-between items-center">
              <div>
                <div class="font-bold text-lg">Threshold (T) - 젖산역치</div>
                <div class="text-sm opacity-90">최대심박수의 85-88% | 20-60분 유지 가능</div>
              </div>
              <div class="text-2xl font-bold" id="thresholdPace">--</div>
            </div>
          </div>
          
          <!-- Interval Zone -->
          <div class="training-zone-interval text-white p-4 rounded-lg">
            <div class="flex justify-between items-center">
              <div>
                <div class="font-bold text-lg">Interval (I) - VO₂max 향상</div>
                <div class="text-sm opacity-90">최대심박수의 95-100% | 3-8분 반복</div>
              </div>
              <div class="text-2xl font-bold" id="intervalPace">--</div>
            </div>
          </div>
          
          <!-- Repetition Zone -->
          <div class="training-zone-repetition text-white p-4 rounded-lg">
            <div class="flex justify-between items-center">
              <div>
                <div class="font-bold text-lg">Repetition (R) - 스피드/폼</div>
                <div class="text-sm opacity-90">최대 스피드의 95%+ | 완전 회복 필요</div>
              </div>
              <div class="text-2xl font-bold" id="repetitionPace">--</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Weekly Plan -->
      <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
        <h3 class="text-xl font-bold mb-4">주간 마이크로사이클 (7일)</h3>
        <div id="weeklyPlan" class="grid md:grid-cols-7 gap-2">
          <!-- Weekly plan will be inserted here -->
        </div>
      </div>

      <!-- Mesocycle Plan -->
      <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
        <h3 class="text-xl font-bold mb-4">메조사이클 (4주 블록)</h3>
        <div id="mesocyclePlan" class="grid md:grid-cols-4 gap-4">
          <!-- 4-week mesocycle will be inserted here -->
        </div>
      </div>

      <!-- Specific Workouts -->
      <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
        <h3 class="text-xl font-bold mb-4">핵심 훈련 세션</h3>
        <div id="workoutDetails" class="grid md:grid-cols-2 gap-4">
          <!-- Detailed workouts will be inserted here -->
        </div>
      </div>

      <!-- Recommendations -->
      <div class="bg-white rounded-xl shadow-lg p-6">
        <h3 class="text-xl font-bold mb-4">전문가 권장사항</h3>
        <div id="recommendations" class="grid md:grid-cols-2 gap-4">
          <!-- Recommendations will be inserted here -->
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="text-center mt-8 text-gray-600">
      <p class="text-sm">제작자: 장호준 코치</p>
      <p class="text-xs mt-1">© 2024 Athlete Time - 과학적 훈련의 시작</p>
    </div>
  </div>

  <script>
    // User profile
    let userProfile = {
      gender: null,
      ageGroup: null,
      experience: null,
      weeklyVolume: null,
      frequency: null,
      trainingPhase: null,
      conditions: {},
      vdot: 0,
      adjustments: {
        pace: 1.0,
        volume: 1.0,
        intensity: 1.0
      }
    };

    // VDOT tables based on Jack Daniels' Running Formula (거리(m): 시간(초))
    const vdotTables = {
      30: { 800: 316, 1500: 681, 3000: 1520, 5000: 2680, 10000: 5560, 21097.5: 12240, 42195: 25380 },
      35: { 800: 279, 1500: 598, 3000: 1330, 5000: 2340, 10000: 4860, 21097.5: 10680, 42195: 22140 },
      40: { 800: 249, 1500: 532, 3000: 1178, 5000: 2070, 10000: 4290, 21097.5: 9420, 42195: 19500 },
      45: { 800: 224, 1500: 477, 3000: 1053, 5000: 1845, 10000: 3825, 21097.5: 8400, 42195: 17400 },
      50: { 800: 203, 1500: 431, 3000: 948, 5000: 1658, 10000: 3435, 21097.5: 7530, 42195: 15600 },
      55: { 800: 185, 1500: 392, 3000: 859, 5000: 1500, 10000: 3105, 21097.5: 6810, 42195: 14100 },
      60: { 800: 169, 1500: 357, 3000: 781, 5000: 1362, 10000: 2820, 21097.5: 6180, 42195: 12780 },
      65: { 800: 155, 1500: 327, 3000: 713, 5000: 1242, 10000: 2565, 21097.5: 5625, 42195: 11625 },
      70: { 800: 143, 1500: 301, 3000: 654, 5000: 1137, 10000: 2346, 21097.5: 5145, 42195: 10620 },
      75: { 800: 132, 1500: 277, 3000: 601, 5000: 1044, 10000: 2154, 21097.5: 4725, 42195: 9750 },
      80: { 800: 122, 1500: 256, 3000: 554, 5000: 961, 10000: 1983, 21097.5: 4350, 42195: 8970 },
      85: { 800: 113, 1500: 237, 3000: 512, 5000: 888, 10000: 1830, 21097.5: 4020, 42195: 8280 }
    };

    function selectGender(gender) {
      userProfile.gender = gender;
      
      // Update UI
      document.getElementById('btn-male').classList.remove('border-purple-500', 'bg-purple-50');
      document.getElementById('btn-female').classList.remove('border-purple-500', 'bg-purple-50');
      
      if (gender === 'male') {
        document.getElementById('btn-male').classList.add('border-purple-500', 'bg-purple-50');
      } else {
        document.getElementById('btn-female').classList.add('border-purple-500', 'bg-purple-50');
      }
    }

    function calculateVDOT(distanceMeters, timeSeconds) {
      // Find closest VDOT value
      let closestVDOT = 30;
      let minDiff = Infinity;
      
      for (const [vdot, times] of Object.entries(vdotTables)) {
        if (times[distanceMeters]) {
          const diff = Math.abs(times[distanceMeters] - timeSeconds);
          if (diff < minDiff) {
            minDiff = diff;
            closestVDOT = parseInt(vdot);
          }
        }
      }
      
      // Interpolate for more accuracy
      const vdotKeys = Object.keys(vdotTables).map(v => parseInt(v)).sort((a, b) => a - b);
      for (let i = 0; i < vdotKeys.length - 1; i++) {
        const lowerVDOT = vdotKeys[i];
        const upperVDOT = vdotKeys[i + 1];
        
        if (vdotTables[lowerVDOT][distanceMeters] && vdotTables[upperVDOT][distanceMeters]) {
          const lowerTime = vdotTables[lowerVDOT][distanceMeters];
          const upperTime = vdotTables[upperVDOT][distanceMeters];
          
          if (timeSeconds <= lowerTime && timeSeconds >= upperTime) {
            const ratio = (lowerTime - timeSeconds) / (lowerTime - upperTime);
            closestVDOT = lowerVDOT + (upperVDOT - lowerVDOT) * ratio;
            break;
          }
        }
      }
      
      return Math.round(closestVDOT * 10) / 10;
    }

    function calculateTrainingPaces(vdot) {
      // Jack Daniels 공식 VDOT 페이스 테이블 (초/km)
      const vdotPaceTable = {
        30: { easy: { min: 417, max: 458 }, marathon: 374, threshold: 354, interval: 320, repetition: 296 },
        35: { easy: { min: 372, max: 409 }, marathon: 333, threshold: 315, interval: 285, repetition: 264 },
        40: { easy: { min: 337, max: 370 }, marathon: 301, threshold: 285, interval: 258, repetition: 239 },
        45: { easy: { min: 308, max: 339 }, marathon: 275, threshold: 260, interval: 236, repetition: 218 },
        50: { easy: { min: 284, max: 312 }, marathon: 253, threshold: 239, interval: 217, repetition: 201 },
        55: { easy: { min: 263, max: 290 }, marathon: 235, threshold: 222, interval: 201, repetition: 186 },
        60: { easy: { min: 246, max: 270 }, marathon: 219, threshold: 207, interval: 188, repetition: 174 },
        65: { easy: { min: 230, max: 253 }, marathon: 205, threshold: 194, interval: 176, repetition: 163 },
        70: { easy: { min: 217, max: 238 }, marathon: 193, threshold: 182, interval: 165, repetition: 153 },
        75: { easy: { min: 205, max: 225 }, marathon: 182, threshold: 172, interval: 156, repetition: 144 },
        80: { easy: { min: 194, max: 213 }, marathon: 172, threshold: 163, interval: 148, repetition: 137 },
        85: { easy: { min: 185, max: 203 }, marathon: 164, threshold: 155, interval: 140, repetition: 130 }
      };
      
      // VDOT 값에 가장 가까운 테이블 값 찾기 및 보간
      const vdotKeys = Object.keys(vdotPaceTable).map(k => parseInt(k)).sort((a, b) => a - b);
      let lowerVdot = 30, upperVdot = 30;
      
      for (let i = 0; i < vdotKeys.length - 1; i++) {
        if (vdot >= vdotKeys[i] && vdot <= vdotKeys[i + 1]) {
          lowerVdot = vdotKeys[i];
          upperVdot = vdotKeys[i + 1];
          break;
        }
      }
      
      if (vdot < 30) {
        lowerVdot = upperVdot = 30;
      } else if (vdot > 85) {
        lowerVdot = upperVdot = 85;
      }
      
      // 선형 보간으로 정확한 페이스 계산
      let paces;
      if (lowerVdot === upperVdot) {
        paces = JSON.parse(JSON.stringify(vdotPaceTable[lowerVdot]));
      } else {
        const ratio = (vdot - lowerVdot) / (upperVdot - lowerVdot);
        const lowerPaces = vdotPaceTable[lowerVdot];
        const upperPaces = vdotPaceTable[upperVdot];
        
        paces = {
          easy: {
            min: Math.round(lowerPaces.easy.min - (lowerPaces.easy.min - upperPaces.easy.min) * ratio),
            max: Math.round(lowerPaces.easy.max - (lowerPaces.easy.max - upperPaces.easy.max) * ratio)
          },
          marathon: Math.round(lowerPaces.marathon - (lowerPaces.marathon - upperPaces.marathon) * ratio),
          threshold: Math.round(lowerPaces.threshold - (lowerPaces.threshold - upperPaces.threshold) * ratio),
          interval: Math.round(lowerPaces.interval - (lowerPaces.interval - upperPaces.interval) * ratio),
          repetition: Math.round(lowerPaces.repetition - (lowerPaces.repetition - upperPaces.repetition) * ratio)
        };
      }
      
      // 조건에 따른 조정 적용
      const adj = userProfile.adjustments.pace;
      if (adj !== 1.0) {
        Object.keys(paces).forEach(key => {
          if (key === 'easy') {
            paces.easy.min = Math.round(paces.easy.min * adj);
            paces.easy.max = Math.round(paces.easy.max * adj);
          } else {
            paces[key] = Math.round(paces[key] * adj);
          }
        });
      }
      
      return paces;
    }

    function formatPace(secondsPerKm) {
      const minutes = Math.floor(secondsPerKm / 60);
      const seconds = Math.floor(secondsPerKm % 60);
      return `${minutes}:${seconds.toString().padStart(2, '0')}/km`;
    }

    function getPerformanceLevel(vdot) {
      if (vdot >= 75) return "엘리트";
      if (vdot >= 65) return "준엘리트";
      if (vdot >= 55) return "상급자";
      if (vdot >= 45) return "중급자";
      if (vdot >= 35) return "초급자";
      return "입문자";
    }

    function calculateAdjustments() {
      // Reset adjustments
      userProfile.adjustments = {
        pace: 1.0,
        volume: 1.0,
        intensity: 1.0
      };
      
      // Age group adjustments
      switch(userProfile.ageGroup) {
        case 'junior':
          userProfile.adjustments.volume *= 0.8;
          userProfile.adjustments.intensity *= 0.9;
          break;
        case 'master40':
          userProfile.adjustments.pace *= 1.02;
          userProfile.adjustments.volume *= 0.95;
          break;
        case 'master50':
          userProfile.adjustments.pace *= 1.05;
          userProfile.adjustments.volume *= 0.9;
          break;
        case 'master60':
          userProfile.adjustments.pace *= 1.08;
          userProfile.adjustments.volume *= 0.85;
          userProfile.adjustments.intensity *= 0.9;
          break;
      }
      
      // Experience level adjustments (중급자는 조정 없음)
      switch(userProfile.experience) {
        case 'beginner':
          userProfile.adjustments.volume *= 0.7;
          userProfile.adjustments.intensity *= 0.85;
          break;
        case 'advanced':
          userProfile.adjustments.volume *= 1.1;
          userProfile.adjustments.intensity *= 1.05;
          break;
        case 'elite':
          userProfile.adjustments.volume *= 1.2;
          userProfile.adjustments.intensity *= 1.1;
          break;
      }
      
      // Training phase adjustments
      switch(userProfile.trainingPhase) {
        case 'base':
          userProfile.adjustments.volume *= 1.1;
          userProfile.adjustments.intensity *= 0.85;
          break;
        case 'peak':
          userProfile.adjustments.volume *= 0.9;
          userProfile.adjustments.intensity *= 1.1;
          break;
        case 'taper':
          userProfile.adjustments.volume *= 0.5;
          userProfile.adjustments.intensity *= 1.0; // 강도 유지
          break;
        case 'recovery':
          userProfile.adjustments.volume *= 0.6;
          userProfile.adjustments.intensity *= 0.7;
          break;
      }
      
      // Special conditions
      if (document.getElementById('injury_recovery').checked) {
        userProfile.adjustments.volume *= 0.6;
        userProfile.adjustments.intensity *= 0.7;
        userProfile.adjustments.pace *= 1.1;
      }
      
      if (document.getElementById('high_fatigue').checked) {
        userProfile.adjustments.volume *= 0.8;
        userProfile.adjustments.intensity *= 0.85;
      }
      
      if (document.getElementById('altitude').checked) {
        userProfile.adjustments.pace *= 1.03;
        userProfile.adjustments.intensity *= 0.9;
      }
      
      if (document.getElementById('hot_weather').checked) {
        userProfile.adjustments.pace *= 1.05;
      }
    }

    function generateWeeklyPlan(vdot) {
      const weeklyPlan = document.getElementById('weeklyPlan');
      const frequency = document.getElementById('frequency').value;
      const phase = document.getElementById('trainingPhase').value;
      
      let days = [];
      
      // Generate appropriate weekly plan based on frequency and phase
      if (frequency === '3-4') {
        days = [
          { day: '월', type: 'Easy', intensity: 'intensity-low', duration: '40-50분', description: 'E 페이스 회복런' },
          { day: '화', type: 'Rest', intensity: 'intensity-rest', duration: '휴식', description: '완전 휴식 또는 크로스트레이닝' },
          { day: '수', type: 'Interval', intensity: 'intensity-high', duration: '45분', description: '400m x 6-8 @ I 페이스' },
          { day: '목', type: 'Rest', intensity: 'intensity-rest', duration: '휴식', description: '완전 휴식' },
          { day: '금', type: 'Tempo', intensity: 'intensity-medium', duration: '35분', description: '20분 T 페이스' },
          { day: '토', type: 'Rest', intensity: 'intensity-rest', duration: '휴식', description: '완전 휴식' },
          { day: '일', type: 'Long', intensity: 'intensity-low', duration: '60-90분', description: 'E 페이스 장거리' }
        ];
      } else if (frequency === '5-6') {
        days = [
          { day: '월', type: 'Easy', intensity: 'intensity-low', duration: '50-60분', description: 'E 페이스 회복런' },
          { day: '화', type: 'Interval', intensity: 'intensity-high', duration: '50분', description: '1000m x 4-5 @ I 페이스' },
          { day: '수', type: 'Easy', intensity: 'intensity-low', duration: '40분', description: 'E 페이스 + 스트라이드' },
          { day: '목', type: 'Tempo', intensity: 'intensity-medium', duration: '45분', description: '2 x 15분 T 페이스' },
          { day: '금', type: 'Easy', intensity: 'intensity-low', duration: '30분', description: '회복 조깅' },
          { day: '토', type: 'Race Pace', intensity: 'intensity-medium', duration: '40분', description: '목표 레이스 페이스' },
          { day: '일', type: 'Long', intensity: 'intensity-low', duration: '90-120분', description: 'E/M 페이스 장거리' }
        ];
      } else if (frequency === '7') {
        days = [
          { day: '월', type: 'Easy+', intensity: 'intensity-low', duration: '60분', description: 'E 페이스 + 언덕' },
          { day: '화', type: 'Interval', intensity: 'intensity-high', duration: '60분', description: '1200m x 4-5 @ I 페이스' },
          { day: '수', type: 'Recovery', intensity: 'intensity-low', duration: '40분', description: '회복 조깅' },
          { day: '목', type: 'Threshold', intensity: 'intensity-medium', duration: '50분', description: '30분 T 페이스' },
          { day: '금', type: 'Easy', intensity: 'intensity-low', duration: '45분', description: 'E 페이스' },
          { day: '토', type: 'Repetition', intensity: 'intensity-high', duration: '45분', description: '200m x 8-10 @ R 페이스' },
          { day: '일', type: 'Long', intensity: 'intensity-low', duration: '120-150분', description: 'Progressive 장거리' }
        ];
      } else { // double sessions
        days = [
          { day: '월', type: 'AM: Easy\nPM: Recovery', intensity: 'intensity-low', duration: 'AM: 50분\nPM: 30분', description: '이중 회복' },
          { day: '화', type: 'AM: Interval\nPM: Easy', intensity: 'intensity-high', duration: 'AM: 60분\nPM: 30분', description: '핵심 세션 + 회복' },
          { day: '수', type: 'AM: Easy', intensity: 'intensity-low', duration: 'AM: 60분', description: '싱글 세션' },
          { day: '목', type: 'AM: Threshold\nPM: Easy', intensity: 'intensity-medium', duration: 'AM: 50분\nPM: 30분', description: 'T 페이스 + 회복' },
          { day: '금', type: 'AM: Recovery', intensity: 'intensity-low', duration: 'AM: 40분', description: '회복 조깅' },
          { day: '토', type: 'AM: Repetition', intensity: 'intensity-high', duration: 'AM: 50분', description: '스피드 세션' },
          { day: '일', type: 'AM: Long\nPM: Recovery', intensity: 'intensity-low', duration: 'AM: 120분\nPM: 20분', description: '장거리 + 쿨다운' }
        ];
      }
      
      // Apply phase-specific modifications
      if (phase === 'base') {
        days = days.map(d => {
          if (d.type.includes('Interval') || d.type.includes('Repetition')) {
            d.type = d.type.replace(/Interval|Repetition/, 'Fartlek');
            d.intensity = 'intensity-medium';
            d.description = '변속주 (구조화되지 않은)';
          }
          return d;
        });
      } else if (phase === 'taper') {
        days = days.map(d => {
          d.duration = d.duration.replace(/\d+/g, match => Math.round(parseInt(match) * 0.6));
          return d;
        });
      }
      
      // Render weekly plan
      weeklyPlan.innerHTML = days.map(d => `
        <div class="${d.intensity} p-3 rounded-lg">
          <div class="font-bold text-center mb-1">${d.day}</div>
          <div class="text-sm font-semibold">${d.type}</div>
          <div class="text-xs text-gray-600 mt-1">${d.duration}</div>
          <div class="text-xs text-gray-500 mt-1">${d.description}</div>
        </div>
      `).join('');
    }

    function generateMesocycle() {
      const mesocyclePlan = document.getElementById('mesocyclePlan');
      const phase = document.getElementById('trainingPhase').value;
      
      let weeks = [];
      
      switch(phase) {
        case 'base':
          weeks = [
            { week: '1주차', focus: '적응', volume: '70%', keyWorkout: 'Easy 런 위주, 주 2회 Fartlek' },
            { week: '2주차', focus: '볼륨 증가', volume: '85%', keyWorkout: 'Long Run 10% 증가, Tempo 도입' },
            { week: '3주차', focus: '강도 도입', volume: '100%', keyWorkout: 'Threshold 20분 x 2회, Long Run 유지' },
            { week: '4주차', focus: '회복', volume: '60%', keyWorkout: 'Easy 런 위주, 테스트 타임트라이얼' }
          ];
          break;
        case 'build':
          weeks = [
            { week: '1주차', focus: 'VO₂max', volume: '80%', keyWorkout: '800-1000m x 4-5 @ I pace, Tempo 25분' },
            { week: '2주차', focus: '젖산역치', volume: '90%', keyWorkout: 'Threshold 30분 연속, 400m x 8 @ R pace' },
            { week: '3주차', focus: '종합', volume: '100%', keyWorkout: '1200-1600m x 3-4 @ I pace, Long Run w/ M pace' },
            { week: '4주차', focus: '회복/테스트', volume: '70%', keyWorkout: '3-5km 테스트, Easy 런' }
          ];
          break;
        case 'peak':
          weeks = [
            { week: '1주차', focus: '레이스 시뮬레이션', volume: '90%', keyWorkout: '목표 거리 70-80% @ 목표 페이스' },
            { week: '2주차', focus: '스피드', volume: '80%', keyWorkout: '200-400m x 8-10 @ R pace, 짧은 Tempo' },
            { week: '3주차', focus: '레이스 준비', volume: '70%', keyWorkout: '목표 페이스 확인, 전략 점검' },
            { week: '4주차', focus: '대회', volume: '50%', keyWorkout: '대회 3일전부터 테이퍼링' }
          ];
          break;
        default:
          weeks = [
            { week: '1주차', focus: '기초', volume: '70%', keyWorkout: 'Easy 런 위주' },
            { week: '2주차', focus: '발전', volume: '85%', keyWorkout: '다양한 페이스 경험' },
            { week: '3주차', focus: '도전', volume: '100%', keyWorkout: '핵심 세션 집중' },
            { week: '4주차', focus: '회복', volume: '60%', keyWorkout: '다음 사이클 준비' }
          ];
      }
      
      mesocyclePlan.innerHTML = weeks.map((w, i) => `
        <div class="phase-card border-2 border-gray-200 rounded-lg p-4">
          <h4 class="font-bold text-lg mb-2">${w.week}</h4>
          <div class="text-sm text-gray-600 mb-2">
            <span class="font-semibold">초점:</span> ${w.focus}
          </div>
          <div class="text-sm text-gray-600 mb-2">
            <span class="font-semibold">볼륨:</span> ${w.volume}
          </div>
          <div class="text-xs text-gray-500">
            <span class="font-semibold">핵심훈련:</span> ${w.keyWorkout}
          </div>
        </div>
      `).join('');
    }

    function generateWorkoutDetails(vdot, paces) {
      const workoutDetails = document.getElementById('workoutDetails');
      const experience = document.getElementById('experience').value;
      
      let workouts = [];
      
      // Interval workout
      const intervalWorkout = {
        title: 'VO₂max 인터벌',
        warmup: '20분 Easy + 4x100m 스트라이드',
        main: experience === 'beginner' ? '400m x 6-8 @ I 페이스 (회복 2-3분)' :
              experience === 'intermediate' ? '800m x 5-6 @ I 페이스 (회복 2-3분)' :
              experience === 'advanced' ? '1000m x 5 @ I 페이스 (회복 2분)' :
              '1200-1600m x 4-5 @ I 페이스 (회복 90초)',
        cooldown: '15분 Easy + 스트레칭',
        tips: '일정한 페이스 유지, 마지막 반복까지 여유 있게',
        pace: formatPace(paces.interval)
      };
      
      // Threshold workout
      const thresholdWorkout = {
        title: '젖산역치 훈련',
        warmup: '15분 Easy + 동적 스트레칭',
        main: experience === 'beginner' ? '20분 연속 @ T 페이스' :
              experience === 'intermediate' ? '2 x 15분 @ T 페이스 (휴식 1분)' :
              experience === 'advanced' ? '30분 연속 @ T 페이스' :
              '2 x 20분 @ T 페이스 (휴식 1분)',
        cooldown: '10분 Easy',
        tips: '편안하게 힘든 정도, 짧은 문장 대화 가능',
        pace: formatPace(paces.threshold)
      };
      
      // Long run workout
      const longRunWorkout = {
        title: '장거리 훈련',
        warmup: '천천히 시작',
        main: experience === 'beginner' ? '60-75분 @ E 페이스' :
              experience === 'intermediate' ? '90-105분 @ E/M 페이스' :
              experience === 'advanced' ? '105-120분, 마지막 20-30분 M 페이스' :
              '120-150분 Progressive (E→M→T)',
        cooldown: '5-10분 매우 천천히',
        tips: '수분과 에너지 보충, 일정한 페이스',
        pace: `${formatPace(paces.easy.max)}-${formatPace(paces.easy.min)}`
      };
      
      // Repetition workout
      const repetitionWorkout = {
        title: '스피드/폼 훈련',
        warmup: '20분 Easy + 드릴',
        main: experience === 'beginner' ? '200m x 6-8 @ R 페이스 (완전회복)' :
              experience === 'intermediate' ? '400m x 5-6 @ R 페이스 (완전회복)' :
              experience === 'advanced' ? '400m x 4 + 200m x 4 @ R 페이스' :
              '600m x 5-6 @ R 페이스 (완전회복)',
        cooldown: '15분 Easy',
        tips: '폼에 집중, 완전 회복 후 다음 반복',
        pace: formatPace(paces.repetition)
      };
      
      workouts = [intervalWorkout, thresholdWorkout, longRunWorkout, repetitionWorkout];
      
      workoutDetails.innerHTML = workouts.map(w => `
        <div class="border rounded-lg p-4">
          <h4 class="font-bold text-lg mb-3 text-purple-700">${w.title}</h4>
          <div class="space-y-2 text-sm">
            <div>
              <span class="font-semibold">워밍업:</span> ${w.warmup}
            </div>
            <div>
              <span class="font-semibold">메인세트:</span> ${w.main}
            </div>
            <div>
              <span class="font-semibold">쿨다운:</span> ${w.cooldown}
            </div>
            <div class="bg-purple-50 p-2 rounded">
              <span class="font-semibold">목표 페이스:</span> ${w.pace}
            </div>
            <div class="text-xs text-gray-600 italic">
              💡 ${w.tips}
            </div>
          </div>
        </div>
      `).join('');
    }

    function generateRecommendations() {
      const recommendations = document.getElementById('recommendations');
      const recs = [];
      
      // Gender-specific (여성 VDOT 표시로 충분, 페이스 조정은 하지 않음)
      if (userProfile.gender === 'female') {
        recs.push({
          title: '여성 러너 권장사항',
          items: [
            '철분 수치 정기 체크 (페리틴 50ng/ml 이상 유지)',
            '월경 주기 고려한 훈련 강도 조절',
            '칼슘과 비타민 D 충분히 섭취',
            '골밀도 검사 연 1회'
          ]
        });
      }
      
      // Age-specific
      if (userProfile.ageGroup && userProfile.ageGroup.includes('master')) {
        recs.push({
          title: '마스터즈 러너 권장사항',
          items: [
            '회복 시간 1.5-2배 확보',
            '주 2회 이상 근력 운동 필수',
            '고강도 훈련 전 충분한 워밍업 (20분 이상)',
            '유연성 운동 매일 15분',
            '정기 건강검진 (심혈관계 포함)'
          ]
        });
      }
      
      // Training phase specific
      const phase = document.getElementById('trainingPhase').value;
      if (phase === 'base') {
        recs.push({
          title: '기초 체력기 권장사항',
          items: [
            '주간 마일리지 10% 이내 증가',
            '속도보다 시간/거리에 집중',
            '주 1-2회 크로스트레이닝',
            '코어 강화 운동 주 3회'
          ]
        });
      } else if (phase === 'peak' || phase === 'taper') {
        recs.push({
          title: '대회 준비 권장사항',
          items: [
            '새로운 장비나 음식 시도 금지',
            '충분한 수면 (8시간 이상)',
            '탄수화물 비중 60-70%로 증가',
            '대회 3일 전부터 카페인 섭취 제한',
            '레이스 페이스 시뮬레이션'
          ]
        });
      }
      
      // Condition-specific
      if (document.getElementById('injury_recovery').checked) {
        recs.push({
          title: '부상 회복 프로토콜',
          items: [
            'Pain Scale 3/10 이하에서만 훈련',
            '아이싱과 압박 매일 실시',
            '항염증 음식 섭취 (오메가-3, 강황)',
            '대체 운동으로 유산소 유지 (수영, 자전거)',
            '물리치료사 상담 권장'
          ]
        });
      }
      
      // General nutrition
      recs.push({
        title: '영양 섭취 가이드',
        items: [
          '훈련 전: 탄수화물 30-50g (1-2시간 전)',
          '훈련 중: 60분 이상 시 시간당 30-60g 탄수화물',
          '훈련 후 30분 내: 탄수화물:단백질 = 3:1 비율',
          '일일 수분 섭취: 체중(kg) x 35ml + 훈련 손실량',
          '전해질 보충: 나트륨 300-700mg/시간'
        ]
      });
      
      recommendations.innerHTML = recs.map(r => `
        <div class="border rounded-lg p-4 bg-gray-50">
          <h4 class="font-bold mb-2 text-purple-700">
            <i class="fas fa-check-circle mr-2"></i>${r.title}
          </h4>
          <ul class="text-sm space-y-1">
            ${r.items.map(item => `<li class="flex items-start"><span class="text-purple-500 mr-2">•</span>${item}</li>`).join('')}
          </ul>
        </div>
      `).join('');
    }

    function calculateTraining() {
      // Get user inputs
      const distance = parseFloat(document.getElementById('eventDistance').value);
      const hours = parseInt(document.getElementById('hours').value) || 0;
      const minutes = parseInt(document.getElementById('minutes').value) || 0;
      const seconds = parseFloat(document.getElementById('seconds').value) || 0;
      
      if (!distance || (hours === 0 && minutes === 0 && seconds === 0)) {
        alert('종목과 기록을 입력해주세요.');
        return;
      }
      
      if (!userProfile.gender) {
        alert('성별을 선택해주세요.');
        return;
      }
      
      // Update profile
      userProfile.ageGroup = document.getElementById('ageGroup').value;
      userProfile.experience = document.getElementById('experience').value;
      userProfile.weeklyVolume = document.getElementById('weeklyVolume').value;
      userProfile.frequency = document.getElementById('frequency').value;
      userProfile.trainingPhase = document.getElementById('trainingPhase').value;
      
      // Calculate adjustments
      calculateAdjustments();
      
      // Calculate VDOT
      const totalSeconds = hours * 3600 + minutes * 60 + seconds;
      let vdot = calculateVDOT(distance, totalSeconds);
      
      // 여성의 경우 VDOT 표시만 조정 (페이스 계산은 실제 VDOT 사용)
      const displayVDOT = userProfile.gender === 'female' ? vdot * 0.88 : vdot;
      
      // Display VDOT
      document.getElementById('vdotScore').textContent = displayVDOT.toFixed(1);
      document.getElementById('performanceLevel').textContent = getPerformanceLevel(displayVDOT);
      document.getElementById('predictedVO2max').textContent = (displayVDOT * 1.05).toFixed(1);
      
      if (userProfile.gender === 'female') {
        document.getElementById('vdotAdjustment').textContent = '여성 보정 적용 (실제 VDOT: ' + vdot.toFixed(1) + ')';
      } else {
        document.getElementById('vdotAdjustment').textContent = '';
      }
      
      // Calculate training paces using actual VDOT
      const paces = calculateTrainingPaces(vdot);
      
      // Display paces
      document.getElementById('easyPace').textContent = 
        `${formatPace(paces.easy.max)} - ${formatPace(paces.easy.min)}`;
      document.getElementById('marathonPace').textContent = formatPace(paces.marathon);
      document.getElementById('thresholdPace').textContent = formatPace(paces.threshold);
      document.getElementById('intervalPace').textContent = formatPace(paces.interval);
      document.getElementById('repetitionPace').textContent = formatPace(paces.repetition);
      
      // Generate training plans
      generateWeeklyPlan(vdot);
      generateMesocycle();
      generateWorkoutDetails(vdot, paces);
      generateRecommendations();
      
      // Show results
      document.getElementById('resultsSection').classList.remove('hidden');
      document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      // Set default values
      document.getElementById('ageGroup').value = 'senior';
      document.getElementById('experience').value = 'intermediate';
      document.getElementById('weeklyVolume').value = 'moderate';
      document.getElementById('frequency').value = '5-6';
      document.getElementById('trainingPhase').value = 'build';
    });
  </script>
</body>
</html>