<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Render 배포 테스트</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-8">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold mb-8">🚀 Render 배포 테스트</h1>
    
    <div class="space-y-6">
      <!-- API 테스트 -->
      <div class="bg-gray-800 rounded-lg p-6">
        <h2 class="text-xl font-semibold mb-4">📡 API 연결 테스트</h2>
        <input type="text" id="apiUrl" placeholder="https://athletetime-backend-xxxx.onrender.com" 
          class="w-full p-3 bg-gray-700 rounded mb-4">
        <button onclick="testAPI()" class="bg-blue-500 px-6 py-2 rounded">API 테스트</button>
        <div id="apiResult" class="mt-4 text-sm"></div>
      </div>

      <!-- WebSocket 테스트 -->
      <div class="bg-gray-800 rounded-lg p-6">
        <h2 class="text-xl font-semibold mb-4">💬 WebSocket 테스트</h2>
        <input type="text" id="wsUrl" placeholder="wss://athletetime-backend-xxxx.onrender.com"
          class="w-full p-3 bg-gray-700 rounded mb-4">
        <button onclick="testWebSocket()" class="bg-green-500 px-6 py-2 rounded">WebSocket 테스트</button>
        <div id="wsResult" class="mt-4 text-sm"></div>
      </div>

      <!-- 데이터베이스 테스트 -->
      <div class="bg-gray-800 rounded-lg p-6">
        <h2 class="text-xl font-semibold mb-4">🗄️ 데이터베이스 테스트</h2>
        <button onclick="testDatabase()" class="bg-purple-500 px-6 py-2 rounded">DB 테스트</button>
        <div id="dbResult" class="mt-4 text-sm"></div>
      </div>
    </div>

    <div class="mt-8 p-4 bg-yellow-900 rounded">
      <p class="text-yellow-200">💡 Render Dashboard에서 Backend URL을 복사해서 위에 입력하세요</p>
    </div>
  </div>

  <script>
    async function testAPI() {
      const url = document.getElementById('apiUrl').value || 'https://athletetime-backend.onrender.com';
      const result = document.getElementById('apiResult');
      
      result.innerHTML = '⏳ 테스트 중...';
      
      try {
        const response = await fetch(url + '/api/posts');
        if (response.ok) {
          const data = await response.json();
          result.innerHTML = `✅ API 연결 성공! (${data.length || 0}개 게시물)`;
          result.className = 'mt-4 text-sm text-green-400';
        } else {
          result.innerHTML = `❌ API 응답 오류: ${response.status}`;
          result.className = 'mt-4 text-sm text-red-400';
        }
      } catch (error) {
        result.innerHTML = `❌ 연결 실패: ${error.message}`;
        result.className = 'mt-4 text-sm text-red-400';
      }
    }

    function testWebSocket() {
      const url = document.getElementById('wsUrl').value || 'wss://athletetime-backend.onrender.com';
      const result = document.getElementById('wsResult');
      
      result.innerHTML = '⏳ 연결 중...';
      
      const ws = new WebSocket(url);
      
      ws.onopen = () => {
        result.innerHTML = '✅ WebSocket 연결 성공!';
        result.className = 'mt-4 text-sm text-green-400';
        
        ws.send(JSON.stringify({
          type: 'join',
          room: 'test',
          userId: 'test-user',
          nickname: '테스터'
        }));
      };
      
      ws.onerror = (error) => {
        result.innerHTML = `❌ WebSocket 오류: ${error.message || '연결 실패'}`;
        result.className = 'mt-4 text-sm text-red-400';
      };
      
      ws.onmessage = (event) => {
        result.innerHTML += `<br>📨 메시지 수신: ${event.data}`;
      };
      
      setTimeout(() => ws.close(), 5000);
    }

    async function testDatabase() {
      const url = document.getElementById('apiUrl').value || 'https://athletetime-backend.onrender.com';
      const result = document.getElementById('dbResult');
      
      result.innerHTML = '⏳ 테스트 중...';
      
      try {
        const response = await fetch(url + '/api/posts', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            category: '테스트',
            title: 'DB 테스트 게시물',
            content: '이것은 테스트입니다',
            author: '테스터'
          })
        });
        
        if (response.ok) {
          const data = await response.json();
          result.innerHTML = `✅ DB 쓰기 성공! (ID: ${data.id})`;
          result.className = 'mt-4 text-sm text-green-400';
        } else {
          result.innerHTML = `❌ DB 오류: ${response.status}`;
          result.className = 'mt-4 text-sm text-red-400';
        }
      } catch (error) {
        result.innerHTML = `❌ DB 연결 실패: ${error.message}`;
        result.className = 'mt-4 text-sm text-red-400';
      }
    }
  </script>
</body>
</html>