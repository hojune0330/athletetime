<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lane Table Debug Test</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .pace-table {
      width: 100%;
      border-collapse: collapse;
    }
    .pace-table th, .pace-table td {
      border: 1px solid #e5e7eb;
      padding: 8px;
      text-align: center;
    }
    .pace-table thead th {
      background-color: #f3f4f6;
      font-weight: bold;
    }
    .bg-purple-100 { background-color: #ede9fe; }
    .bg-green-50 { background-color: #f0fdf4; }
    .bg-blue-50 { background-color: #eff6ff; }
    .bg-red-50 { background-color: #fef2f2; }
    .text-purple-700 { color: #6b21a8; }
    .text-blue-600 { color: #2563eb; }
    .text-red-600 { color: #dc2626; }
  </style>
</head>
<body class="bg-gray-100 p-4">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-2xl font-bold mb-4">Lane Table Debug Test</h1>
    
    <div class="bg-white rounded-lg shadow p-4 mb-4">
      <label class="block mb-2">
        Target Time (seconds): 
        <input type="number" id="targetTime" value="90" class="border rounded px-2 py-1">
      </label>
      <label class="block mb-2">
        Lane: 
        <select id="selectedLane" class="border rounded px-2 py-1">
          <option value="1">Lane 1</option>
          <option value="2">Lane 2</option>
          <option value="3">Lane 3</option>
          <option value="4" selected>Lane 4</option>
          <option value="5">Lane 5</option>
          <option value="6">Lane 6</option>
          <option value="7">Lane 7</option>
          <option value="8">Lane 8</option>
        </select>
      </label>
      <button onclick="testCalculation()" class="bg-blue-500 text-white px-4 py-2 rounded">
        Test Calculation
      </button>
    </div>
    
    <div class="bg-white rounded-lg shadow p-4">
      <h3 class="font-bold text-lg mb-2">Debug Output</h3>
      <div id="debugOutput" class="text-sm"></div>
    </div>
    
    <div class="bg-white rounded-lg shadow p-4 mt-4">
      <h3 class="font-bold text-lg mb-2">Table Test</h3>
      <div class="overflow-x-auto">
        <table class="pace-table">
          <thead>
            <tr>
              <th rowspan="2">레인</th>
              <th rowspan="2">총 거리</th>
              <th rowspan="2">스태거</th>
              <th rowspan="2">총 시간</th>
              <th rowspan="2">시차</th>
              <th colspan="4" class="bg-gray-50">구간별 시간 (초)</th>
            </tr>
            <tr>
              <th class="bg-blue-50">직선①</th>
              <th class="bg-red-50">곡선①</th>
              <th class="bg-blue-50">직선②</th>
              <th class="bg-red-50">곡선②</th>
            </tr>
          </thead>
          <tbody id="laneTimeTable">
            <!-- Will be populated dynamically -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    function testCalculation() {
      const targetTime = parseFloat(document.getElementById('targetTime').value);
      const selectedLane = parseInt(document.getElementById('selectedLane').value);
      
      const debugDiv = document.getElementById('debugOutput');
      debugDiv.innerHTML = `<p>Testing with: Target Time = ${targetTime}s, Lane = ${selectedLane}</p>`;
      
      // World Athletics specs
      const STRAIGHT_LENGTH = 84.39;
      const LANE_WIDTH = 1.22;
      const KERB_RADIUS = 36.50;
      const MEASUREMENT_OFFSET_LANE1 = 0.30;
      const MEASUREMENT_OFFSET_OTHER = 0.20;
      
      // Calculate selected lane distance
      let selectedLaneDistance;
      if (selectedLane === 1) {
        const radius = KERB_RADIUS + MEASUREMENT_OFFSET_LANE1;
        selectedLaneDistance = (STRAIGHT_LENGTH * 2) + (Math.PI * radius * 2);
      } else {
        const radius = KERB_RADIUS + (LANE_WIDTH * (selectedLane - 1)) + MEASUREMENT_OFFSET_OTHER;
        selectedLaneDistance = (STRAIGHT_LENGTH * 2) + (Math.PI * radius * 2);
      }
      
      const speedInSelectedLane = selectedLaneDistance / targetTime;
      debugDiv.innerHTML += `<p>Selected Lane Distance: ${selectedLaneDistance.toFixed(2)}m</p>`;
      debugDiv.innerHTML += `<p>Speed: ${speedInSelectedLane.toFixed(2)} m/s (${(speedInSelectedLane * 3.6).toFixed(2)} km/h)</p>`;
      
      const lanes = [];
      
      for (let lane = 1; lane <= 8; lane++) {
        let measurementRadius;
        if (lane === 1) {
          measurementRadius = KERB_RADIUS + MEASUREMENT_OFFSET_LANE1;
        } else {
          measurementRadius = KERB_RADIUS + (LANE_WIDTH * (lane - 1)) + MEASUREMENT_OFFSET_OTHER;
        }
        
        const curveLength = Math.PI * measurementRadius * 2;
        const totalDistance = (STRAIGHT_LENGTH * 2) + curveLength;
        const stagger = lane === 1 ? 0 : totalDistance - 400;
        
        const sectionDistances = {
          straight1: STRAIGHT_LENGTH,
          curve1: curveLength / 2,
          straight2: STRAIGHT_LENGTH,
          curve2: curveLength / 2
        };
        
        const sectionTimes = {
          straight1: sectionDistances.straight1 / speedInSelectedLane,
          curve1: sectionDistances.curve1 / speedInSelectedLane,
          straight2: sectionDistances.straight2 / speedInSelectedLane,
          curve2: sectionDistances.curve2 / speedInSelectedLane
        };
        
        const adjustedTime = totalDistance / speedInSelectedLane;
        
        lanes.push({
          lane,
          radius: measurementRadius,
          distance: totalDistance,
          stagger,
          adjustedTime,
          sectionDistances,
          sectionTimes,
          isSelected: lane === selectedLane
        });
      }
      
      debugDiv.innerHTML += `<p class="mt-2">Calculated ${lanes.length} lanes</p>`;
      
      // Update table
      const tbody = document.getElementById('laneTimeTable');
      debugDiv.innerHTML += `<p>Table body element found: ${tbody ? 'Yes' : 'No'}</p>`;
      
      if (!tbody) {
        debugDiv.innerHTML += `<p class="text-red-600">Error: Could not find tbody element!</p>`;
        return;
      }
      
      tbody.innerHTML = '';
      debugDiv.innerHTML += `<p>Cleared table body</p>`;
      
      lanes.forEach((lane, index) => {
        const row = tbody.insertRow();
        if (lane.isSelected) {
          row.className = 'bg-purple-100 font-semibold';
        } else if (Math.abs(lane.distance - 400) < 0.1) {
          row.className = 'bg-green-50';
        }
        
        const timeDiff = lane.lane === 1 ? 0 : lane.adjustedTime - lanes[0].adjustedTime;
        const timeDiffStr = timeDiff > 0 ? `+${timeDiff.toFixed(2)}` : timeDiff.toFixed(2);
        
        // Create cells individually for debugging
        const cell1 = row.insertCell();
        cell1.innerHTML = `${lane.lane}${lane.isSelected ? ' ✓' : ''}`;
        cell1.className = lane.isSelected ? 'font-bold text-purple-700' : 'font-bold';
        
        const cell2 = row.insertCell();
        cell2.textContent = `${lane.distance.toFixed(2)}m`;
        
        const cell3 = row.insertCell();
        cell3.textContent = `${lane.stagger > 0 ? '+' : ''}${lane.stagger.toFixed(2)}m`;
        
        const cell4 = row.insertCell();
        cell4.textContent = `${lane.adjustedTime.toFixed(2)}초`;
        cell4.className = lane.isSelected ? 'font-bold text-purple-700' : 'font-bold';
        
        const cell5 = row.insertCell();
        cell5.textContent = timeDiff === 0 ? '-' : timeDiffStr;
        cell5.className = 'text-xs';
        
        const cell6 = row.insertCell();
        cell6.textContent = lane.sectionTimes.straight1.toFixed(2);
        cell6.className = 'text-blue-600';
        
        const cell7 = row.insertCell();
        cell7.textContent = lane.sectionTimes.curve1.toFixed(2);
        cell7.className = 'text-red-600';
        
        const cell8 = row.insertCell();
        cell8.textContent = lane.sectionTimes.straight2.toFixed(2);
        cell8.className = 'text-blue-600';
        
        const cell9 = row.insertCell();
        cell9.textContent = lane.sectionTimes.curve2.toFixed(2);
        cell9.className = 'text-red-600';
      });
      
      debugDiv.innerHTML += `<p class="text-green-600">Added ${lanes.length} rows to table</p>`;
      debugDiv.innerHTML += `<p>Table now has ${tbody.rows.length} rows</p>`;
    }
    
    // Run test on load
    window.addEventListener('DOMContentLoaded', function() {
      testCalculation();
    });
  </script>
</body>
</html>