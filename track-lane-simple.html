<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>400m 트랙 레인 계산기 | Athlete Time</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', '맑은 고딕', sans-serif;
      max-height: 100vh;
      overflow-x: hidden;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .lane-1 { stroke: #ef4444; }
    .lane-2 { stroke: #f97316; }
    .lane-3 { stroke: #eab308; }
    .lane-4 { stroke: #84cc16; }
    .lane-5 { stroke: #22c55e; }
    .lane-6 { stroke: #06b6d4; }
    .lane-7 { stroke: #3b82f6; }
    .lane-8 { stroke: #8b5cf6; }
    
    .lane-selected {
      stroke-width: 4;
      opacity: 1;
    }
    
    .lane-unselected {
      stroke-width: 2;
      opacity: 0.3;
    }
  </style>
</head>
<body class="bg-gray-50">
  <div class="container mx-auto px-4 py-6 max-w-6xl">
    <!-- Compact Header -->
    <div class="gradient-bg text-white p-4 rounded-lg mb-4">
      <div class="flex justify-between items-center">
        <div>
          <h1 class="text-2xl font-bold">400m 트랙 레인 계산기</h1>
          <p class="text-sm opacity-90">레인별 실제 거리와 페이스 계산</p>
        </div>
        <button onclick="window.location.href='pace-calculator.html'" 
                class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded transition">
          <i class="fas fa-arrow-left mr-2"></i>돌아가기
        </button>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="grid lg:grid-cols-2 gap-4">
      <!-- Left: Track Visualization -->
      <div class="bg-white rounded-lg shadow p-4">
        <h2 class="font-bold mb-3">트랙 시각화</h2>
        
        <!-- Track SVG -->
        <svg viewBox="0 0 400 300" class="w-full" style="max-height: 350px;">
          <!-- Background -->
          <rect width="400" height="300" fill="#f9fafb"/>
          
          <!-- Track Lanes -->
          <g fill="none">
            <!-- Lane 8 (outermost) -->
            <rect x="40" y="40" width="320" height="220" rx="110" class="lane-8 lane-unselected" id="lane8"/>
            <!-- Lane 7 -->
            <rect x="50" y="50" width="300" height="200" rx="100" class="lane-7 lane-unselected" id="lane7"/>
            <!-- Lane 6 -->
            <rect x="60" y="60" width="280" height="180" rx="90" class="lane-6 lane-unselected" id="lane6"/>
            <!-- Lane 5 -->
            <rect x="70" y="70" width="260" height="160" rx="80" class="lane-5 lane-unselected" id="lane5"/>
            <!-- Lane 4 -->
            <rect x="80" y="80" width="240" height="140" rx="70" class="lane-4 lane-unselected" id="lane4"/>
            <!-- Lane 3 -->
            <rect x="90" y="90" width="220" height="120" rx="60" class="lane-3 lane-unselected" id="lane3"/>
            <!-- Lane 2 -->
            <rect x="100" y="100" width="200" height="100" rx="50" class="lane-2 lane-unselected" id="lane2"/>
            <!-- Lane 1 (innermost) -->
            <rect x="110" y="110" width="180" height="80" rx="40" class="lane-1 lane-selected" id="lane1"/>
          </g>
          
          <!-- Start/Finish Line -->
          <line x1="200" y1="30" x2="200" y2="270" stroke="black" stroke-width="3" stroke-dasharray="5,5"/>
          <text x="205" y="25" font-size="12" font-weight="bold">START/FINISH</text>
          
          <!-- Section Labels -->
          <text x="280" y="155" font-size="11" fill="#6b7280" text-anchor="middle">직선</text>
          <text x="350" y="155" font-size="11" fill="#6b7280" text-anchor="middle">곡선</text>
          <text x="120" y="155" font-size="11" fill="#6b7280" text-anchor="middle">직선</text>
          <text x="50" y="155" font-size="11" fill="#6b7280" text-anchor="middle">곡선</text>
          
          <!-- Stagger markers -->
          <g id="staggerMarkers" stroke="#6b7280" stroke-width="1" stroke-dasharray="2,2">
            <!-- Will be filled dynamically -->
          </g>
        </svg>
        
        <!-- Lane Selector -->
        <div class="grid grid-cols-4 gap-2 mt-4">
          <button onclick="selectLane(1)" class="p-2 border-2 rounded text-sm hover:bg-gray-50 lane-btn" id="btn1">레인 1</button>
          <button onclick="selectLane(2)" class="p-2 border-2 rounded text-sm hover:bg-gray-50 lane-btn" id="btn2">레인 2</button>
          <button onclick="selectLane(3)" class="p-2 border-2 rounded text-sm hover:bg-gray-50 lane-btn" id="btn3">레인 3</button>
          <button onclick="selectLane(4)" class="p-2 border-2 rounded text-sm hover:bg-gray-50 lane-btn" id="btn4">레인 4</button>
          <button onclick="selectLane(5)" class="p-2 border-2 rounded text-sm hover:bg-gray-50 lane-btn" id="btn5">레인 5</button>
          <button onclick="selectLane(6)" class="p-2 border-2 rounded text-sm hover:bg-gray-50 lane-btn" id="btn6">레인 6</button>
          <button onclick="selectLane(7)" class="p-2 border-2 rounded text-sm hover:bg-gray-50 lane-btn" id="btn7">레인 7</button>
          <button onclick="selectLane(8)" class="p-2 border-2 rounded text-sm hover:bg-gray-50 lane-btn" id="btn8">레인 8</button>
        </div>
      </div>

      <!-- Right: Calculation Results -->
      <div class="bg-white rounded-lg shadow p-4">
        <h2 class="font-bold mb-3">계산 결과</h2>
        
        <!-- Input -->
        <div class="mb-4">
          <label class="text-sm text-gray-600">400m 목표 시간</label>
          <div class="flex gap-2 mt-1">
            <input type="number" id="targetSec" value="50" min="30" max="120" 
                   class="w-20 p-2 border rounded text-center" onchange="calculate()">
            <span class="p-2">초</span>
            <button onclick="calculate()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
              계산
            </button>
          </div>
        </div>
        
        <!-- Selected Lane Info -->
        <div class="bg-gradient-to-r from-purple-50 to-blue-50 p-4 rounded-lg mb-4">
          <div class="text-lg font-bold mb-2">
            <span id="selectedLaneLabel">레인 1</span> 상세 정보
          </div>
          
          <div class="grid grid-cols-2 gap-3 text-sm">
            <div>
              <span class="text-gray-600">총 거리:</span>
              <span class="font-semibold" id="totalDistance">400.00m</span>
            </div>
            <div>
              <span class="text-gray-600">스태거:</span>
              <span class="font-semibold" id="stagger">0.00m</span>
            </div>
            <div>
              <span class="text-gray-600">직선 (2×):</span>
              <span class="font-semibold" id="straightDistance">168.78m</span>
            </div>
            <div>
              <span class="text-gray-600">곡선 (2×):</span>
              <span class="font-semibold" id="curveDistance">231.22m</span>
            </div>
            <div>
              <span class="text-gray-600">곡선 반경:</span>
              <span class="font-semibold" id="radius">36.50m</span>
            </div>
            <div>
              <span class="text-gray-600">보정 시간:</span>
              <span class="font-semibold text-blue-600" id="adjustedTime">50.00초</span>
            </div>
          </div>
        </div>
        
        <!-- Quick Reference Table -->
        <div class="overflow-auto" style="max-height: 200px;">
          <table class="w-full text-sm">
            <thead class="bg-gray-100 sticky top-0">
              <tr>
                <th class="p-2 text-left">레인</th>
                <th class="p-2 text-center">거리</th>
                <th class="p-2 text-center">스태거</th>
                <th class="p-2 text-center">보정시간</th>
              </tr>
            </thead>
            <tbody id="laneTable">
              <!-- Will be filled dynamically -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="grid md:grid-cols-2 gap-4 mt-4">
      <!-- Distance Chart -->
      <div class="bg-white rounded-lg shadow p-4">
        <h3 class="font-bold mb-3 text-sm">구간별 거리 (m)</h3>
        <canvas id="distanceChart" style="max-height: 250px;"></canvas>
      </div>
      
      <!-- Time Chart -->
      <div class="bg-white rounded-lg shadow p-4">
        <h3 class="font-bold mb-3 text-sm">구간별 소요 시간 (초)</h3>
        <canvas id="timeChart" style="max-height: 250px;"></canvas>
      </div>
    </div>

    <!-- Bottom Info Bar -->
    <div class="bg-white rounded-lg shadow p-4 mt-4">
      <div class="flex flex-wrap justify-between items-center text-sm">
        <div class="flex items-center gap-4">
          <span class="text-gray-600">제작: 장호준 코치</span>
          <span class="text-gray-400">|</span>
          <span class="text-gray-600">공식: 거리 = 2 × (84.39 + π × 반경)</span>
        </div>
        <div class="flex gap-3">
          <span><i class="fas fa-info-circle text-blue-500"></i> 직선: 84.39m</span>
          <span><i class="fas fa-info-circle text-red-500"></i> 레인폭: 1.22m</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Lane data
    const lanes = [
      { num: 1, radius: 36.50, color: '#ef4444' },
      { num: 2, radius: 37.72, color: '#f97316' },
      { num: 3, radius: 38.94, color: '#eab308' },
      { num: 4, radius: 40.16, color: '#84cc16' },
      { num: 5, radius: 41.38, color: '#22c55e' },
      { num: 6, radius: 42.60, color: '#06b6d4' },
      { num: 7, radius: 43.82, color: '#3b82f6' },
      { num: 8, radius: 45.04, color: '#8b5cf6' }
    ];
    
    let selectedLane = 1;
    
    function calculateLaneData(laneNum) {
      const lane = lanes[laneNum - 1];
      const straightLength = 84.39 * 2; // Total straight distance
      const curveLength = Math.PI * lane.radius * 2; // Total curve distance
      const totalDistance = straightLength + curveLength;
      const stagger = totalDistance - 400;
      
      return {
        num: laneNum,
        radius: lane.radius,
        straightLength: straightLength,
        curveLength: curveLength,
        totalDistance: totalDistance,
        stagger: stagger,
        color: lane.color
      };
    }
    
    function selectLane(laneNum) {
      selectedLane = laneNum;
      
      // Update SVG lanes
      for (let i = 1; i <= 8; i++) {
        const element = document.getElementById(`lane${i}`);
        if (i === laneNum) {
          element.classList.remove('lane-unselected');
          element.classList.add('lane-selected');
        } else {
          element.classList.remove('lane-selected');
          element.classList.add('lane-unselected');
        }
      }
      
      // Update buttons
      document.querySelectorAll('.lane-btn').forEach((btn, index) => {
        if (index + 1 === laneNum) {
          btn.classList.add('bg-purple-600', 'text-white');
          btn.classList.remove('hover:bg-gray-50');
        } else {
          btn.classList.remove('bg-purple-600', 'text-white');
          btn.classList.add('hover:bg-gray-50');
        }
      });
      
      // Update stagger markers
      updateStaggerMarkers(laneNum);
      
      // Calculate and display
      calculate();
    }
    
    function updateStaggerMarkers(laneNum) {
      const staggerGroup = document.getElementById('staggerMarkers');
      staggerGroup.innerHTML = '';
      
      if (laneNum > 1) {
        const data = calculateLaneData(laneNum);
        // Simple stagger line on the track
        const staggerX = 200 + data.stagger * 0.5; // Scale for visualization
        
        staggerGroup.innerHTML = `
          <line x1="${staggerX}" y1="40" x2="${staggerX}" y2="60" stroke="${data.color}" stroke-width="2"/>
          <text x="${staggerX}" y="35" font-size="10" fill="${data.color}" text-anchor="middle">
            +${data.stagger.toFixed(1)}m
          </text>
        `;
      }
    }
    
    function calculate() {
      const targetTime = parseFloat(document.getElementById('targetSec').value) || 50;
      const data = calculateLaneData(selectedLane);
      
      // Update display
      document.getElementById('selectedLaneLabel').textContent = `레인 ${selectedLane}`;
      document.getElementById('totalDistance').textContent = `${data.totalDistance.toFixed(2)}m`;
      document.getElementById('stagger').textContent = `+${data.stagger.toFixed(2)}m`;
      document.getElementById('straightDistance').textContent = `${data.straightLength.toFixed(2)}m`;
      document.getElementById('curveDistance').textContent = `${data.curveLength.toFixed(2)}m`;
      document.getElementById('radius').textContent = `${data.radius.toFixed(2)}m`;
      
      // Calculate adjusted time
      const adjustedTime = targetTime * (data.totalDistance / 400);
      document.getElementById('adjustedTime').textContent = `${adjustedTime.toFixed(2)}초`;
      
      // Update table
      updateLaneTable(targetTime);
      
      // Update charts
      updateCharts(targetTime);
    }
    
    function updateLaneTable(targetTime) {
      const tbody = document.getElementById('laneTable');
      tbody.innerHTML = '';
      
      for (let i = 1; i <= 8; i++) {
        const data = calculateLaneData(i);
        const adjustedTime = targetTime * (data.totalDistance / 400);
        const selected = i === selectedLane ? 'bg-purple-50 font-semibold' : '';
        
        tbody.innerHTML += `
          <tr class="${selected} hover:bg-gray-50 cursor-pointer" onclick="selectLane(${i})">
            <td class="p-2">
              <span class="inline-block w-3 h-3 rounded-full mr-1" 
                    style="background: ${data.color}"></span>
              레인 ${i}
            </td>
            <td class="p-2 text-center">${data.totalDistance.toFixed(2)}m</td>
            <td class="p-2 text-center">+${data.stagger.toFixed(2)}m</td>
            <td class="p-2 text-center">${adjustedTime.toFixed(2)}초</td>
          </tr>
        `;
      }
    }
    
    // Chart instances
    let distanceChartInstance = null;
    let timeChartInstance = null;
    
    function updateCharts(targetTime) {
      const laneLabels = [];
      const straightDistances = [];
      const curveDistances = [];
      const straightTimes = [];
      const curveTimes = [];
      
      for (let i = 1; i <= 8; i++) {
        const data = calculateLaneData(i);
        // 400m 기준 시간을 실제 거리에 맞게 보정
        const adjustedTime = targetTime * (data.totalDistance / 400);
        // 속도 계산 (m/s)
        const speed = data.totalDistance / adjustedTime;
        // 구간별 시간 계산
        const straightTime = data.straightLength / speed;
        const curveTime = data.curveLength / speed;
        
        laneLabels.push(`레인 ${i}`);
        straightDistances.push(data.straightLength);
        curveDistances.push(data.curveLength);
        straightTimes.push(parseFloat(straightTime.toFixed(2)));
        curveTimes.push(parseFloat(curveTime.toFixed(2)));
      }
      
      // Distance Chart
      const distanceCtx = document.getElementById('distanceChart').getContext('2d');
      if (distanceChartInstance) {
        distanceChartInstance.destroy();
      }
      
      distanceChartInstance = new Chart(distanceCtx, {
        type: 'bar',
        data: {
          labels: laneLabels,
          datasets: [
            {
              label: '직선 구간',
              data: straightDistances,
              backgroundColor: 'rgba(59, 130, 246, 0.7)',
              borderColor: 'rgb(59, 130, 246)',
              borderWidth: 1
            },
            {
              label: '곡선 구간',
              data: curveDistances,
              backgroundColor: 'rgba(239, 68, 68, 0.7)',
              borderColor: 'rgb(239, 68, 68)',
              borderWidth: 1
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                boxWidth: 12,
                padding: 10,
                font: { size: 11 }
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `${context.dataset.label}: ${context.parsed.y.toFixed(2)}m`;
                },
                afterLabel: function(context) {
                  const total = straightDistances[context.dataIndex] + curveDistances[context.dataIndex];
                  if (context.datasetIndex === 1) {
                    return `총 거리: ${total.toFixed(2)}m`;
                  }
                }
              }
            }
          },
          scales: {
            x: {
              stacked: true,
              ticks: { font: { size: 10 } }
            },
            y: {
              stacked: true,
              beginAtZero: true,
              ticks: { font: { size: 10 } },
              title: {
                display: true,
                text: '거리 (m)',
                font: { size: 11 }
              }
            }
          }
        }
      });
      
      // Time Chart
      const timeCtx = document.getElementById('timeChart').getContext('2d');
      if (timeChartInstance) {
        timeChartInstance.destroy();
      }
      
      timeChartInstance = new Chart(timeCtx, {
        type: 'bar',
        data: {
          labels: laneLabels,
          datasets: [
            {
              label: '직선 시간',
              data: straightTimes,
              backgroundColor: 'rgba(59, 130, 246, 0.7)',
              borderColor: 'rgb(59, 130, 246)',
              borderWidth: 1
            },
            {
              label: '곡선 시간',
              data: curveTimes,
              backgroundColor: 'rgba(239, 68, 68, 0.7)',
              borderColor: 'rgb(239, 68, 68)',
              borderWidth: 1
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                boxWidth: 12,
                padding: 10,
                font: { size: 11 }
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `${context.dataset.label}: ${context.parsed.y.toFixed(2)}초`;
                },
                afterLabel: function(context) {
                  const total = straightTimes[context.dataIndex] + curveTimes[context.dataIndex];
                  if (context.datasetIndex === 1) {
                    return `총 시간: ${total.toFixed(2)}초`;
                  }
                }
              }
            }
          },
          scales: {
            x: {
              stacked: true,
              ticks: { font: { size: 10 } }
            },
            y: {
              stacked: true,
              beginAtZero: true,
              ticks: { font: { size: 10 } },
              title: {
                display: true,
                text: '시간 (초)',
                font: { size: 11 }
              }
            }
          }
        }
      });
      
      // Highlight selected lane
      const selectedIndex = selectedLane - 1;
      distanceChartInstance.data.datasets.forEach(dataset => {
        dataset.backgroundColor = dataset.data.map((_, index) => {
          if (index === selectedIndex) {
            return dataset.label.includes('직선') ? 
              'rgba(59, 130, 246, 1)' : 'rgba(239, 68, 68, 1)';
          }
          return dataset.label.includes('직선') ? 
            'rgba(59, 130, 246, 0.5)' : 'rgba(239, 68, 68, 0.5)';
        });
      });
      
      timeChartInstance.data.datasets.forEach(dataset => {
        dataset.backgroundColor = dataset.data.map((_, index) => {
          if (index === selectedIndex) {
            return dataset.label.includes('직선') ? 
              'rgba(59, 130, 246, 1)' : 'rgba(239, 68, 68, 1)';
          }
          return dataset.label.includes('직선') ? 
            'rgba(59, 130, 246, 0.5)' : 'rgba(239, 68, 68, 0.5)';
        });
      });
      
      distanceChartInstance.update();
      timeChartInstance.update();
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      selectLane(1);
    });
  </script>
</body>
</html>