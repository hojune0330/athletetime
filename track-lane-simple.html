<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>400m 트랙 레인 계산기 | Athlete Time</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', '맑은 고딕', sans-serif;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .lane-1 { stroke: #ef4444; fill: none; }
    .lane-2 { stroke: #f97316; fill: none; }
    .lane-3 { stroke: #eab308; fill: none; }
    .lane-4 { stroke: #84cc16; fill: none; }
    .lane-5 { stroke: #22c55e; fill: none; }
    .lane-6 { stroke: #06b6d4; fill: none; }
    .lane-7 { stroke: #3b82f6; fill: none; }
    .lane-8 { stroke: #8b5cf6; fill: none; }
    
    .lane-selected {
      stroke-width: 4;
      opacity: 1;
    }
    
    .lane-unselected {
      stroke-width: 2;
      opacity: 0.3;
    }

    .time-display {
      font-size: 1.5rem;
      font-weight: bold;
      color: #1e40af;
    }

    .time-label {
      font-size: 0.875rem;
      color: #6b7280;
      margin-bottom: 0.25rem;
    }
  </style>
</head>
<body class="bg-gray-50">
  <div class="container mx-auto px-4 py-6 max-w-6xl">
    <!-- Header -->
    <div class="gradient-bg text-white p-4 rounded-lg mb-4">
      <div class="flex justify-between items-center">
        <div>
          <h1 class="text-2xl font-bold">400m 트랙 레인별 구간 시간 계산기</h1>
          <p class="text-sm opacity-90">직선 구간과 곡선 구간 시간을 정확하게 계산</p>
        </div>
        <button onclick="window.location.href='pace-calculator.html'" 
                class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded transition">
          <i class="fas fa-arrow-left mr-2"></i>돌아가기
        </button>
      </div>
    </div>

    <!-- 목표 시간 입력 섹션 -->
    <div class="bg-white rounded-lg shadow p-6 mb-4">
      <div class="flex flex-wrap items-center gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">400m 목표 시간 (초)</label>
          <div class="flex gap-2">
            <input type="number" id="targetTime" value="72" min="30" max="120" step="0.1"
                   class="w-32 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
            <button onclick="calculateAll()" 
                    class="bg-purple-600 text-white px-6 py-2 rounded-md hover:bg-purple-700 transition">
              계산하기
            </button>
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">선택 레인</label>
          <select id="laneSelector" onchange="calculateAll()" 
                  class="px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
            <option value="1">레인 1 (400.00m)</option>
            <option value="2">레인 2 (407.67m)</option>
            <option value="3">레인 3 (415.33m)</option>
            <option value="4">레인 4 (423.00m)</option>
            <option value="5">레인 5 (430.66m)</option>
            <option value="6">레인 6 (438.33m)</option>
            <option value="7">레인 7 (445.99m)</option>
            <option value="8">레인 8 (453.66m)</option>
          </select>
        </div>
      </div>
    </div>

    <!-- 메인 구간 시간 표시 -->
    <div class="bg-white rounded-lg shadow p-6 mb-4">
      <h2 class="text-xl font-bold mb-4">
        <span id="selectedLaneDisplay">레인 1</span> 구간별 시간 분석
      </h2>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- 직선 구간 시간 -->
        <div class="bg-blue-50 rounded-lg p-4 border-2 border-blue-200">
          <div class="time-label">직선 구간 (2 × 84.39m)</div>
          <div class="time-display text-blue-600" id="straightTime">0.00초</div>
          <div class="text-sm text-gray-600 mt-2">
            <span id="straightDistance">168.78</span>m / 
            <span id="straightPercentage">42.2</span>%
          </div>
        </div>
        
        <!-- 곡선 구간 시간 -->
        <div class="bg-red-50 rounded-lg p-4 border-2 border-red-200">
          <div class="time-label">곡선 구간 (2 × 반원)</div>
          <div class="time-display text-red-600" id="curveTime">0.00초</div>
          <div class="text-sm text-gray-600 mt-2">
            <span id="curveDistance">231.22</span>m / 
            <span id="curvePercentage">57.8</span>%
          </div>
        </div>
        
        <!-- 총 시간 -->
        <div class="bg-green-50 rounded-lg p-4 border-2 border-green-200">
          <div class="time-label">총 소요 시간</div>
          <div class="time-display text-green-600" id="totalTime">0.00초</div>
          <div class="text-sm text-gray-600 mt-2">
            총 거리: <span id="totalDistance">400.00</span>m
          </div>
        </div>
      </div>

      <!-- 구간별 속도 정보 -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
        <div class="bg-gray-50 rounded-lg p-3">
          <span class="text-sm text-gray-600">평균 속도:</span>
          <span class="font-semibold ml-2" id="avgSpeed">0.00 m/s</span>
          <span class="text-sm text-gray-500 ml-1">(<span id="avgKmh">0.00</span> km/h)</span>
        </div>
        <div class="bg-gray-50 rounded-lg p-3">
          <span class="text-sm text-gray-600">100m 구간 페이스:</span>
          <span class="font-semibold ml-2" id="pace100m">0.00초</span>
        </div>
      </div>
    </div>

    <!-- 전체 레인 비교 테이블 -->
    <div class="bg-white rounded-lg shadow p-4 mb-4">
      <h3 class="font-bold text-lg mb-3">전체 레인 구간별 시간 상세</h3>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead class="bg-gray-100">
            <tr>
              <th class="px-3 py-2 text-left">레인</th>
              <th class="px-3 py-2 text-center">총 거리</th>
              <th class="px-3 py-2 text-center">직선 거리</th>
              <th class="px-3 py-2 text-center">곡선 거리</th>
              <th class="px-3 py-2 text-center bg-blue-50">직선 시간</th>
              <th class="px-3 py-2 text-center bg-red-50">곡선 시간</th>
              <th class="px-3 py-2 text-center bg-green-50">총 시간</th>
            </tr>
          </thead>
          <tbody id="laneTableBody">
            <!-- 동적으로 생성됨 -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- 트랙 시각화 및 선택 레인 정보 -->
    <div class="bg-white rounded-lg shadow p-4">
      <h3 class="font-bold text-lg mb-3">트랙 레이아웃 및 선택 레인 정보</h3>
      
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
        <!-- 트랙 시각화 -->
        <div>
          <svg viewBox="0 0 400 250" class="w-full" style="max-height: 350px;">
            <!-- 배경 -->
            <rect width="400" height="250" fill="#f9fafb"/>
            
            <!-- 트랙 레인 -->
            <g>
              <!-- 레인 8 (가장 바깥쪽) -->
              <rect x="30" y="30" width="340" height="190" rx="95" class="lane-8 lane-unselected" id="svgLane8"/>
              <!-- 레인 7 -->
              <rect x="40" y="40" width="320" height="170" rx="85" class="lane-7 lane-unselected" id="svgLane7"/>
              <!-- 레인 6 -->
              <rect x="50" y="50" width="300" height="150" rx="75" class="lane-6 lane-unselected" id="svgLane6"/>
              <!-- 레인 5 -->
              <rect x="60" y="60" width="280" height="130" rx="65" class="lane-5 lane-unselected" id="svgLane5"/>
              <!-- 레인 4 -->
              <rect x="70" y="70" width="260" height="110" rx="55" class="lane-4 lane-unselected" id="svgLane4"/>
              <!-- 레인 3 -->
              <rect x="80" y="80" width="240" height="90" rx="45" class="lane-3 lane-unselected" id="svgLane3"/>
              <!-- 레인 2 -->
              <rect x="90" y="90" width="220" height="70" rx="35" class="lane-2 lane-unselected" id="svgLane2"/>
              <!-- 레인 1 (가장 안쪽) -->
              <rect x="100" y="100" width="200" height="50" rx="25" class="lane-1 lane-selected" id="svgLane1"/>
            </g>
            
            <!-- 구간 표시 -->
            <line x1="200" y1="20" x2="200" y2="230" stroke="black" stroke-width="2" stroke-dasharray="5,5"/>
            <text x="200" y="15" font-size="11" font-weight="bold" text-anchor="middle">START/FINISH</text>
            
            <!-- 구간 라벨 -->
            <text x="150" y="125" font-size="14" fill="#3b82f6" font-weight="bold" text-anchor="middle">직선</text>
            <text x="250" y="125" font-size="14" fill="#3b82f6" font-weight="bold" text-anchor="middle">직선</text>
            <text x="70" y="125" font-size="14" fill="#ef4444" font-weight="bold" text-anchor="middle">곡선</text>
            <text x="330" y="125" font-size="14" fill="#ef4444" font-weight="bold" text-anchor="middle">곡선</text>
            
            <!-- 선택 레인 정보 표시 -->
            <text id="svgLaneInfo" x="200" y="240" font-size="12" font-weight="bold" text-anchor="middle"></text>
          </svg>
        </div>
        
        <!-- 선택 레인 상세 정보 -->
        <div class="bg-gradient-to-br from-purple-50 to-blue-50 rounded-lg p-4">
          <h4 class="font-bold text-lg mb-3" id="laneDetailTitle">레인 1 상세 정보</h4>
          
          <div class="space-y-3">
            <div class="flex justify-between items-center p-2 bg-white rounded">
              <span class="text-gray-600">총 거리</span>
              <span class="font-bold text-lg" id="detailTotalDistance">400.00m</span>
            </div>
            
            <div class="flex justify-between items-center p-2 bg-white rounded">
              <span class="text-gray-600">스태거 (추가 거리)</span>
              <span class="font-bold" id="detailStagger">0.00m</span>
            </div>
            
            <div class="flex justify-between items-center p-2 bg-blue-50 rounded">
              <span class="text-blue-700">직선 구간 (2×84.39m)</span>
              <span class="font-bold text-blue-700" id="detailStraight">168.78m</span>
            </div>
            
            <div class="flex justify-between items-center p-2 bg-red-50 rounded">
              <span class="text-red-700">곡선 구간</span>
              <span class="font-bold text-red-700" id="detailCurve">231.22m</span>
            </div>
            
            <div class="flex justify-between items-center p-2 bg-white rounded">
              <span class="text-gray-600">곡선 반경</span>
              <span class="font-bold" id="detailRadius">36.80m</span>
            </div>
            
            <div class="flex justify-between items-center p-2 bg-green-50 rounded">
              <span class="text-green-700">보정된 시간</span>
              <span class="font-bold text-green-700 text-lg" id="detailAdjustedTime">72.00초</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 하단 정보 -->
    <div class="bg-gray-100 rounded-lg p-4 mt-4 text-sm text-gray-600">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <i class="fas fa-info-circle text-blue-500"></i>
          <span class="ml-2">직선 구간: 각 84.39m (총 168.78m)</span>
        </div>
        <div>
          <i class="fas fa-info-circle text-red-500"></i>
          <span class="ml-2">곡선 구간: 2 × π × (36.8m + (레인-1) × 1.22m)</span>
        </div>
        <div>
          <i class="fas fa-info-circle text-green-500"></i>
          <span class="ml-2">레인폭: 1.22m (IAAF 규격)</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 레인 데이터 - 1레인이 정확히 400m가 되도록 수정
    // 1레인 곡선 반경을 역산: (400 - 168.78) / (2π) = 36.8m
    const STRAIGHT_LENGTH = 84.39 * 2; // 168.78m
    const LANE_WIDTH = 1.22;
    const BASE_RADIUS = 36.8; // 1레인이 정확히 400m가 되는 반경
    
    const laneData = [
      { lane: 1, radius: BASE_RADIUS, color: '#ef4444' },
      { lane: 2, radius: BASE_RADIUS + LANE_WIDTH * 1, color: '#f97316' },
      { lane: 3, radius: BASE_RADIUS + LANE_WIDTH * 2, color: '#eab308' },
      { lane: 4, radius: BASE_RADIUS + LANE_WIDTH * 3, color: '#84cc16' },
      { lane: 5, radius: BASE_RADIUS + LANE_WIDTH * 4, color: '#22c55e' },
      { lane: 6, radius: BASE_RADIUS + LANE_WIDTH * 5, color: '#06b6d4' },
      { lane: 7, radius: BASE_RADIUS + LANE_WIDTH * 6, color: '#3b82f6' },
      { lane: 8, radius: BASE_RADIUS + LANE_WIDTH * 7, color: '#8b5cf6' }
    ];

    // 레인 거리 계산
    function calculateLaneDistance(laneNumber) {
      const lane = laneData[laneNumber - 1];
      const straightLength = STRAIGHT_LENGTH; // 168.78m
      const curveLength = 2 * Math.PI * lane.radius; // 곡선 구간 총 길이 (원주)
      const totalDistance = straightLength + curveLength;
      
      return {
        straightLength: straightLength,
        curveLength: curveLength,
        totalDistance: totalDistance,
        stagger: totalDistance - 400,
        straightPercentage: (straightLength / totalDistance * 100),
        curvePercentage: (curveLength / totalDistance * 100),
        radius: lane.radius
      };
    }

    // 시간 계산
    function calculateTimes(laneNumber, targetTime400m) {
      const distances = calculateLaneDistance(laneNumber);
      
      // 레인 1 기준 속도 계산
      const baseSpeed = 400 / targetTime400m; // m/s
      
      // 실제 레인의 조정된 시간 (거리에 비례)
      const adjustedTotalTime = distances.totalDistance / baseSpeed;
      
      // 각 구간별 시간 계산
      const straightTime = distances.straightLength / baseSpeed;
      const curveTime = distances.curveLength / baseSpeed;
      
      return {
        straightTime: straightTime,
        curveTime: curveTime,
        totalTime: adjustedTotalTime,
        avgSpeed: baseSpeed,
        avgKmh: baseSpeed * 3.6,
        pace100m: 100 / baseSpeed,
        ...distances
      };
    }

    // 전체 계산 및 업데이트
    function calculateAll() {
      const targetTime = parseFloat(document.getElementById('targetTime').value) || 72;
      const selectedLane = parseInt(document.getElementById('laneSelector').value);
      
      // 선택된 레인 계산
      const result = calculateTimes(selectedLane, targetTime);
      
      // 메인 디스플레이 업데이트
      document.getElementById('selectedLaneDisplay').textContent = `레인 ${selectedLane}`;
      document.getElementById('straightTime').textContent = result.straightTime.toFixed(2) + '초';
      document.getElementById('curveTime').textContent = result.curveTime.toFixed(2) + '초';
      document.getElementById('totalTime').textContent = result.totalTime.toFixed(2) + '초';
      
      document.getElementById('straightDistance').textContent = result.straightLength.toFixed(2);
      document.getElementById('curveDistance').textContent = result.curveLength.toFixed(2);
      document.getElementById('totalDistance').textContent = result.totalDistance.toFixed(2);
      
      document.getElementById('straightPercentage').textContent = result.straightPercentage.toFixed(1);
      document.getElementById('curvePercentage').textContent = result.curvePercentage.toFixed(1);
      
      document.getElementById('avgSpeed').textContent = result.avgSpeed.toFixed(2) + ' m/s';
      document.getElementById('avgKmh').textContent = result.avgKmh.toFixed(1);
      document.getElementById('pace100m').textContent = result.pace100m.toFixed(2) + '초';
      
      // 선택 레인 상세 정보 업데이트
      document.getElementById('laneDetailTitle').textContent = `레인 ${selectedLane} 상세 정보`;
      document.getElementById('detailTotalDistance').textContent = result.totalDistance.toFixed(2) + 'm';
      document.getElementById('detailStagger').textContent = '+' + result.stagger.toFixed(2) + 'm';
      document.getElementById('detailStraight').textContent = result.straightLength.toFixed(2) + 'm';
      document.getElementById('detailCurve').textContent = result.curveLength.toFixed(2) + 'm';
      document.getElementById('detailRadius').textContent = result.radius.toFixed(2) + 'm';
      document.getElementById('detailAdjustedTime').textContent = result.totalTime.toFixed(2) + '초';
      
      // SVG 트랙 정보 업데이트
      document.getElementById('svgLaneInfo').textContent = 
        `레인 ${selectedLane}: 총 ${result.totalDistance.toFixed(2)}m (직선 ${result.straightLength.toFixed(2)}m + 곡선 ${result.curveLength.toFixed(2)}m)`;
      
      // SVG 트랙 업데이트
      updateTrackVisualization(selectedLane);
      
      // 테이블 업데이트
      updateLaneTable(targetTime, selectedLane);
      
      // 레인 선택자 옵션 텍스트 업데이트
      updateLaneSelector();
    }

    // 레인 선택자 업데이트
    function updateLaneSelector() {
      const selector = document.getElementById('laneSelector');
      for (let i = 1; i <= 8; i++) {
        const distances = calculateLaneDistance(i);
        selector.options[i-1].text = `레인 ${i} (${distances.totalDistance.toFixed(2)}m)`;
      }
    }

    // 트랙 시각화 업데이트
    function updateTrackVisualization(selectedLane) {
      for (let i = 1; i <= 8; i++) {
        const element = document.getElementById(`svgLane${i}`);
        if (i === selectedLane) {
          element.classList.remove('lane-unselected');
          element.classList.add('lane-selected');
        } else {
          element.classList.remove('lane-selected');
          element.classList.add('lane-unselected');
        }
      }
    }

    // 테이블 업데이트
    function updateLaneTable(targetTime, selectedLane) {
      const tbody = document.getElementById('laneTableBody');
      tbody.innerHTML = '';
      
      for (let i = 1; i <= 8; i++) {
        const result = calculateTimes(i, targetTime);
        const isSelected = i === selectedLane;
        
        const row = `
          <tr class="${isSelected ? 'bg-purple-50 font-bold' : ''} hover:bg-gray-50 cursor-pointer" onclick="selectLane(${i})">
            <td class="px-3 py-2">
              <span class="inline-block w-3 h-3 rounded-full mr-2" 
                    style="background-color: ${laneData[i-1].color}"></span>
              레인 ${i}
            </td>
            <td class="px-3 py-2 text-center">${result.totalDistance.toFixed(2)}m</td>
            <td class="px-3 py-2 text-center">${result.straightLength.toFixed(2)}m</td>
            <td class="px-3 py-2 text-center">${result.curveLength.toFixed(2)}m</td>
            <td class="px-3 py-2 text-center bg-blue-50 font-semibold text-blue-700">
              ${result.straightTime.toFixed(2)}초
            </td>
            <td class="px-3 py-2 text-center bg-red-50 font-semibold text-red-700">
              ${result.curveTime.toFixed(2)}초
            </td>
            <td class="px-3 py-2 text-center bg-green-50 font-semibold text-green-700">
              ${result.totalTime.toFixed(2)}초
            </td>
          </tr>
        `;
        tbody.innerHTML += row;
      }
    }

    // 테이블에서 레인 선택
    function selectLane(laneNumber) {
      document.getElementById('laneSelector').value = laneNumber;
      calculateAll();
    }

    // 페이지 로드 시 초기 계산
    document.addEventListener('DOMContentLoaded', function() {
      calculateAll();
    });
  </script>
</body>
</html>