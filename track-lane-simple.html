<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>400m 트랙 레인 계산기 | Athlete Time</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', '맑은 고딕', sans-serif;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .lane-1 { stroke: #ef4444; }
    .lane-2 { stroke: #f97316; }
    .lane-3 { stroke: #eab308; }
    .lane-4 { stroke: #84cc16; }
    .lane-5 { stroke: #22c55e; }
    .lane-6 { stroke: #06b6d4; }
    .lane-7 { stroke: #3b82f6; }
    .lane-8 { stroke: #8b5cf6; }
    
    .lane-selected {
      stroke-width: 4;
      opacity: 1;
    }
    
    .lane-unselected {
      stroke-width: 2;
      opacity: 0.3;
    }

    /* 시간 표시를 위한 스타일 */
    .time-display {
      font-size: 1.5rem;
      font-weight: bold;
      color: #1e40af;
    }

    .time-label {
      font-size: 0.875rem;
      color: #6b7280;
      margin-bottom: 0.25rem;
    }
  </style>
</head>
<body class="bg-gray-50">
  <div class="container mx-auto px-4 py-6 max-w-7xl">
    <!-- Header -->
    <div class="gradient-bg text-white p-4 rounded-lg mb-4">
      <div class="flex justify-between items-center">
        <div>
          <h1 class="text-2xl font-bold">400m 트랙 레인별 구간 시간 계산기</h1>
          <p class="text-sm opacity-90">직선 구간과 곡선 구간 시간을 정확하게 계산</p>
        </div>
        <button onclick="window.location.href='pace-calculator.html'" 
                class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded transition">
          <i class="fas fa-arrow-left mr-2"></i>돌아가기
        </button>
      </div>
    </div>

    <!-- 목표 시간 입력 섹션 -->
    <div class="bg-white rounded-lg shadow p-6 mb-4">
      <div class="flex flex-wrap items-center gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">400m 목표 시간 (초)</label>
          <div class="flex gap-2">
            <input type="number" id="targetTime" value="50" min="30" max="120" step="0.1"
                   class="w-32 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
            <button onclick="calculateAll()" 
                    class="bg-purple-600 text-white px-6 py-2 rounded-md hover:bg-purple-700 transition">
              계산하기
            </button>
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">선택 레인</label>
          <select id="laneSelector" onchange="calculateAll()" 
                  class="px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
            <option value="1">레인 1 (400.00m)</option>
            <option value="2">레인 2 (407.67m)</option>
            <option value="3">레인 3 (415.33m)</option>
            <option value="4">레인 4 (423.00m)</option>
            <option value="5">레인 5 (430.66m)</option>
            <option value="6">레인 6 (438.33m)</option>
            <option value="7">레인 7 (445.99m)</option>
            <option value="8">레인 8 (453.66m)</option>
          </select>
        </div>
      </div>
    </div>

    <!-- 메인 구간 시간 표시 -->
    <div class="bg-white rounded-lg shadow p-6 mb-4">
      <h2 class="text-xl font-bold mb-4">
        <span id="selectedLaneDisplay">레인 1</span> 구간별 시간 분석
      </h2>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- 직선 구간 시간 -->
        <div class="bg-blue-50 rounded-lg p-4 border-2 border-blue-200">
          <div class="time-label">직선 구간 (2 × 84.39m)</div>
          <div class="time-display text-blue-600" id="straightTime">0.00초</div>
          <div class="text-sm text-gray-600 mt-2">
            <span id="straightDistance">168.78</span>m / 
            <span id="straightPercentage">42.2</span>%
          </div>
        </div>
        
        <!-- 곡선 구간 시간 -->
        <div class="bg-red-50 rounded-lg p-4 border-2 border-red-200">
          <div class="time-label">곡선 구간 (2 × 반원)</div>
          <div class="time-display text-red-600" id="curveTime">0.00초</div>
          <div class="text-sm text-gray-600 mt-2">
            <span id="curveDistance">231.22</span>m / 
            <span id="curvePercentage">57.8</span>%
          </div>
        </div>
        
        <!-- 총 시간 -->
        <div class="bg-green-50 rounded-lg p-4 border-2 border-green-200">
          <div class="time-label">총 소요 시간</div>
          <div class="time-display text-green-600" id="totalTime">0.00초</div>
          <div class="text-sm text-gray-600 mt-2">
            총 거리: <span id="totalDistance">400.00</span>m
          </div>
        </div>
      </div>

      <!-- 구간별 속도 정보 -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
        <div class="bg-gray-50 rounded-lg p-3">
          <span class="text-sm text-gray-600">평균 속도:</span>
          <span class="font-semibold ml-2" id="avgSpeed">0.00 m/s</span>
          <span class="text-sm text-gray-500 ml-1">(<span id="avgKmh">0.00</span> km/h)</span>
        </div>
        <div class="bg-gray-50 rounded-lg p-3">
          <span class="text-sm text-gray-600">100m 구간 페이스:</span>
          <span class="font-semibold ml-2" id="pace100m">0.00초</span>
        </div>
      </div>
    </div>

    <!-- 차트 섹션 -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
      <!-- 구간별 시간 차트 -->
      <div class="bg-white rounded-lg shadow p-4">
        <h3 class="font-bold text-lg mb-3">모든 레인 구간별 시간 비교</h3>
        <div style="height: 300px;">
          <canvas id="timeComparisonChart"></canvas>
        </div>
      </div>
      
      <!-- 원형 차트 - 선택된 레인 시간 비율 -->
      <div class="bg-white rounded-lg shadow p-4">
        <h3 class="font-bold text-lg mb-3">선택 레인 시간 분포</h3>
        <div style="height: 300px;">
          <canvas id="timePieChart"></canvas>
        </div>
      </div>
    </div>

    <!-- 전체 레인 비교 테이블 -->
    <div class="bg-white rounded-lg shadow p-4 mb-4">
      <h3 class="font-bold text-lg mb-3">전체 레인 구간별 시간 상세</h3>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead class="bg-gray-100">
            <tr>
              <th class="px-3 py-2 text-left">레인</th>
              <th class="px-3 py-2 text-center">총 거리</th>
              <th class="px-3 py-2 text-center">직선 거리</th>
              <th class="px-3 py-2 text-center">곡선 거리</th>
              <th class="px-3 py-2 text-center bg-blue-50">직선 시간</th>
              <th class="px-3 py-2 text-center bg-red-50">곡선 시간</th>
              <th class="px-3 py-2 text-center bg-green-50">총 시간</th>
            </tr>
          </thead>
          <tbody id="laneTableBody">
            <!-- 동적으로 생성됨 -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- 트랙 시각화 -->
    <div class="bg-white rounded-lg shadow p-4">
      <h3 class="font-bold text-lg mb-3">트랙 레이아웃</h3>
      <svg viewBox="0 0 400 250" class="w-full" style="max-height: 300px;">
        <!-- 배경 -->
        <rect width="400" height="250" fill="#f9fafb"/>
        
        <!-- 트랙 레인 -->
        <g fill="none">
          <!-- 레인 8 (가장 바깥쪽) -->
          <rect x="40" y="30" width="320" height="190" rx="95" class="lane-8 lane-unselected" id="svgLane8"/>
          <!-- 레인 7 -->
          <rect x="50" y="40" width="300" height="170" rx="85" class="lane-7 lane-unselected" id="svgLane7"/>
          <!-- 레인 6 -->
          <rect x="60" y="50" width="280" height="150" rx="75" class="lane-6 lane-unselected" id="svgLane6"/>
          <!-- 레인 5 -->
          <rect x="70" y="60" width="260" height="130" rx="65" class="lane-5 lane-unselected" id="svgLane5"/>
          <!-- 레인 4 -->
          <rect x="80" y="70" width="240" height="110" rx="55" class="lane-4 lane-unselected" id="svgLane4"/>
          <!-- 레인 3 -->
          <rect x="90" y="80" width="220" height="90" rx="45" class="lane-3 lane-unselected" id="svgLane3"/>
          <!-- 레인 2 -->
          <rect x="100" y="90" width="200" height="70" rx="35" class="lane-2 lane-unselected" id="svgLane2"/>
          <!-- 레인 1 (가장 안쪽) -->
          <rect x="110" y="100" width="180" height="50" rx="25" class="lane-1 lane-selected" id="svgLane1"/>
        </g>
        
        <!-- 구간 표시 -->
        <line x1="200" y1="20" x2="200" y2="230" stroke="black" stroke-width="2" stroke-dasharray="5,5"/>
        <text x="200" y="15" font-size="11" font-weight="bold" text-anchor="middle">START/FINISH</text>
        
        <!-- 구간 라벨 -->
        <text x="150" y="125" font-size="14" fill="#3b82f6" font-weight="bold" text-anchor="middle">직선</text>
        <text x="250" y="125" font-size="14" fill="#3b82f6" font-weight="bold" text-anchor="middle">직선</text>
        <text x="80" y="125" font-size="14" fill="#ef4444" font-weight="bold" text-anchor="middle">곡선</text>
        <text x="320" y="125" font-size="14" fill="#ef4444" font-weight="bold" text-anchor="middle">곡선</text>
      </svg>
    </div>

    <!-- 하단 정보 -->
    <div class="bg-gray-100 rounded-lg p-4 mt-4 text-sm text-gray-600">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <i class="fas fa-info-circle text-blue-500"></i>
          <span class="ml-2">직선 구간: 각 84.39m (총 168.78m)</span>
        </div>
        <div>
          <i class="fas fa-info-circle text-red-500"></i>
          <span class="ml-2">곡선 구간: 반경 36.5m + (레인-1) × 1.22m</span>
        </div>
        <div>
          <i class="fas fa-info-circle text-green-500"></i>
          <span class="ml-2">레인폭: 1.22m (IAAF 규격)</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 레인 데이터
    const laneData = [
      { lane: 1, radius: 36.50, color: '#ef4444' },
      { lane: 2, radius: 37.72, color: '#f97316' },
      { lane: 3, radius: 38.94, color: '#eab308' },
      { lane: 4, radius: 40.16, color: '#84cc16' },
      { lane: 5, radius: 41.38, color: '#22c55e' },
      { lane: 6, radius: 42.60, color: '#06b6d4' },
      { lane: 7, radius: 43.82, color: '#3b82f6' },
      { lane: 8, radius: 45.04, color: '#8b5cf6' }
    ];

    // 차트 인스턴스
    let timeComparisonChart = null;
    let timePieChart = null;

    // 레인 거리 계산
    function calculateLaneDistance(laneNumber) {
      const lane = laneData[laneNumber - 1];
      const straightLength = 84.39 * 2; // 직선 구간 총 길이
      const curveLength = Math.PI * lane.radius * 2; // 곡선 구간 총 길이 (원주)
      const totalDistance = straightLength + curveLength;
      
      return {
        straightLength: straightLength,
        curveLength: curveLength,
        totalDistance: totalDistance,
        straightPercentage: (straightLength / totalDistance * 100),
        curvePercentage: (curveLength / totalDistance * 100)
      };
    }

    // 시간 계산
    function calculateTimes(laneNumber, targetTime400m) {
      const distances = calculateLaneDistance(laneNumber);
      
      // 레인 1 기준 속도 계산
      const baseSpeed = 400 / targetTime400m; // m/s
      
      // 실제 레인의 조정된 시간 (거리에 비례)
      const adjustedTotalTime = distances.totalDistance / baseSpeed;
      
      // 각 구간별 시간 계산
      const straightTime = distances.straightLength / baseSpeed;
      const curveTime = distances.curveLength / baseSpeed;
      
      return {
        straightTime: straightTime,
        curveTime: curveTime,
        totalTime: adjustedTotalTime,
        avgSpeed: baseSpeed,
        avgKmh: baseSpeed * 3.6,
        pace100m: 100 / baseSpeed,
        ...distances
      };
    }

    // 전체 계산 및 업데이트
    function calculateAll() {
      const targetTime = parseFloat(document.getElementById('targetTime').value) || 50;
      const selectedLane = parseInt(document.getElementById('laneSelector').value);
      
      // 선택된 레인 계산
      const result = calculateTimes(selectedLane, targetTime);
      
      // 메인 디스플레이 업데이트
      document.getElementById('selectedLaneDisplay').textContent = `레인 ${selectedLane}`;
      document.getElementById('straightTime').textContent = result.straightTime.toFixed(2) + '초';
      document.getElementById('curveTime').textContent = result.curveTime.toFixed(2) + '초';
      document.getElementById('totalTime').textContent = result.totalTime.toFixed(2) + '초';
      
      document.getElementById('straightDistance').textContent = result.straightLength.toFixed(2);
      document.getElementById('curveDistance').textContent = result.curveLength.toFixed(2);
      document.getElementById('totalDistance').textContent = result.totalDistance.toFixed(2);
      
      document.getElementById('straightPercentage').textContent = result.straightPercentage.toFixed(1);
      document.getElementById('curvePercentage').textContent = result.curvePercentage.toFixed(1);
      
      document.getElementById('avgSpeed').textContent = result.avgSpeed.toFixed(2) + ' m/s';
      document.getElementById('avgKmh').textContent = result.avgKmh.toFixed(1);
      document.getElementById('pace100m').textContent = result.pace100m.toFixed(2) + '초';
      
      // SVG 트랙 업데이트
      updateTrackVisualization(selectedLane);
      
      // 테이블 업데이트
      updateLaneTable(targetTime, selectedLane);
      
      // 차트 업데이트
      updateCharts(targetTime, selectedLane);
    }

    // 트랙 시각화 업데이트
    function updateTrackVisualization(selectedLane) {
      for (let i = 1; i <= 8; i++) {
        const element = document.getElementById(`svgLane${i}`);
        if (i === selectedLane) {
          element.classList.remove('lane-unselected');
          element.classList.add('lane-selected');
        } else {
          element.classList.remove('lane-selected');
          element.classList.add('lane-unselected');
        }
      }
    }

    // 테이블 업데이트
    function updateLaneTable(targetTime, selectedLane) {
      const tbody = document.getElementById('laneTableBody');
      tbody.innerHTML = '';
      
      for (let i = 1; i <= 8; i++) {
        const result = calculateTimes(i, targetTime);
        const isSelected = i === selectedLane;
        
        const row = `
          <tr class="${isSelected ? 'bg-purple-50 font-bold' : ''} hover:bg-gray-50">
            <td class="px-3 py-2">
              <span class="inline-block w-3 h-3 rounded-full mr-2" 
                    style="background-color: ${laneData[i-1].color}"></span>
              레인 ${i}
            </td>
            <td class="px-3 py-2 text-center">${result.totalDistance.toFixed(2)}m</td>
            <td class="px-3 py-2 text-center">${result.straightLength.toFixed(2)}m</td>
            <td class="px-3 py-2 text-center">${result.curveLength.toFixed(2)}m</td>
            <td class="px-3 py-2 text-center bg-blue-50 font-semibold">${result.straightTime.toFixed(2)}초</td>
            <td class="px-3 py-2 text-center bg-red-50 font-semibold">${result.curveTime.toFixed(2)}초</td>
            <td class="px-3 py-2 text-center bg-green-50 font-semibold">${result.totalTime.toFixed(2)}초</td>
          </tr>
        `;
        tbody.innerHTML += row;
      }
    }

    // 차트 업데이트
    function updateCharts(targetTime, selectedLane) {
      // 데이터 준비
      const labels = [];
      const straightTimes = [];
      const curveTimes = [];
      
      for (let i = 1; i <= 8; i++) {
        const result = calculateTimes(i, targetTime);
        labels.push(`레인 ${i}`);
        straightTimes.push(result.straightTime.toFixed(2));
        curveTimes.push(result.curveTime.toFixed(2));
      }
      
      // 막대 차트 - 모든 레인 비교
      const comparisonCtx = document.getElementById('timeComparisonChart').getContext('2d');
      
      if (timeComparisonChart) {
        timeComparisonChart.destroy();
      }
      
      timeComparisonChart = new Chart(comparisonCtx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [
            {
              label: '직선 구간 시간',
              data: straightTimes,
              backgroundColor: 'rgba(59, 130, 246, 0.7)',
              borderColor: 'rgb(59, 130, 246)',
              borderWidth: 1
            },
            {
              label: '곡선 구간 시간',
              data: curveTimes,
              backgroundColor: 'rgba(239, 68, 68, 0.7)',
              borderColor: 'rgb(239, 68, 68)',
              borderWidth: 1
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return context.dataset.label + ': ' + context.parsed.y + '초';
                }
              }
            }
          },
          scales: {
            x: {
              stacked: true
            },
            y: {
              stacked: true,
              beginAtZero: true,
              title: {
                display: true,
                text: '시간 (초)'
              }
            }
          }
        }
      });
      
      // 원형 차트 - 선택된 레인의 시간 분포
      const selectedResult = calculateTimes(selectedLane, targetTime);
      const pieCtx = document.getElementById('timePieChart').getContext('2d');
      
      if (timePieChart) {
        timePieChart.destroy();
      }
      
      timePieChart = new Chart(pieCtx, {
        type: 'doughnut',
        data: {
          labels: ['직선 구간', '곡선 구간'],
          datasets: [{
            data: [
              selectedResult.straightTime.toFixed(2),
              selectedResult.curveTime.toFixed(2)
            ],
            backgroundColor: [
              'rgba(59, 130, 246, 0.8)',
              'rgba(239, 68, 68, 0.8)'
            ],
            borderColor: [
              'rgb(59, 130, 246)',
              'rgb(239, 68, 68)'
            ],
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const label = context.label || '';
                  const value = context.parsed;
                  const total = context.dataset.data.reduce((a, b) => parseFloat(a) + parseFloat(b), 0);
                  const percentage = ((value / total) * 100).toFixed(1);
                  return `${label}: ${value}초 (${percentage}%)`;
                }
              }
            }
          }
        }
      });
      
      // 선택된 레인 하이라이트
      timeComparisonChart.data.datasets.forEach(dataset => {
        dataset.backgroundColor = dataset.data.map((_, index) => {
          if (index === selectedLane - 1) {
            return dataset.label.includes('직선') ? 
              'rgba(59, 130, 246, 1)' : 'rgba(239, 68, 68, 1)';
          }
          return dataset.label.includes('직선') ? 
            'rgba(59, 130, 246, 0.5)' : 'rgba(239, 68, 68, 0.5)';
        });
      });
      
      timeComparisonChart.update();
    }

    // 페이지 로드 시 초기 계산
    document.addEventListener('DOMContentLoaded', function() {
      calculateAll();
    });
  </script>
</body>
</html>