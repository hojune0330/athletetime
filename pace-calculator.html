<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>러닝 페이스 계산기 | 애슬리트 타임</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  <style>
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Malgun Gothic', '맑은 고딕', sans-serif;
      -webkit-tap-highlight-color: transparent;
    }
    
    .gradient-text {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .card-hover {
      transition: all 0.3s ease;
    }
    
    .card-hover:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    
    .pace-table {
      font-size: 11px;
    }
    
    .pace-table td, .pace-table th {
      padding: 4px;
      text-align: center;
      border: 1px solid #e5e7eb;
      white-space: nowrap;
    }
    
    .pace-table .highlight-row {
      background: linear-gradient(90deg, #fef3c7 0%, #fde68a 100%);
    }
    
    .pace-table .highlight-cell {
      background: #fbbf24;
      font-weight: bold;
    }
    
    .lane-track {
      background: linear-gradient(135deg, #f97316 0%, #dc2626 100%);
      color: white;
    }
    
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      opacity: 1;
      height: 40px;
    }
    
    .tab-active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    @media print {
      .no-print { display: none; }
      .pace-table { page-break-inside: avoid; }
    }
    
    .table-container {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
  </style>
</head>
<body class="bg-gray-50">
  
  <!-- Header -->
  <header class="bg-gradient-to-r from-orange-500 to-red-600 text-white p-4 sticky top-0 z-10 no-print">
    <div class="max-w-6xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-3">
        <button onclick="goBack()" class="p-1">
          <i class="fas fa-arrow-left text-lg"></i>
        </button>
        <h1 class="text-xl font-bold">러닝 페이스 계산기</h1>
      </div>
      <button onclick="window.print()" class="p-2 hover:bg-white/20 rounded-lg">
        <i class="fas fa-print"></i>
      </button>
    </div>
  </header>

  <div class="max-w-6xl mx-auto p-4 pb-20">
    
    <!-- 탭 메뉴 -->
    <div class="flex gap-2 mb-6 overflow-x-auto no-print">
      <button onclick="switchTab('chart')" id="tab-chart" class="tab-btn px-4 py-2 rounded-lg font-medium whitespace-nowrap tab-active">
        <i class="fas fa-table mr-2"></i>페이스 차트
      </button>
      <button onclick="switchTab('lane')" id="tab-lane" class="tab-btn px-4 py-2 rounded-lg font-medium whitespace-nowrap bg-white">
        <i class="fas fa-road mr-2"></i>레인별 계산
      </button>
      <button onclick="switchTab('target')" id="tab-target" class="tab-btn px-4 py-2 rounded-lg font-medium whitespace-nowrap bg-white">
        <i class="fas fa-bullseye mr-2"></i>목표 페이스
      </button>
      <button onclick="switchTab('split')" id="tab-split" class="tab-btn px-4 py-2 rounded-lg font-medium whitespace-nowrap bg-white">
        <i class="fas fa-chart-line mr-2"></i>스플릿 계산
      </button>
    </div>

    <!-- 페이스 차트 탭 -->
    <div id="chart-content" class="tab-content">
      <!-- 개발자 정보 -->
      <div class="bg-gradient-to-r from-purple-100 to-blue-100 rounded-lg p-4 mb-6">
        <div class="flex items-center justify-between">
          <div>
            <h3 class="font-bold text-purple-900">러닝 페이스 차트</h3>
            <p class="text-sm text-purple-700 mt-1">과학적 훈련을 위한 정밀 페이스 분석 도구</p>
          </div>
          <div class="text-right">
            <p class="text-xs text-purple-600">개발자</p>
            <p class="font-bold text-purple-900">장호준 코치</p>
          </div>
        </div>
      </div>

      <!-- 차트 1: 거리별 목표 시간 차트 -->
      <div class="bg-white rounded-lg shadow-md p-4 mb-6">
        <h3 class="text-lg font-bold mb-3">
          <i class="fas fa-chart-bar text-blue-500 mr-2"></i>
          거리별 목표 시간 차트
        </h3>
        
        <div class="bg-blue-50 border-l-4 border-blue-500 p-3 mb-4">
          <h4 class="font-bold text-blue-900 mb-1">차트 사용법</h4>
          <p class="text-sm text-blue-800">
            이 차트는 <strong>100m 기준 속도</strong>를 바탕으로 각 거리별 예상 기록을 보여줍니다.
            단거리부터 마라톤까지 다양한 거리에서의 목표 시간을 한눈에 확인할 수 있습니다.
            <br><br>
            <strong>특징:</strong> 거리가 길어질수록 페이스 저하를 고려한 실제적인 예측 시간을 제공합니다.
          </p>
        </div>
        
        <div class="table-container">
          <table class="pace-table w-full min-w-[1000px]">
            <thead class="bg-gray-100">
              <tr>
                <th class="p-2 sticky left-0 bg-gray-100">100m</th>
                <th class="p-2">200m</th>
                <th class="p-2">400m</th>
                <th class="p-2">800m</th>
                <th class="p-2">1500m</th>
                <th class="p-2">3000m</th>
                <th class="p-2">5000m</th>
                <th class="p-2">10km</th>
                <th class="p-2">15km</th>
                <th class="p-2">20km</th>
                <th class="p-2 bg-yellow-100">하프</th>
                <th class="p-2">25km</th>
                <th class="p-2">30km</th>
                <th class="p-2">35km</th>
                <th class="p-2">40km</th>
                <th class="p-2 bg-green-100">풀코스</th>
              </tr>
            </thead>
            <tbody id="paceChartBody1">
              <!-- 실제 계산된 데이터로 채워짐 -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- 차트 2: 마라톤 페이스별 트랙 랩타임 -->
      <div class="bg-white rounded-lg shadow-md p-4">
        <h3 class="text-lg font-bold mb-3">
          <i class="fas fa-running text-orange-500 mr-2"></i>
          마라톤 페이스별 400m 트랙 랩타임
        </h3>
        
        <div class="bg-orange-50 border-l-4 border-orange-500 p-3 mb-4">
          <h4 class="font-bold text-orange-900 mb-1">차트 사용법</h4>
          <p class="text-sm text-orange-800">
            이 차트는 <strong>마라톤 목표 기록</strong>에 따른 400m 트랙 각 레인별 랩타임을 보여줍니다.
            트랙 훈련 시 목표 마라톤 페이스를 유지하기 위한 정확한 랩타임을 제공합니다.
            <br><br>
            <strong>특징:</strong> 1번 레인(400m)부터 8번 레인(453m)까지 각 레인의 실제 거리를 고려한 정밀한 랩타임을 제공합니다.
            인터벌 훈련이나 페이스 러닝 시 자신의 레인에 맞는 정확한 목표 시간을 확인할 수 있습니다.
          </p>
        </div>
        
        <div class="table-container">
          <table class="pace-table w-full">
            <thead class="bg-gray-100">
              <tr>
                <th rowspan="2" class="p-2">마라톤<br>목표</th>
                <th rowspan="2" class="p-2">km당<br>페이스</th>
                <th colspan="8" class="p-2">400m 트랙 레인별 랩타임</th>
              </tr>
              <tr>
                <th class="p-2 bg-red-100">1레인<br>400m</th>
                <th class="p-2">2레인<br>407m</th>
                <th class="p-2">3레인<br>415m</th>
                <th class="p-2">4레인<br>422m</th>
                <th class="p-2">5레인<br>430m</th>
                <th class="p-2">6레인<br>438m</th>
                <th class="p-2">7레인<br>445m</th>
                <th class="p-2">8레인<br>453m</th>
              </tr>
            </thead>
            <tbody id="paceChartBody2">
              <!-- 실제 계산된 데이터로 채워짐 -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- 레인 계산기 탭 -->
    <div id="lane-content" class="tab-content hidden">
      <div class="bg-white rounded-lg shadow-md p-6 card-hover">
        <h2 class="text-xl font-bold mb-4">
          <i class="fas fa-road text-orange-500"></i> 400m 트랙 레인별 거리 계산기
        </h2>
        
        <div class="bg-orange-50 border-l-4 border-orange-500 p-4 mb-6">
          <p class="text-sm text-orange-800">
            <strong>IAAF 공식 규격:</strong> 1레인 반경 36.5m 기준, 레인 폭 1.22m
          </p>
        </div>
        
        <div class="grid grid-cols-2 gap-4 mb-6">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">레인 선택</label>
            <select id="laneNumber" onchange="calculateLane()" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
              <option value="1">1번 레인</option>
              <option value="2">2번 레인</option>
              <option value="3">3번 레인</option>
              <option value="4">4번 레인</option>
              <option value="5">5번 레인</option>
              <option value="6">6번 레인</option>
              <option value="7">7번 레인</option>
              <option value="8">8번 레인</option>
            </select>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">바퀴 수</label>
            <input type="number" id="laps" value="1" min="0.5" step="0.5" onchange="calculateLane()" 
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg">
          </div>
        </div>
        
        <div id="laneResults" class="space-y-3">
          <!-- 결과가 여기 표시됨 -->
        </div>
        
        <!-- 모든 레인 비교 테이블 -->
        <div class="mt-6 pt-6 border-t">
          <h3 class="font-bold mb-3">모든 레인 비교표</h3>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead class="bg-gray-100">
                <tr>
                  <th class="p-2">레인</th>
                  <th class="p-2">1바퀴(m)</th>
                  <th class="p-2">추가거리(m)</th>
                  <th class="p-2">비율(%)</th>
                </tr>
              </thead>
              <tbody id="allLanesTable">
                <!-- 동적으로 생성됨 -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- 목표 페이스 탭 -->
    <div id="target-content" class="tab-content hidden">
      <div class="bg-white rounded-lg shadow-md p-6 card-hover">
        <h2 class="text-xl font-bold mb-4">
          <i class="fas fa-bullseye text-blue-500"></i> 목표 페이스 계산기
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">목표 거리</label>
            <select id="targetDistance" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
              <option value="100">100m</option>
              <option value="200">200m</option>
              <option value="400">400m</option>
              <option value="800">800m</option>
              <option value="1500">1500m</option>
              <option value="3000">3000m</option>
              <option value="5000" selected>5000m (5km)</option>
              <option value="10000">10000m (10km)</option>
              <option value="21097.5">하프마라톤</option>
              <option value="42195">풀마라톤</option>
              <option value="custom">직접 입력</option>
            </select>
            <input type="number" id="customDistance" placeholder="거리 입력 (m)" 
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg mt-2 hidden">
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">목표 시간</label>
            <div class="flex gap-2">
              <input type="number" id="targetHours" placeholder="시" min="0" max="23" 
                     class="w-1/3 px-3 py-2 border border-gray-300 rounded-lg">
              <input type="number" id="targetMinutes" placeholder="분" min="0" max="59" 
                     class="w-1/3 px-3 py-2 border border-gray-300 rounded-lg">
              <input type="number" id="targetSeconds" placeholder="초" min="0" max="59" step="0.1" 
                     class="w-1/3 px-3 py-2 border border-gray-300 rounded-lg">
            </div>
          </div>
        </div>
        
        <button onclick="calculateTargetPace()" 
                class="w-full mt-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 rounded-lg font-medium hover:opacity-90 transition">
          페이스 계산하기
        </button>
        
        <div id="targetResults" class="mt-6 hidden">
          <div class="bg-blue-50 rounded-lg p-4">
            <h3 class="font-bold mb-3">페이스 분석 결과</h3>
            <div class="grid grid-cols-2 gap-4 text-sm">
              <div>
                <span class="text-gray-600">400m 랩:</span>
                <span class="font-mono font-bold ml-2" id="lap400">-</span>
              </div>
              <div>
                <span class="text-gray-600">100m 페이스:</span>
                <span class="font-mono font-bold ml-2" id="pace100m">-</span>
              </div>
              <div>
                <span class="text-gray-600">1km 페이스:</span>
                <span class="font-mono font-bold ml-2" id="pace1km">-</span>
              </div>
              <div>
                <span class="text-gray-600">평균 속도:</span>
                <span class="font-mono font-bold ml-2" id="avgSpeed">-</span>
              </div>
            </div>
            
            <div class="mt-4 pt-4 border-t">
              <h4 class="font-medium mb-2">랩 스플릿</h4>
              <div class="space-y-1 text-sm" id="lapSplits">
                <!-- 동적으로 생성됨 -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 스플릿 계산기 탭 -->
    <div id="split-content" class="tab-content hidden">
      <div class="bg-white rounded-lg shadow-md p-6 card-hover">
        <h2 class="text-xl font-bold mb-4">
          <i class="fas fa-chart-line text-green-500"></i> 스플릿 계산기
        </h2>
        
        <div class="space-y-4">
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">총 거리 (m)</label>
              <input type="number" id="splitTotalDistance" value="5000" 
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">구간 거리 (m)</label>
              <input type="number" id="splitInterval" value="1000" 
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg">
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">목표 시간</label>
            <div class="flex gap-2">
              <input type="number" id="splitHours" placeholder="시" min="0" 
                     class="w-1/3 px-3 py-2 border border-gray-300 rounded-lg">
              <input type="number" id="splitMinutes" placeholder="분" min="0" 
                     class="w-1/3 px-3 py-2 border border-gray-300 rounded-lg">
              <input type="number" id="splitSeconds" placeholder="초" min="0" step="0.1" 
                     class="w-1/3 px-3 py-2 border border-gray-300 rounded-lg">
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">페이스 전략</label>
            <select id="paceStrategy" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
              <option value="even">균등 페이스 (Even)</option>
              <option value="negative">네거티브 스플릿 (후반 가속)</option>
              <option value="positive">포지티브 스플릿 (전반 속도)</option>
            </select>
          </div>
        </div>
        
        <button onclick="calculateSplits()" 
                class="w-full mt-4 bg-gradient-to-r from-green-500 to-teal-600 text-white py-3 rounded-lg font-medium hover:opacity-90 transition">
          스플릿 계산하기
        </button>
        
        <div id="splitResults" class="mt-6 hidden">
          <div id="splitTable" class="overflow-x-auto">
            <!-- 동적으로 생성됨 -->
          </div>
        </div>
      </div>
    </div>
    
  </div>

  <script>
    // IAAF 표준 레인 거리
    const laneDistances = {
      1: 400.00,
      2: 407.04,
      3: 414.70,
      4: 422.37,
      5: 430.03,
      6: 437.70,
      7: 445.37,
      8: 453.03
    };

    // 시간 포맷팅 함수
    function formatTime(seconds) {
      if (seconds < 60) {
        return seconds.toFixed(2);
      } else if (seconds < 3600) {
        const mins = Math.floor(seconds / 60);
        const secs = (seconds % 60).toFixed(2);
        return `${mins}:${String(secs).padStart(5, '0')}`;
      } else {
        const hours = Math.floor(seconds / 3600);
        const mins = Math.floor((seconds % 3600) / 60);
        const secs = (seconds % 60).toFixed(2);
        return `${hours}:${String(mins).padStart(2, '0')}:${String(secs).padStart(5, '0')}`;
      }
    }

    // 시간을 초로 변환
    function timeToSeconds(hours, minutes, seconds) {
      return (hours || 0) * 3600 + (minutes || 0) * 60 + (seconds || 0);
    }

    // 탭 전환
    function switchTab(tabName) {
      // 모든 탭 내용 숨기기
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.add('hidden');
      });
      
      // 모든 탭 버튼 비활성화
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('tab-active');
        btn.classList.add('bg-white');
      });
      
      // 선택한 탭 활성화
      document.getElementById(`${tabName}-content`).classList.remove('hidden');
      document.getElementById(`tab-${tabName}`).classList.add('tab-active');
      document.getElementById(`tab-${tabName}`).classList.remove('bg-white');
      
      // 차트가 선택되면 차트 생성
      if (tabName === 'chart') {
        generatePaceChart1();
        generatePaceChart2();
      } else if (tabName === 'lane') {
        calculateLane();
        generateAllLanesTable();
      }
    }

    // 페이스 차트 1 생성 (거리별 목표 시간)
    function generatePaceChart1() {
      const tbody = document.getElementById('paceChartBody1');
      tbody.innerHTML = '';
      
      // 100m 기준 시간 (10초부터 20초까지)
      const base100Times = [];
      for (let time = 10.0; time <= 20.0; time += 0.2) {
        base100Times.push(time);
      }
      
      base100Times.forEach((base100, index) => {
        const row = tbody.insertRow();
        
        // 특정 행 하이라이트
        if (Math.abs(base100 - 11.0) < 0.01 || Math.abs(base100 - 12.0) < 0.01 || 
            Math.abs(base100 - 13.0) < 0.01 || Math.abs(base100 - 14.0) < 0.01 ||
            Math.abs(base100 - 15.0) < 0.01) {
          row.className = 'highlight-row';
        }
        
        // 거리별 예상 시간 계산
        const distances = [100, 200, 400, 800, 1500, 3000, 5000, 10000, 15000, 20000, 21097.5, 25000, 30000, 35000, 40000, 42195];
        
        distances.forEach((dist, i) => {
          let time;
          
          if (dist <= 400) {
            // 단거리: 속도 유지
            time = base100 * (dist / 100);
          } else if (dist <= 1500) {
            // 중거리: 약간의 속도 저하
            time = base100 * (dist / 100) * (1 + (dist - 400) / 20000);
          } else if (dist <= 10000) {
            // 장거리: 점진적 속도 저하
            time = base100 * (dist / 100) * (1 + (dist - 400) / 10000);
          } else {
            // 마라톤: 더 큰 속도 저하
            time = base100 * (dist / 100) * (1 + (dist - 400) / 8000);
          }
          
          const cell = row.insertCell();
          cell.textContent = formatTime(time);
          
          // 첫 번째 열 (100m) 강조
          if (i === 0) {
            cell.className = 'font-bold bg-gray-50 sticky left-0';
          }
          // 하프마라톤과 풀마라톤 열 배경색
          if (i === 10) cell.className = 'bg-yellow-50';
          if (i === 15) cell.className = 'bg-green-50';
        });
      });
    }

    // 페이스 차트 2 생성 (마라톤 페이스별 트랙 랩타임)
    function generatePaceChart2() {
      const tbody = document.getElementById('paceChartBody2');
      tbody.innerHTML = '';
      
      // 마라톤 목표 시간 (2시간부터 5시간까지 5분 단위)
      const marathonTimes = [];
      for (let hours = 2; hours <= 5; hours++) {
        for (let minutes = 0; minutes < 60; minutes += 5) {
          const totalMinutes = hours * 60 + minutes;
          if (totalMinutes >= 120 && totalMinutes <= 300) {
            marathonTimes.push(totalMinutes);
          }
        }
      }
      
      marathonTimes.forEach((totalMinutes, index) => {
        const row = tbody.insertRow();
        
        // 특정 시간 하이라이트 (서브3, 3시간 30분, 4시간)
        if (totalMinutes === 180 || totalMinutes === 210 || totalMinutes === 240) {
          row.className = 'highlight-row';
        }
        
        // 마라톤 시간 표시
        const hours = Math.floor(totalMinutes / 60);
        const mins = totalMinutes % 60;
        const marathonTime = `${hours}:${String(mins).padStart(2, '0')}:00`;
        
        // km당 페이스 계산
        const secondsPerKm = (totalMinutes * 60) / 42.195;
        const paceMinutes = Math.floor(secondsPerKm / 60);
        const paceSeconds = Math.round(secondsPerKm % 60);
        const kmPace = `${paceMinutes}:${String(paceSeconds).padStart(2, '0')}`;
        
        // 첫 두 열 (마라톤 목표, km 페이스)
        let cell = row.insertCell();
        cell.textContent = marathonTime;
        cell.className = 'font-bold';
        
        cell = row.insertCell();
        cell.textContent = kmPace;
        
        // 각 레인별 400m 랩타임 계산
        for (let lane = 1; lane <= 8; lane++) {
          const laneDistance = laneDistances[lane];
          const lapTime = (secondsPerKm / 1000) * laneDistance;
          
          cell = row.insertCell();
          cell.textContent = formatTime(lapTime);
          
          // 1번 레인 강조
          if (lane === 1) {
            cell.className = 'bg-red-50 font-bold';
          }
        }
      });
    }

    // 레인 계산
    function calculateLane() {
      const laneNumber = parseInt(document.getElementById('laneNumber').value);
      const laps = parseFloat(document.getElementById('laps').value);
      
      const distance = laneDistances[laneNumber];
      const totalDistance = distance * laps;
      const extraDistance = totalDistance - (400 * laps);
      
      const results = document.getElementById('laneResults');
      results.innerHTML = `
        <div class="bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg p-4 lane-track">
          <div class="text-3xl font-bold mb-2">${totalDistance.toFixed(2)}m</div>
          <div class="text-sm">
            ${laneNumber}번 레인 × ${laps}바퀴
          </div>
        </div>
        
        <div class="bg-gray-50 rounded-lg p-4">
          <div class="grid grid-cols-2 gap-4 text-sm">
            <div>
              <span class="text-gray-600">1바퀴 거리:</span>
              <span class="font-bold ml-2">${distance.toFixed(2)}m</span>
            </div>
            <div>
              <span class="text-gray-600">추가 거리:</span>
              <span class="font-bold ml-2 ${extraDistance > 0 ? 'text-red-600' : ''}">${extraDistance > 0 ? '+' : ''}${extraDistance.toFixed(2)}m</span>
            </div>
            <div>
              <span class="text-gray-600">1레인 대비:</span>
              <span class="font-bold ml-2">${((distance / 400 - 1) * 100).toFixed(1)}% 증가</span>
            </div>
            <div>
              <span class="text-gray-600">레인 반경:</span>
              <span class="font-bold ml-2">${(36.5 + (laneNumber - 1) * 1.22).toFixed(2)}m</span>
            </div>
          </div>
        </div>
      `;
    }

    // 모든 레인 비교표 생성
    function generateAllLanesTable() {
      const tbody = document.getElementById('allLanesTable');
      tbody.innerHTML = '';
      
      for (let lane = 1; lane <= 8; lane++) {
        const row = tbody.insertRow();
        const distance = laneDistances[lane];
        const extra = distance - 400;
        const percentage = ((distance / 400 - 1) * 100).toFixed(1);
        
        row.innerHTML = `
          <td class="p-2 font-bold">${lane}번</td>
          <td class="p-2">${distance.toFixed(2)}</td>
          <td class="p-2 ${extra > 0 ? 'text-red-600' : ''}">${extra > 0 ? '+' : ''}${extra.toFixed(2)}</td>
          <td class="p-2">${percentage}%</td>
        `;
        
        if (lane === 1) row.className = 'bg-red-50';
        if (lane === 8) row.className = 'bg-blue-50';
      }
    }

    // 목표 거리 선택 변경
    document.getElementById('targetDistance').addEventListener('change', function() {
      const customInput = document.getElementById('customDistance');
      if (this.value === 'custom') {
        customInput.classList.remove('hidden');
      } else {
        customInput.classList.add('hidden');
      }
    });

    // 목표 페이스 계산
    function calculateTargetPace() {
      const distanceSelect = document.getElementById('targetDistance');
      let distance = parseFloat(distanceSelect.value);
      
      if (distanceSelect.value === 'custom') {
        distance = parseFloat(document.getElementById('customDistance').value);
      }
      
      const hours = parseInt(document.getElementById('targetHours').value) || 0;
      const minutes = parseInt(document.getElementById('targetMinutes').value) || 0;
      const seconds = parseFloat(document.getElementById('targetSeconds').value) || 0;
      
      if (!distance || (hours === 0 && minutes === 0 && seconds === 0)) {
        alert('거리와 시간을 입력해주세요.');
        return;
      }
      
      const totalSeconds = hours * 3600 + minutes * 60 + seconds;
      
      // 페이스 계산
      const pace400 = (totalSeconds / distance) * 400;
      const pace100 = (totalSeconds / distance) * 100;
      const pace1km = (totalSeconds / distance) * 1000;
      const speedKmh = (distance / totalSeconds) * 3.6;
      
      // 결과 표시
      document.getElementById('lap400').textContent = formatTime(pace400);
      document.getElementById('pace100m').textContent = formatTime(pace100);
      document.getElementById('pace1km').textContent = formatTime(pace1km);
      document.getElementById('avgSpeed').textContent = speedKmh.toFixed(2) + ' km/h';
      
      // 랩 스플릿 계산
      const lapSplits = document.getElementById('lapSplits');
      lapSplits.innerHTML = '';
      
      const laps = [
        { dist: 400, name: '400m (1바퀴)' },
        { dist: 800, name: '800m (2바퀴)' },
        { dist: 1200, name: '1200m (3바퀴)' },
        { dist: 1600, name: '1600m (4바퀴)' },
        { dist: 2000, name: '2000m (5바퀴)' },
        { dist: 3000, name: '3000m (7.5바퀴)' },
        { dist: 5000, name: '5000m (12.5바퀴)' }
      ];
      
      laps.forEach(lap => {
        if (lap.dist <= distance) {
          const lapTime = (totalSeconds / distance) * lap.dist;
          lapSplits.innerHTML += `
            <div class="flex justify-between">
              <span>${lap.name}</span>
              <span class="font-mono font-bold">${formatTime(lapTime)}</span>
            </div>
          `;
        }
      });
      
      document.getElementById('targetResults').classList.remove('hidden');
    }

    // 스플릿 계산
    function calculateSplits() {
      const totalDistance = parseFloat(document.getElementById('splitTotalDistance').value);
      const interval = parseFloat(document.getElementById('splitInterval').value);
      const strategy = document.getElementById('paceStrategy').value;
      
      const hours = parseInt(document.getElementById('splitHours').value) || 0;
      const minutes = parseInt(document.getElementById('splitMinutes').value) || 0;
      const seconds = parseFloat(document.getElementById('splitSeconds').value) || 0;
      
      if (!totalDistance || !interval || (hours === 0 && minutes === 0 && seconds === 0)) return;
      
      const totalSeconds = hours * 3600 + minutes * 60 + seconds;
      const numSplits = Math.ceil(totalDistance / interval);
      
      const splitTable = document.getElementById('splitTable');
      splitTable.innerHTML = '';
      
      const table = document.createElement('table');
      table.className = 'w-full text-sm';
      table.innerHTML = `
        <thead class="bg-gray-100">
          <tr>
            <th class="p-2 text-left">구간</th>
            <th class="p-2">거리</th>
            <th class="p-2">구간 시간</th>
            <th class="p-2">누적 시간</th>
            <th class="p-2">페이스 (min/km)</th>
          </tr>
        </thead>
        <tbody id="splitTableBody"></tbody>
      `;
      
      const tbody = table.querySelector('tbody');
      let cumulativeTime = 0;
      
      for (let i = 0; i < numSplits; i++) {
        const startDist = i * interval;
        const endDist = Math.min((i + 1) * interval, totalDistance);
        const segmentDist = endDist - startDist;
        
        let segmentTime;
        
        switch (strategy) {
          case 'even':
            segmentTime = (totalSeconds / totalDistance) * segmentDist;
            break;
          case 'negative':
            // 후반부로 갈수록 빨라짐 (처음 105% -> 마지막 95%)
            const factor = 1.05 - (0.1 * i / (numSplits - 1));
            segmentTime = (totalSeconds / totalDistance) * segmentDist * factor;
            break;
          case 'positive':
            // 전반부 빠름 (처음 95% -> 마지막 105%)
            const posFactor = 0.95 + (0.1 * i / (numSplits - 1));
            segmentTime = (totalSeconds / totalDistance) * segmentDist * posFactor;
            break;
          default:
            segmentTime = (totalSeconds / totalDistance) * segmentDist;
        }
        
        cumulativeTime += segmentTime;
        const pacePerKm = (segmentTime / segmentDist) * 1000 / 60;
        
        const row = tbody.insertRow();
        row.innerHTML = `
          <td class="p-2 font-medium">${i + 1}구간</td>
          <td class="p-2">${startDist}-${endDist}m</td>
          <td class="p-2 font-mono">${formatTime(segmentTime)}</td>
          <td class="p-2 font-mono font-bold">${formatTime(cumulativeTime)}</td>
          <td class="p-2">${Math.floor(pacePerKm)}:${String(Math.floor((pacePerKm % 1) * 60)).padStart(2, '0')}</td>
        `;
      }
      
      splitTable.appendChild(table);
      document.getElementById('splitResults').classList.remove('hidden');
    }

    // 뒤로가기
    function goBack() {
      window.location.href = 'index.html';
    }

    // 페이지 로드 시 차트 탭 활성화 및 차트 생성
    window.addEventListener('DOMContentLoaded', () => {
      switchTab('chart');
    });
  </script>
</body>
</html>