<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3000m 장애물 페이스 계산기 | Athlete Time</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Malgun Gothic', '맑은 고딕', sans-serif;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .water-jump-bg {
      background: linear-gradient(135deg, #0891b2 0%, #0e7490 100%);
    }
    
    .barrier-bg {
      background: linear-gradient(135deg, #ea580c 0%, #dc2626 100%);
    }
    
    .lap-card {
      transition: all 0.3s ease;
    }
    
    .lap-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }
    
    @media (max-width: 768px) {
      .table-container {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
    }
  </style>
</head>
<body class="bg-gray-50">
  <!-- Header -->
  <header class="bg-gradient-to-r from-purple-600 to-pink-600 text-white p-4 sticky top-0 z-10">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-3">
        <button onclick="goBack()" class="p-2 hover:bg-white/20 rounded-lg transition">
          <i class="fas fa-arrow-left"></i>
        </button>
        <div>
          <h1 class="text-xl md:text-2xl font-bold">3000m 장애물 페이스 계산기</h1>
          <p class="text-sm opacity-90">ATHLETE TIME</p>
        </div>
      </div>
      <a href="training-calculator.html" class="text-sm hover:underline">
        훈련 계산기로 돌아가기
      </a>
    </div>
  </header>

  <div class="max-w-7xl mx-auto p-4 md:p-6">
    <!-- 공식 규칙 안내 -->
    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
      <h3 class="font-bold text-lg mb-2 flex items-center">
        <i class="fas fa-info-circle mr-2"></i>
        World Athletics 공식 규칙
      </h3>
      <div class="grid md:grid-cols-2 gap-4 text-sm">
        <div>
          <p class="font-semibold mb-1">장애물 규격:</p>
          <ul class="space-y-1 ml-4">
            <li>• 남자: 91.4cm (36인치)</li>
            <li>• 여자: 76.2cm (30인치)</li>
            <li>• 총 35개 장애물 통과</li>
          </ul>
        </div>
        <div>
          <p class="font-semibold mb-1">구성:</p>
          <ul class="space-y-1 ml-4">
            <li>• 일반 장애물: 28개</li>
            <li>• 물 장애물: 7개</li>
            <li>• 랩당: 장애물 4개 + 물 장애물 1개</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- 계산기 메인 -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
      <h2 class="text-2xl font-bold mb-6 flex items-center">
        <span class="bg-purple-100 text-purple-600 w-10 h-10 rounded-full flex items-center justify-center mr-3">
          <i class="fas fa-calculator"></i>
        </span>
        페이스 계산
      </h2>
      
      <div class="grid md:grid-cols-3 gap-6">
        <!-- 목표 기록 입력 -->
        <div>
          <label class="block text-sm font-medium mb-2">3000m SC 목표 기록</label>
          <div class="grid grid-cols-3 gap-2">
            <input type="number" id="targetMinutes" placeholder="분" min="7" max="15" 
              class="p-3 border rounded-lg text-center" value="9">
            <input type="number" id="targetSeconds" placeholder="초" min="0" max="59" 
              class="p-3 border rounded-lg text-center" value="30">
            <input type="number" id="targetMillis" placeholder=".00" min="0" max="99" 
              class="p-3 border rounded-lg text-center" value="0">
          </div>
        </div>
        
        <!-- 평지 기록 (참고) -->
        <div>
          <label class="block text-sm font-medium mb-2">평지 3000m 기록 (선택)</label>
          <div class="grid grid-cols-3 gap-2">
            <input type="number" id="flatMinutes" placeholder="분" min="7" max="15" 
              class="p-3 border rounded-lg text-center">
            <input type="number" id="flatSeconds" placeholder="초" min="0" max="59" 
              class="p-3 border rounded-lg text-center">
            <input type="number" id="flatMillis" placeholder=".00" min="0" max="99" 
              class="p-3 border rounded-lg text-center">
          </div>
        </div>
        
        <!-- 경험 수준 -->
        <div>
          <label class="block text-sm font-medium mb-2">경험 수준</label>
          <select id="experienceLevel" class="w-full p-3 border rounded-lg">
            <option value="beginner">초급 (처음 ~ 1년)</option>
            <option value="intermediate" selected>중급 (1~3년)</option>
            <option value="advanced">상급 (3~5년)</option>
            <option value="elite">엘리트 (5년 이상)</option>
          </select>
        </div>
      </div>
      
      <button onclick="calculatePace()" 
        class="mt-6 w-full md:w-auto bg-gradient-to-r from-purple-600 to-pink-600 text-white px-8 py-3 rounded-lg font-semibold hover:shadow-lg transition">
        <i class="fas fa-calculator mr-2"></i>페이스 계산하기
      </button>
    </div>

    <!-- 랩 별 페이스 -->
    <div id="lapPaceResult" class="bg-white rounded-xl shadow-lg p-6 mb-6" style="display: none;">
      <h2 class="text-2xl font-bold mb-6 flex items-center">
        <span class="bg-green-100 text-green-600 w-10 h-10 rounded-full flex items-center justify-center mr-3">
          <i class="fas fa-running"></i>
        </span>
        랩별 페이스 전략
      </h2>
      
      <div id="lapDetails" class="space-y-4">
        <!-- 동적으로 생성됨 -->
      </div>
      
      <!-- 페이스 차트 -->
      <div class="mt-6">
        <canvas id="paceChart" width="400" height="200"></canvas>
      </div>
    </div>

    <!-- 장애물 통과 전략 -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
      <h2 class="text-2xl font-bold mb-6 flex items-center">
        <span class="bg-orange-100 text-orange-600 w-10 h-10 rounded-full flex items-center justify-center mr-3">
          <i class="fas fa-route"></i>
        </span>
        장애물 통과 전략
      </h2>
      
      <div class="grid md:grid-cols-2 gap-6">
        <!-- 일반 장애물 -->
        <div class="border rounded-lg p-4">
          <h3 class="font-bold text-lg mb-3 flex items-center">
            <span class="w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center mr-2 text-sm">28</span>
            일반 장애물
          </h3>
          <ul class="space-y-2 text-sm">
            <li class="flex items-start">
              <i class="fas fa-check text-green-500 mt-1 mr-2"></i>
              <span>리드 레그를 일정하게 유지</span>
            </li>
            <li class="flex items-start">
              <i class="fas fa-check text-green-500 mt-1 mr-2"></i>
              <span>장애물 50cm 전에서 도약</span>
            </li>
            <li class="flex items-start">
              <i class="fas fa-check text-green-500 mt-1 mr-2"></i>
              <span>착지 후 빠른 가속</span>
            </li>
            <li class="flex items-start">
              <i class="fas fa-check text-green-500 mt-1 mr-2"></i>
              <span>리듬 유지가 핵심</span>
            </li>
          </ul>
        </div>
        
        <!-- 물 장애물 -->
        <div class="border rounded-lg p-4 water-jump-bg">
          <h3 class="font-bold text-lg mb-3 flex items-center text-white">
            <span class="w-8 h-8 bg-white text-blue-600 rounded-full flex items-center justify-center mr-2 text-sm font-bold">7</span>
            물 장애물
          </h3>
          <ul class="space-y-2 text-sm text-white">
            <li class="flex items-start">
              <i class="fas fa-check text-yellow-300 mt-1 mr-2"></i>
              <span>장애물 위에 한 발 착지</span>
            </li>
            <li class="flex items-start">
              <i class="fas fa-check text-yellow-300 mt-1 mr-2"></i>
              <span>물 깊이: 70cm → 0cm (경사)</span>
            </li>
            <li class="flex items-start">
              <i class="fas fa-check text-yellow-300 mt-1 mr-2"></i>
              <span>전체 길이: 3.66m</span>
            </li>
            <li class="flex items-start">
              <i class="fas fa-check text-yellow-300 mt-1 mr-2"></i>
              <span>가능한 멀리 뛰어 물 최소 접촉</span>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- 훈련 가이드 -->
    <div class="bg-white rounded-xl shadow-lg p-6">
      <h2 class="text-2xl font-bold mb-6 flex items-center">
        <span class="bg-purple-100 text-purple-600 w-10 h-10 rounded-full flex items-center justify-center mr-3">
          <i class="fas fa-dumbbell"></i>
        </span>
        훈련 가이드
      </h2>
      
      <div class="grid md:grid-cols-3 gap-4">
        <div class="border rounded-lg p-4">
          <h4 class="font-bold mb-2 text-purple-600">기초 체력</h4>
          <ul class="text-sm space-y-1">
            <li>• 주 40-60km 러닝</li>
            <li>• 템포런 주 2회</li>
            <li>• 인터벌 훈련</li>
          </ul>
        </div>
        <div class="border rounded-lg p-4">
          <h4 class="font-bold mb-2 text-blue-600">장애물 기술</h4>
          <ul class="text-sm space-y-1">
            <li>• 허들 드릴</li>
            <li>• 물 장애물 연습</li>
            <li>• 리듬 트레이닝</li>
          </ul>
        </div>
        <div class="border rounded-lg p-4">
          <h4 class="font-bold mb-2 text-green-600">근력 훈련</h4>
          <ul class="text-sm space-y-1">
            <li>• 플라이오메트릭</li>
            <li>• 코어 강화</li>
            <li>• 하체 파워</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 페이스 계산 함수
    function calculatePace() {
      const targetMinutes = parseInt(document.getElementById('targetMinutes').value) || 9;
      const targetSeconds = parseInt(document.getElementById('targetSeconds').value) || 30;
      const targetMillis = parseInt(document.getElementById('targetMillis').value) || 0;
      const experienceLevel = document.getElementById('experienceLevel').value;
      
      const totalSeconds = targetMinutes * 60 + targetSeconds + targetMillis / 100;
      
      // 장애물로 인한 시간 손실 계산
      const lossFactors = {
        beginner: { barrier: 0.3, water: 1.5 },    // 일반 0.3초, 물 1.5초
        intermediate: { barrier: 0.2, water: 1.0 }, // 일반 0.2초, 물 1.0초
        advanced: { barrier: 0.15, water: 0.7 },    // 일반 0.15초, 물 0.7초
        elite: { barrier: 0.1, water: 0.5 }         // 일반 0.1초, 물 0.5초
      };
      
      const loss = lossFactors[experienceLevel];
      const totalLoss = (28 * loss.barrier) + (7 * loss.water);
      const runningTime = totalSeconds - totalLoss;
      const avgPacePerKm = runningTime / 3;
      
      // 랩별 페이스 생성 (7.5바퀴)
      const laps = generateLapPaces(totalSeconds, experienceLevel);
      displayLapPaces(laps, avgPacePerKm);
      
      // 결과 표시
      document.getElementById('lapPaceResult').style.display = 'block';
    }
    
    // 랩별 페이스 생성
    function generateLapPaces(totalSeconds, level) {
      const laps = [];
      const lapDistance = 400; // 미터
      
      // 페이스 전략: 첫 랩 빠름, 중반 안정, 마지막 스퍼트
      const paceStrategy = {
        beginner: [0.98, 1.02, 1.02, 1.01, 1.01, 1.00, 0.99, 0.97], // 보수적
        intermediate: [0.97, 1.01, 1.01, 1.00, 1.00, 0.99, 0.99, 0.97], // 균형
        advanced: [0.96, 1.00, 1.01, 1.00, 1.00, 1.00, 0.99, 0.96], // 적극적
        elite: [0.95, 0.99, 1.00, 1.00, 1.00, 1.00, 0.98, 0.94] // 공격적
      };
      
      const avgLapTime = totalSeconds / 7.5;
      const strategy = paceStrategy[level];
      
      for (let i = 0; i < 7; i++) {
        const lapTime = avgLapTime * strategy[i];
        const hasWaterJump = true; // 모든 완전한 랩에 물 장애물
        const barriers = 4; // 일반 장애물
        
        laps.push({
          lap: i + 1,
          time: lapTime,
          distance: lapDistance,
          barriers: barriers,
          waterJump: hasWaterJump,
          cumTime: laps.reduce((sum, l) => sum + l.time, 0) + lapTime
        });
      }
      
      // 마지막 반 랩 (200m)
      laps.push({
        lap: 7.5,
        time: avgLapTime * 0.5 * strategy[7],
        distance: 200,
        barriers: 2,
        waterJump: false,
        cumTime: laps.reduce((sum, l) => sum + l.time, 0) + (avgLapTime * 0.5 * strategy[7])
      });
      
      return laps;
    }
    
    // 랩 페이스 표시
    function displayLapPaces(laps, avgPace) {
      const container = document.getElementById('lapDetails');
      container.innerHTML = '';
      
      // 요약 정보
      const summary = document.createElement('div');
      summary.className = 'bg-gray-50 p-4 rounded-lg mb-4';
      summary.innerHTML = `
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
          <div>
            <p class="text-sm text-gray-600">평균 km 페이스</p>
            <p class="text-xl font-bold">${formatTime(avgPace)}/km</p>
          </div>
          <div>
            <p class="text-sm text-gray-600">평균 랩 타임</p>
            <p class="text-xl font-bold">${formatTime(laps[0].time)}</p>
          </div>
          <div>
            <p class="text-sm text-gray-600">첫 1000m</p>
            <p class="text-xl font-bold">${formatTime(laps[0].time * 2.5)}</p>
          </div>
          <div>
            <p class="text-sm text-gray-600">마지막 1000m</p>
            <p class="text-xl font-bold">${formatTime((laps[5].time + laps[6].time) * 1.25)}</p>
          </div>
        </div>
      `;
      container.appendChild(summary);
      
      // 랩별 상세
      const table = document.createElement('div');
      table.className = 'table-container';
      table.innerHTML = `
        <table class="w-full">
          <thead>
            <tr class="bg-gray-100">
              <th class="p-2 text-left">랩</th>
              <th class="p-2 text-center">거리</th>
              <th class="p-2 text-center">시간</th>
              <th class="p-2 text-center">누적</th>
              <th class="p-2 text-center">장애물</th>
            </tr>
          </thead>
          <tbody>
            ${laps.map(lap => `
              <tr class="border-b ${lap.waterJump ? 'bg-blue-50' : ''}">
                <td class="p-2 font-bold">${lap.lap}랩</td>
                <td class="p-2 text-center">${lap.distance}m</td>
                <td class="p-2 text-center font-semibold">${formatTime(lap.time)}</td>
                <td class="p-2 text-center">${formatTime(lap.cumTime)}</td>
                <td class="p-2 text-center">
                  ${lap.barriers} <i class="fas fa-stop text-orange-500"></i>
                  ${lap.waterJump ? '+ <i class="fas fa-tint text-blue-500"></i>' : ''}
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
      container.appendChild(table);
      
      // 차트 그리기
      drawPaceChart(laps);
    }
    
    // 차트 그리기
    function drawPaceChart(laps) {
      const ctx = document.getElementById('paceChart').getContext('2d');
      
      // 기존 차트 제거
      if (window.paceChartInstance) {
        window.paceChartInstance.destroy();
      }
      
      window.paceChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: laps.map(l => `${l.lap}랩`),
          datasets: [{
            label: '랩 타임',
            data: laps.map(l => l.time),
            borderColor: 'rgb(139, 92, 246)',
            backgroundColor: 'rgba(139, 92, 246, 0.1)',
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: false,
              ticks: {
                callback: function(value) {
                  return formatTime(value);
                }
              }
            }
          },
          plugins: {
            tooltip: {
              callbacks: {
                label: function(context) {
                  return formatTime(context.parsed.y);
                }
              }
            }
          }
        }
      });
    }
    
    // 시간 포맷
    function formatTime(seconds) {
      if (isNaN(seconds)) return '0:00';
      const mins = Math.floor(seconds / 60);
      const secs = (seconds % 60).toFixed(1);
      return `${mins}:${secs.padStart(4, '0')}`;
    }
    
    // 뒤로가기
    function goBack() {
      window.location.href = 'training-calculator.html';
    }
    
    // 페이지 로드 시 초기화
    document.addEventListener('DOMContentLoaded', function() {
      // 엔터키 지원
      document.querySelectorAll('input').forEach(input => {
        input.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            calculatePace();
          }
        });
      });
    });
  </script>
</body>
</html>