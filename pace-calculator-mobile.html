<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>페이스 계산기 (모바일) | 애슬리트 타임</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  
  <style>
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Malgun Gothic', '맑은 고딕', sans-serif;
      -webkit-tap-highlight-color: transparent;
      -webkit-font-smoothing: antialiased;
    }
    
    .gradient-text {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    /* 탭 활성화 스타일 */
    .tab-active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    /* Track lane visualization styles */
    .lane-1 { stroke: #ef4444; fill: none; }
    .lane-2 { stroke: #f97316; fill: none; }
    .lane-3 { stroke: #eab308; fill: none; }
    .lane-4 { stroke: #84cc16; fill: none; }
    .lane-5 { stroke: #22c55e; fill: none; }
    .lane-6 { stroke: #06b6d4; fill: none; }
    .lane-7 { stroke: #3b82f6; fill: none; }
    .lane-8 { stroke: #8b5cf6; fill: none; }
    
    .lane-selected {
      stroke-width: 3;
      opacity: 1;
    }
    
    .lane-unselected {
      stroke-width: 1.5;
      opacity: 0.4;
    }
    
    .track-time-text {
      font-size: 11px;
      font-weight: bold;
    }
    
    /* 탭 메뉴 스크롤 */
    .tab-menu-container {
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    
    .tab-menu-container::-webkit-scrollbar {
      display: none;
    }
    
    /* 모바일 테이블 스타일 */
    .mobile-table-container {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      position: relative;
      max-width: 100%;
      margin-bottom: 10px;
    }
    
    .mobile-table {
      font-size: 11px;
      width: 100%;
      border-collapse: collapse;
      min-width: 600px;
    }
    
    .mobile-table td, 
    .mobile-table th {
      padding: 4px;
      text-align: center;
      border: 1px solid #e5e7eb;
      white-space: nowrap;
    }
    
    .mobile-table th {
      background: #f3f4f6;
      font-weight: bold;
      font-size: 10px;
    }
    
    /* 첫 번째 열 고정 */
    .mobile-table thead th:first-child,
    .mobile-table tbody td:first-child {
      position: sticky;
      left: 0;
      background: #f9fafb;
      font-weight: bold;
      z-index: 10;
      box-shadow: 2px 0 4px rgba(0,0,0,0.05);
    }
    
    .mobile-table thead th:first-child {
      background: #e5e7eb;
      z-index: 11;
    }
    
    /* 하이라이트 */
    .highlight-row {
      background: #fef3c7 !important;
    }
    
    .sub-highlight {
      background: #dbeafe !important;
    }
    
    /* 로딩 스타일 */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    }
    
    .loading-overlay.active {
      display: flex;
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #e5e7eb;
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* 색상 구분 */
    .bg-yellow-50 { background: #fef3c7 !important; }
    .bg-green-50 { background: #dcfce7 !important; }
    .bg-blue-50 { background: #dbeafe !important; }
    .bg-purple-50 { background: #f3e8ff !important; }
    
    /* 입력 필드 스타일 */
    .input-field {
      width: 100%;
      padding: 8px 12px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s ease;
    }
    
    .input-field:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    /* 결과 카드 스타일 */
    .result-card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 12px;
    }
    
    .result-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      margin-right: 8px;
    }
  </style>
</head>
<body class="bg-gray-50">
  <!-- 로딩 오버레이 -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="bg-white p-6 rounded-lg text-center max-w-xs">
      <div class="loading-spinner mx-auto mb-4"></div>
      <p class="text-lg font-bold text-gray-800 mb-1">고품질 차트 생성 중</p>
      <p class="text-sm text-gray-600">잠시만 기다려주세요...</p>
    </div>
  </div>

  <!-- 빠른 메뉴 모달 -->
  <div id="quickMenuModal" class="fixed inset-0 z-[1000] hidden">
    <div class="absolute inset-0 bg-black/50" onclick="hideQuickMenu()"></div>
    <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl shadow-xl transform transition-transform translate-y-full" id="quickMenuPanel">
      <div class="p-4">
        <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-4"></div>
        <h3 class="font-bold text-lg mb-3">빠른 메뉴</h3>
        <div class="grid grid-cols-2 gap-3">
          <a href="index.html" class="flex flex-col items-center gap-2 p-3 bg-gray-50 rounded-lg">
            <i class="fas fa-home text-2xl text-blue-500"></i>
            <span class="text-xs">홈</span>
          </a>
          <a href="community.html" class="flex flex-col items-center gap-2 p-3 bg-gray-50 rounded-lg">
            <i class="fas fa-comments text-2xl text-purple-500"></i>
            <span class="text-xs">익명게시판</span>
          </a>
          <a href="chat-mobile.html" class="flex flex-col items-center gap-2 p-3 bg-gray-50 rounded-lg">
            <i class="fas fa-comment text-2xl text-pink-500"></i>
            <span class="text-xs">실시간 채팅</span>
          </a>
          <a href="training-calculator-selector.html" class="flex flex-col items-center gap-2 p-3 bg-gray-50 rounded-lg">
            <i class="fas fa-running text-2xl text-orange-500"></i>
            <span class="text-xs">훈련 계산기</span>
          </a>
        </div>
        <div class="mt-3 p-3 bg-green-50 rounded-lg border border-green-200">
          <div class="flex items-center justify-center gap-2">
            <i class="fas fa-calculator text-green-600"></i>
            <span class="text-sm font-bold text-green-700">페이스 계산기 (현재)</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container mx-auto px-3 py-3" style="max-width: 100%;">
    <!-- 헤더 -->
    <div class="bg-white rounded-lg shadow-sm p-3 mb-3">
      <div class="flex items-center justify-between">
        <h1 class="text-lg font-bold gradient-text">페이스 계산기</h1>
        <div class="flex items-center gap-2">
          <a href="pace-calculator.html" class="text-gray-500 hover:text-gray-700 text-sm" title="PC 버전">
            <i class="fas fa-desktop"></i>
          </a>
          <a href="pace-calculator-selector.html?force=true" class="text-gray-500 hover:text-gray-700 text-sm" title="버전 선택">
            <i class="fas fa-exchange-alt"></i>
          </a>
          <button onclick="showQuickMenu()" class="text-gray-500 hover:text-gray-700 text-sm" title="빠른 메뉴">
            <i class="fas fa-th"></i>
          </button>
          <a href="index.html" class="text-gray-500 hover:text-gray-700 text-sm" title="메인">
            <i class="fas fa-home"></i>
          </a>
        </div>
      </div>
    </div>

    <!-- 탭 메뉴 (훈련페이스 제외) -->
    <div class="bg-white rounded-lg shadow-sm mb-3 p-2">
      <div class="flex gap-1 overflow-x-auto tab-menu-container">
        <button onclick="switchTab('chart')" id="tab-chart" class="tab-btn px-3 py-2 rounded-lg font-semibold text-xs whitespace-nowrap tab-active flex items-center gap-1">
          <i class="fas fa-table text-xs"></i>
          <span>페이스차트</span>
        </button>
        <button onclick="switchTab('lane')" id="tab-lane" class="tab-btn px-3 py-2 rounded-lg font-semibold text-xs whitespace-nowrap bg-gray-100 flex items-center gap-1">
          <i class="fas fa-road text-xs"></i>
          <span>레인계산</span>
        </button>
        <button onclick="switchTab('target')" id="tab-target" class="tab-btn px-3 py-2 rounded-lg font-semibold text-xs whitespace-nowrap bg-gray-100 flex items-center gap-1">
          <i class="fas fa-bullseye text-xs"></i>
          <span>목표페이스</span>
        </button>
        <button onclick="switchTab('split')" id="tab-split" class="tab-btn px-3 py-2 rounded-lg font-semibold text-xs whitespace-nowrap bg-gray-100 flex items-center gap-1">
          <i class="fas fa-chart-line text-xs"></i>
          <span>스플릿</span>
        </button>
      </div>
    </div>

    <!-- 페이스 차트 탭 (기본) -->
    <div id="chart-content" class="tab-content">
      <!-- 차트 1: 킬로미터 페이스 → 거리별 완주 시간 -->
      <div id="chart1" class="bg-white rounded-lg shadow-sm p-3 mb-3">
        <div class="flex justify-between items-center mb-2">
          <h2 class="text-sm font-bold">
            <i class="fas fa-tachometer-alt text-blue-500 text-xs"></i> 
            <span class="text-xs">킬로미터 페이스 → 거리별 완주 시간</span>
          </h2>
          <div class="flex gap-1">
            <button onclick="downloadChart('chart1', 'KM페이스_거리별완주시간', 'png')" 
                    class="text-blue-500 text-xs p-1">
              <i class="fas fa-image"></i>
            </button>
            <button onclick="downloadChart('chart1', 'KM페이스_거리별완주시간', 'pdf')" 
                    class="text-red-500 text-xs p-1">
              <i class="fas fa-file-pdf"></i>
            </button>
          </div>
        </div>
        
        <div class="mobile-table-container">
          <table id="paceTable1" class="mobile-table">
            <!-- JavaScript로 채워짐 -->
          </table>
        </div>
      </div>

      <!-- 차트 2: 목표 기록별 필요 페이스 분석 -->
      <div id="chart2" class="bg-white rounded-lg shadow-sm p-3 mb-3">
        <div class="flex justify-between items-center mb-2">
          <h2 class="text-sm font-bold">
            <i class="fas fa-trophy text-orange-500 text-xs"></i> 
            <span class="text-xs">목표 기록별 필요 페이스 분석</span>
          </h2>
          <div class="flex gap-1">
            <button onclick="downloadChart('chart2', '목표기록별_페이스분석', 'png')" 
                    class="text-blue-500 text-xs p-1">
              <i class="fas fa-image"></i>
            </button>
            <button onclick="downloadChart('chart2', '목표기록별_페이스분석', 'pdf')" 
                    class="text-red-500 text-xs p-1">
              <i class="fas fa-file-pdf"></i>
            </button>
          </div>
        </div>
        
        <!-- 5km 목표 -->
        <h3 class="text-xs font-bold mb-1 text-gray-700">🏃 5km 목표 기록</h3>
        <div class="mobile-table-container mb-2">
          <table id="target5kmTable" class="mobile-table">
            <!-- JavaScript로 채워짐 -->
          </table>
        </div>
        
        <!-- 10km 목표 -->
        <h3 class="text-xs font-bold mb-1 text-gray-700">🏃 10km 목표 기록</h3>
        <div class="mobile-table-container mb-2">
          <table id="target10kmTable" class="mobile-table">
            <!-- JavaScript로 채워짐 -->
          </table>
        </div>
        
        <!-- 하프마라톤 목표 -->
        <h3 class="text-xs font-bold mb-1 text-gray-700">🏃 하프마라톤 목표 기록</h3>
        <div class="mobile-table-container mb-2">
          <table id="targetHalfTable" class="mobile-table">
            <!-- JavaScript로 채워짐 -->
          </table>
        </div>
        
        <!-- 풀마라톤 목표 -->
        <h3 class="text-xs font-bold mb-1 text-gray-700">🏃 풀마라톤 목표 기록</h3>
        <div class="mobile-table-container">
          <table id="targetFullTable" class="mobile-table">
            <!-- JavaScript로 채워짐 -->
          </table>
        </div>
      </div>

      <!-- 차트 3: 400m 트랙 레인별 거리 & 시간 보정표 -->
      <div id="chart3" class="bg-white rounded-lg shadow-sm p-3 mb-3">
        <div class="flex justify-between items-center mb-2">
          <h2 class="text-sm font-bold">
            <i class="fas fa-route text-green-500 text-xs"></i> 
            <span class="text-xs">400m 트랙 레인별 거리 & 시간 보정표</span>
          </h2>
          <div class="flex gap-1">
            <button onclick="downloadChart('chart3', '트랙레인별_보정표', 'png')" 
                    class="text-blue-500 text-xs p-1">
              <i class="fas fa-image"></i>
            </button>
            <button onclick="downloadChart('chart3', '트랙레인별_보정표', 'pdf')" 
                    class="text-red-500 text-xs p-1">
              <i class="fas fa-file-pdf"></i>
            </button>
          </div>
        </div>
        
        <div class="mobile-table-container">
          <table id="laneTable" class="mobile-table">
            <!-- JavaScript로 채워짐 -->
          </table>
        </div>
      </div>

      <!-- 차트 4: 3000m 장애물 경주 페이스 계산표 -->
      <div id="chart4" class="bg-white rounded-lg shadow-sm p-3 mb-3">
        <div class="flex justify-between items-center mb-2">
          <h2 class="text-sm font-bold">
            <i class="fas fa-water text-cyan-500 text-xs"></i> 
            <span class="text-xs">3000m 장애물 경주 페이스 계산표</span>
          </h2>
          <div class="flex gap-1">
            <button onclick="downloadChart('chart4', '3000m장애물_페이스', 'png')" 
                    class="text-blue-500 text-xs p-1">
              <i class="fas fa-image"></i>
            </button>
            <button onclick="downloadChart('chart4', '3000m장애물_페이스', 'pdf')" 
                    class="text-red-500 text-xs p-1">
              <i class="fas fa-file-pdf"></i>
            </button>
          </div>
        </div>
        
        <!-- 물장 내측 -->
        <h3 class="text-xs font-bold mb-1 text-blue-700">💧 물 장애물 내측 (INSIDE)</h3>
        <div class="mobile-table-container mb-2">
          <table id="steeplechaseInsideTable" class="mobile-table">
            <!-- JavaScript로 채워짐 -->
          </table>
        </div>
        
        <!-- 물장 외측 -->
        <h3 class="text-xs font-bold mb-1 text-purple-700">💧 물 장애물 외측 (OUTSIDE)</h3>
        <div class="mobile-table-container">
          <table id="steeplechaseOutsideTable" class="mobile-table">
            <!-- JavaScript로 채워짐 -->
          </table>
        </div>
      </div>
    </div>

    <!-- 레인 계산기 탭 -->
    <div id="lane-content" class="tab-content hidden">
      <!-- 목표 시간 입력 섹션 -->
      <div class="bg-white rounded-lg shadow-sm p-4 mb-3">
        <h2 class="text-lg font-bold mb-3 flex items-center gap-2">
          <i class="fas fa-road text-orange-500"></i>
          <span>트랙 구간별 시간 계산</span>
        </h2>
        
        <div class="grid grid-cols-2 gap-3 mb-3">
          <div>
            <label class="block text-xs font-semibold text-gray-700 mb-1">해당 레인 목표 시간 (초)</label>
            <input type="number" id="laneTargetTime" value="72" min="30" max="120" step="0.1"
                   class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-purple-500">
          </div>
          
          <div>
            <label class="block text-xs font-semibold text-gray-700 mb-1">선택 레인</label>
            <select id="laneLaneSelector" onchange="calculateLaneAll()" 
                    class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-purple-500">
              <option value="1">레인 1</option>
              <option value="2">레인 2</option>
              <option value="3">레인 3</option>
              <option value="4">레인 4</option>
              <option value="5">레인 5</option>
              <option value="6">레인 6</option>
              <option value="7">레인 7</option>
              <option value="8">레인 8</option>
            </select>
          </div>
        </div>
        
        <button onclick="calculateLaneAll()" 
                class="w-full bg-purple-600 text-white py-2 rounded text-sm font-semibold">
          계산하기
        </button>
      </div>

      <!-- 트랙 시각화 -->
      <div class="bg-white rounded-lg shadow-sm p-4 mb-3">
        <h3 class="font-bold text-base mb-2">트랙 구간별 시간</h3>
        
        <!-- SVG 트랙 (실제 비율) -->
        <div class="w-full overflow-x-auto">
          <svg viewBox="0 0 800 400" class="w-full" style="min-height: 250px;">
            <!-- 배경 -->
            <rect width="800" height="400" fill="#f0f0f0"/>
            
            <!-- 트랙 레인들 (먼저 그려서 잔디 아래에 위치) -->
            <g id="laneTrackLanes">
              <!-- 동적으로 생성됨 -->
            </g>
            
            <!-- 중앙 잔디 (실제 비율) -->
            <ellipse cx="400" cy="250" rx="169" ry="73" fill="#90EE90"/>
            
            <!-- Start/Finish 라인 -->
            <line x1="400" y1="50" x2="400" y2="450" stroke="white" stroke-width="4"/>
            <rect x="380" y="240" width="40" height="20" fill="black"/>
            <text x="400" y="255" font-size="12" fill="white" text-anchor="middle" font-weight="bold">S/F</text>
            
            <!-- 구간 라벨 -->
            <g id="sectionLabels">
              <!-- 홈스트레치 -->
              <rect x="450" y="380" width="80" height="25" rx="5" fill="#3b82f6" opacity="0.8"/>
              <text x="490" y="397" font-size="12" fill="white" text-anchor="middle" font-weight="bold">직선② 홈</text>
              
              <!-- 백스트레치 -->
              <rect x="270" y="95" width="80" height="25" rx="5" fill="#3b82f6" opacity="0.8"/>
              <text x="310" y="112" font-size="12" fill="white" text-anchor="middle" font-weight="bold">직선① 백</text>
              
              <!-- 첫 번째 곡선 -->
              <rect x="620" y="230" width="60" height="25" rx="5" fill="#ef4444" opacity="0.8"/>
              <text x="650" y="247" font-size="12" fill="white" text-anchor="middle" font-weight="bold">곡선①</text>
              
              <!-- 두 번째 곡선 -->
              <rect x="120" y="230" width="60" height="25" rx="5" fill="#ef4444" opacity="0.8"/>
              <text x="150" y="247" font-size="12" fill="white" text-anchor="middle" font-weight="bold">곡선②</text>
            </g>
          </svg>
        </div>
      </div>

      <!-- 레인별 시간 테이블 -->
      <div class="bg-white rounded-lg shadow-sm p-4">
        <h3 class="font-bold text-base mb-2">레인별 구간 시간 분석</h3>
        <div class="overflow-x-auto">
          <table class="mobile-table">
            <thead>
              <tr>
                <th>레인</th>
                <th>총거리</th>
                <th>시간</th>
                <th>직선①</th>
                <th>곡선①</th>
                <th>직선②</th>
                <th>곡선②</th>
              </tr>
            </thead>
            <tbody id="laneTimeTable">
              <!-- 동적으로 생성됨 -->
            </tbody>
          </table>
        </div>
        
        <!-- 추가 정보 영역 -->
        <div id="laneInfoContainer">
          <!-- 동적으로 생성됨 -->
        </div>
        
        <div class="mt-3 p-3 bg-blue-50 rounded text-xs">
          <p class="font-semibold mb-1">💡 사용법</p>
          <p>• 목표 시간은 <strong>선택한 레인</strong>에서의 시간입니다</p>
          <p>• 예: 4레인 90초 = 422.37m를 90초에 완주</p>
          <p>• 직선: 84.39m×2, 곡선: 레인별 상이</p>
        </div>
      </div>
    </div>

    <!-- 목표 페이스 탭 -->
    <div id="target-content" class="tab-content hidden">
      <div class="bg-white rounded-lg shadow-sm p-4">
        <h2 class="text-lg font-bold mb-3 flex items-center gap-2">
          <i class="fas fa-bullseye text-green-500"></i>
          <span>목표 페이스 계산기</span>
        </h2>
        
        <div class="mb-4">
          <label class="block text-xs font-semibold text-gray-700 mb-1">목표 거리</label>
          <select id="targetDistance" onchange="calculateTargetPace()" class="input-field text-sm">
            <option value="5000">5km</option>
            <option value="10000">10km</option>
            <option value="21097.5">하프마라톤</option>
            <option value="42195">풀마라톤</option>
            <option value="custom">직접 입력</option>
          </select>
          
          <input type="number" id="customDistance" placeholder="거리(m)" class="input-field text-sm mt-2 hidden">
        </div>
        
        <div class="grid grid-cols-3 gap-2 mb-4">
          <div>
            <label class="text-xs font-semibold text-gray-700">시간</label>
            <input type="number" id="targetHours" min="0" max="6" placeholder="시" 
                   onchange="calculateTargetPace()" class="input-field text-sm text-center">
          </div>
          <div>
            <label class="text-xs font-semibold text-gray-700">분</label>
            <input type="number" id="targetMinutes" min="0" max="59" placeholder="분" 
                   onchange="calculateTargetPace()" class="input-field text-sm text-center">
          </div>
          <div>
            <label class="text-xs font-semibold text-gray-700">초</label>
            <input type="number" id="targetSeconds" min="0" max="59" placeholder="초" 
                   onchange="calculateTargetPace()" class="input-field text-sm text-center">
          </div>
        </div>
        
        <div id="targetPaceResults">
          <!-- 결과가 여기 표시됨 -->
        </div>
      </div>
    </div>

    <!-- 스플릿 계산 탭 -->
    <div id="split-content" class="tab-content hidden">
      <div class="bg-white rounded-lg shadow-sm p-4">
        <h2 class="text-lg font-bold mb-3 flex items-center gap-2">
          <i class="fas fa-chart-line text-blue-500"></i>
          <span>스플릿 계산기</span>
        </h2>
        
        <div class="mb-4">
          <label class="block text-xs font-semibold text-gray-700 mb-1">레이스 거리</label>
          <select id="splitDistance" onchange="calculateSplits()" class="input-field text-sm">
            <option value="5000">5km</option>
            <option value="10000">10km</option>
            <option value="21097.5">하프마라톤</option>
            <option value="42195">풀마라톤</option>
          </select>
        </div>
        
        <div class="mb-4">
          <label class="block text-xs font-semibold text-gray-700 mb-1">목표 페이스 (km당)</label>
          <div class="grid grid-cols-2 gap-2">
            <input type="number" id="splitPaceMin" min="2" max="10" placeholder="분" 
                   onchange="calculateSplits()" class="input-field text-sm text-center">
            <input type="number" id="splitPaceSec" min="0" max="59" placeholder="초" 
                   onchange="calculateSplits()" class="input-field text-sm text-center">
          </div>
        </div>
        
        <div class="mb-4">
          <label class="block text-xs font-semibold text-gray-700 mb-1">페이스 전략</label>
          <select id="paceStrategy" onchange="calculateSplits()" class="input-field text-sm">
            <option value="even">균등 페이스</option>
            <option value="negative">네거티브 스플릿</option>
            <option value="positive">포지티브 스플릿</option>
          </select>
        </div>
        
        <div id="splitResults">
          <!-- 결과가 여기 표시됨 -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // 탭 전환 함수
    function switchTab(tabName) {
      // 모든 탭 내용 숨기기
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.add('hidden');
      });
      
      // 모든 탭 버튼 비활성화
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('tab-active');
        btn.classList.add('bg-gray-100');
      });
      
      // 선택한 탭 활성화
      document.getElementById(`${tabName}-content`).classList.remove('hidden');
      document.getElementById(`tab-${tabName}`).classList.add('tab-active');
      document.getElementById(`tab-${tabName}`).classList.remove('bg-gray-100');
      
      // 각 탭별 초기화
      if (tabName === 'chart') {
        generateChart1();
        generateChart2();
        generateChart3();
        generateChart4();
      } else if (tabName === 'lane') {
        calculateLaneAll();
      }
    }

    // 시간 포맷팅 함수
    function formatTime(seconds, forceHours = false) {
      if (isNaN(seconds) || seconds === null) return '-';
      
      const hours = Math.floor(seconds / 3600);
      const mins = Math.floor((seconds % 3600) / 60);
      const secs = seconds % 60;
      
      if (hours > 0 || forceHours) {
        return `${hours}:${String(mins).padStart(2, '0')}:${String(Math.floor(secs)).padStart(2, '0')}`;
      } else if (mins > 0) {
        return `${mins}:${String(Math.floor(secs)).padStart(2, '0')}`;
      } else {
        return secs.toFixed(1);
      }
    }
    
    // 페이스 포맷팅
    function formatPace(secondsPerKm) {
      const mins = Math.floor(secondsPerKm / 60);
      const secs = Math.floor(secondsPerKm % 60);
      return `${mins}:${String(secs).padStart(2, '0')}`;
    }
    
    // 차트 1: KM 페이스별 거리 환산표
    function generateChart1() {
      const table = document.getElementById('paceTable1');
      
      let html = '<thead><tr>';
      html += '<th>km 페이스</th>';
      const distances = ['100m', '200m', '400m', '800m', '1km', '3km', '5km', '10km', '15km', '하프', '30km', '풀코스'];
      distances.forEach(d => {
        html += `<th>${d}</th>`;
      });
      html += '</tr></thead><tbody>';
      
      for (let seconds = 150; seconds <= 480; seconds += 10) {
        const pace = formatPace(seconds);
        
        let rowClass = '';
        if (seconds === 180 || seconds === 240 || seconds === 300 || seconds === 360 || seconds === 420) {
          rowClass = 'highlight-row';
        } else if (seconds === 210 || seconds === 270 || seconds === 330 || seconds === 390 || seconds === 450) {
          rowClass = 'sub-highlight';
        }
        
        html += `<tr class="${rowClass}">`;
        html += `<td>${pace}</td>`;
        
        const distanceMeters = [100, 200, 400, 800, 1000, 3000, 5000, 10000, 15000, 21097.5, 30000, 42195];
        distanceMeters.forEach((distance, i) => {
          const time = (seconds / 1000) * distance;  // seconds는 이미 km당 초 단위이므로 1000으로 나누어 미터당 시간 계산
          let cellClass = '';
          if (i === 6) cellClass = 'bg-yellow-50';
          if (i === 7) cellClass = 'bg-green-50';
          if (i === 9) cellClass = 'bg-blue-50';
          if (i === 11) cellClass = 'bg-purple-50';
          html += `<td class="${cellClass}">${formatTime(time)}</td>`;
        });
        
        html += '</tr>';
      }
      
      html += '</tbody>';
      table.innerHTML = html;
    }
    
    // 차트 2: 목표 기록별 테이블들 (전체 구현)
    function generateChart2() {
      // 5km 목표 기록
      const targets5km = [
        { time: 13 * 60, label: '세계 엘리트', highlight: true },
        { time: 14 * 60, label: '국가대표' },
        { time: 15 * 60, label: '엘리트', highlight: true },
        { time: 16 * 60, label: '준엘리트' },
        { time: 17 * 60, label: '최상급' },
        { time: 18 * 60, label: '상급' },
        { time: 19 * 60, label: '중상급' },
        { time: 20 * 60, label: '서브 20', highlight: true },
        { time: 22 * 60, label: '중급' },
        { time: 25 * 60, label: '초중급', highlight: true },
        { time: 28 * 60, label: '초급' },
        { time: 30 * 60, label: '입문', highlight: true },
        { time: 35 * 60, label: '완주 목표' },
        { time: 40 * 60, label: '건강 조깅', highlight: true }
      ];
      
      const table5km = document.getElementById('target5kmTable');
      let html = '<thead><tr>';
      html += '<th>목표 기록</th><th>km 페이스</th><th>400m</th><th>100m</th><th>속도</th><th>비고</th>';
      html += '</tr></thead><tbody>';
      
      targets5km.forEach(target => {
        const pacePerKm = target.time / 5;
        const pace400m = pacePerKm * 0.4;
        const pace100m = pacePerKm * 0.1;
        const speed = 5000 / target.time * 3.6;
        
        html += `<tr class="${target.highlight ? 'highlight-row' : ''}">`;
        html += `<td>${formatTime(target.time)}</td>`;
        html += `<td>${formatPace(pacePerKm)}</td>`;
        html += `<td>${formatTime(pace400m)}</td>`;
        html += `<td>${formatTime(pace100m)}</td>`;
        html += `<td>${speed.toFixed(1)}</td>`;
        html += `<td class="text-xs">${target.label}</td>`;
        html += '</tr>';
      });
      
      html += '</tbody>';
      table5km.innerHTML = html;
      
      // 10km 목표 기록
      const targets10km = [
        { time: 27 * 60, label: '세계 엘리트', highlight: true },
        { time: 29 * 60, label: '국가대표' },
        { time: 31 * 60, label: '엘리트', highlight: true },
        { time: 33 * 60, label: '준엘리트' },
        { time: 35 * 60, label: '상급' },
        { time: 38 * 60, label: '중상급' },
        { time: 40 * 60, label: '서브 40', highlight: true },
        { time: 45 * 60, label: '중급' },
        { time: 50 * 60, label: '서브 50', highlight: true },
        { time: 55 * 60, label: '초급' },
        { time: 60 * 60, label: '서브 1시간', highlight: true },
        { time: 70 * 60, label: '완주 목표' },
        { time: 80 * 60, label: '건강 조깅', highlight: true }
      ];
      
      const table10km = document.getElementById('target10kmTable');
      html = '<thead><tr>';
      html += '<th>목표 기록</th><th>km 페이스</th><th>400m</th><th>5km</th><th>속도</th><th>비고</th>';
      html += '</tr></thead><tbody>';
      
      targets10km.forEach(target => {
        const pacePerKm = target.time / 10;
        const pace400m = pacePerKm * 0.4;
        const time5km = target.time / 2;
        const speed = 10000 / target.time * 3.6;
        
        html += `<tr class="${target.highlight ? 'highlight-row' : ''}">`;
        html += `<td>${formatTime(target.time)}</td>`;
        html += `<td>${formatPace(pacePerKm)}</td>`;
        html += `<td>${formatTime(pace400m)}</td>`;
        html += `<td>${formatTime(time5km)}</td>`;
        html += `<td>${speed.toFixed(1)}</td>`;
        html += `<td class="text-xs">${target.label}</td>`;
        html += '</tr>';
      });
      
      html += '</tbody>';
      table10km.innerHTML = html;
      
      // 하프마라톤 목표 기록
      const targetsHalf = [
        { time: 60 * 60, label: '세계 엘리트', highlight: true },
        { time: 65 * 60, label: '국가대표' },
        { time: 70 * 60, label: '엘리트', highlight: true },
        { time: 75 * 60, label: '준엘리트' },
        { time: 80 * 60, label: '상급' },
        { time: 85 * 60, label: '중상급' },
        { time: 90 * 60, label: '서브 1:30', highlight: true },
        { time: 100 * 60, label: '중급' },
        { time: 110 * 60, label: '초중급', highlight: true },
        { time: 120 * 60, label: '서브 2:00', highlight: true },
        { time: 130 * 60, label: '초급' },
        { time: 140 * 60, label: '입문' },
        { time: 150 * 60, label: '서브 2:30', highlight: true },
        { time: 160 * 60, label: '완주 목표' },
        { time: 180 * 60, label: '건강 조깅', highlight: true }
      ];
      
      const tableHalf = document.getElementById('targetHalfTable');
      html = '<thead><tr>';
      html += '<th>목표 기록</th><th>km 페이스</th><th>400m</th><th>5km</th><th>10km</th><th>속도</th><th>비고</th>';
      html += '</tr></thead><tbody>';
      
      targetsHalf.forEach(target => {
        const pacePerKm = target.time / 21.0975;
        const pace400m = pacePerKm * 0.4;
        const time5km = (target.time / 21.0975) * 5;
        const time10km = (target.time / 21.0975) * 10;
        const speed = 21097.5 / target.time * 3.6;
        
        html += `<tr class="${target.highlight ? 'highlight-row' : ''}">`;
        html += `<td>${formatTime(target.time)}</td>`;
        html += `<td>${formatPace(pacePerKm)}</td>`;
        html += `<td>${formatTime(pace400m)}</td>`;
        html += `<td>${formatTime(time5km)}</td>`;
        html += `<td>${formatTime(time10km)}</td>`;
        html += `<td>${speed.toFixed(1)}</td>`;
        html += `<td class="text-xs">${target.label}</td>`;
        html += '</tr>';
      });
      
      html += '</tbody>';
      tableHalf.innerHTML = html;
      
      // 풀마라톤 목표 기록
      const targetsFull = [
        { time: 2 * 3600 + 0 * 60, label: '세계 신기록', highlight: true },
        { time: 2 * 3600 + 10 * 60, label: '세계 엘리트' },
        { time: 2 * 3600 + 20 * 60, label: '국가대표', highlight: true },
        { time: 2 * 3600 + 30 * 60, label: '서브 2:30' },
        { time: 2 * 3600 + 40 * 60, label: '엘리트' },
        { time: 2 * 3600 + 50 * 60, label: '준엘리트' },
        { time: 3 * 3600 + 0 * 60, label: '서브 3', highlight: true },
        { time: 3 * 3600 + 10 * 60, label: '상급' },
        { time: 3 * 3600 + 20 * 60, label: '중상급' },
        { time: 3 * 3600 + 30 * 60, label: '서브 3:30', highlight: true },
        { time: 3 * 3600 + 40 * 60, label: '중급' },
        { time: 3 * 3600 + 50 * 60, label: '초중급' },
        { time: 4 * 3600 + 0 * 60, label: '서브 4', highlight: true },
        { time: 4 * 3600 + 30 * 60, label: '초급' },
        { time: 5 * 3600 + 0 * 60, label: '완주', highlight: true },
        { time: 5 * 3600 + 30 * 60, label: '건강 조깅' },
        { time: 6 * 3600 + 0 * 60, label: '완보', highlight: true }
      ];
      
      const tableFull = document.getElementById('targetFullTable');
      html = '<thead><tr>';
      html += '<th>목표 기록</th><th>km 페이스</th><th>400m</th><th>10km</th><th>하프</th><th>30km</th><th>속도</th><th>비고</th>';
      html += '</tr></thead><tbody>';
      
      targetsFull.forEach(target => {
        const pacePerKm = target.time / 42.195;
        const pace400m = pacePerKm * 0.4;
        const time10km = (target.time / 42.195) * 10;
        const timeHalf = (target.time / 42.195) * 21.0975;
        const time30km = (target.time / 42.195) * 30;
        const speed = 42195 / target.time * 3.6;
        
        html += `<tr class="${target.highlight ? 'highlight-row' : ''}">`;
        html += `<td>${formatTime(target.time, true)}</td>`;
        html += `<td>${formatPace(pacePerKm)}</td>`;
        html += `<td>${formatTime(pace400m)}</td>`;
        html += `<td>${formatTime(time10km)}</td>`;
        html += `<td>${formatTime(timeHalf)}</td>`;
        html += `<td>${formatTime(time30km)}</td>`;
        html += `<td>${speed.toFixed(1)}</td>`;
        html += `<td class="text-xs">${target.label}</td>`;
        html += '</tr>';
      });
      
      html += '</tbody>';
      tableFull.innerHTML = html;
    }
    
    // 차트 3: 레인별 보정
    function generateChart3() {
      const table = document.getElementById('laneTable');
      
      const laneDistances = {
        1: 400.00,
        2: 407.04,
        3: 414.70,
        4: 422.37,
        5: 430.03,
        6: 437.70,
        7: 445.36,
        8: 453.03
      };
      
      let html = '<thead><tr>';
      html += '<th rowspan="2">km 페이스</th>';
      html += '<th rowspan="2">400m<br>(1레인)</th>';
      html += '<th colspan="7">외측 레인 보정 시간</th>';
      html += '</tr><tr>';
      
      for (let lane = 2; lane <= 8; lane++) {
        html += `<th>${lane}레인<br>${Math.round(laneDistances[lane])}m</th>`;
      }
      html += '</tr></thead><tbody>';
      
      for (let seconds = 150; seconds <= 360; seconds += 10) {
        const pace = formatPace(seconds);
        
        let rowClass = '';
        if (seconds === 180 || seconds === 240 || seconds === 300 || seconds === 360) {
          rowClass = 'highlight-row';
        } else if (seconds === 210 || seconds === 270 || seconds === 330) {
          rowClass = 'sub-highlight';
        }
        
        html += `<tr class="${rowClass}">`;
        html += `<td>${pace}</td>`;
        
        const time400 = (seconds / 1000) * 400;
        html += `<td>${formatTime(time400)}</td>`;
        
        for (let lane = 2; lane <= 8; lane++) {
          const laneTime = (seconds / 1000) * laneDistances[lane];
          html += `<td>${formatTime(laneTime)}</td>`;
        }
        
        html += '</tr>';
      }
      
      html += '</tbody>';
      table.innerHTML = html;
    }
    
    // 차트 4: 3000m 장애물 페이스 (완전 구현)
    function generateChart4() {
      const tableInside = document.getElementById('steeplechaseInsideTable');
      const tableOutside = document.getElementById('steeplechaseOutsideTable');
      
      // 헤더 (내측)
      let htmlInside = '<thead><tr>';
      htmlInside += '<th>목표 기록</th><th>km 페이스</th><th>시작 구간</th><th>랩당 시간</th><th>3랩</th><th>5랩</th><th>최종</th>';
      htmlInside += '</tr></thead><tbody>';
      
      // 헤더 (외측)
      let htmlOutside = '<thead><tr>';
      htmlOutside += '<th>목표 기록</th><th>km 페이스</th><th>시작 구간</th><th>랩당 시간</th><th>3랩</th><th>5랩</th><th>최종</th>';
      htmlOutside += '</tr></thead><tbody>';
      
      // 목표 기록들
      const targetTimes = [
        { time: 7 * 60 + 30, label: '세계 엘리트', highlight: true },
        { time: 8 * 60, label: '국가대표급' },
        { time: 8 * 60 + 30, label: '엘리트', highlight: true },
        { time: 9 * 60, label: '준엘리트' },
        { time: 9 * 60 + 30, label: '상급', highlight: true },
        { time: 10 * 60, label: '서브 10' },
        { time: 10 * 60 + 30, label: '중상급', highlight: true },
        { time: 11 * 60, label: '중급' },
        { time: 11 * 60 + 30, label: '초중급', highlight: true },
        { time: 12 * 60, label: '초급' },
        { time: 12 * 60 + 30, label: '입문' },
        { time: 13 * 60, label: '완주 목표', highlight: true }
      ];
      
      // 구성별 거리
      const insideConfig = {
        lapDistance: 396.084,
        startSection: 227.412,
        totalLapDistance: 2772.588
      };
      
      const outsideConfig = {
        lapDistance: 419.407,
        startSection: 64.151,
        totalLapDistance: 2935.849
      };
      
      targetTimes.forEach(target => {
        const pacePerKm = target.time / 3;
        
        // 내측 계산
        const insideStartTime = (target.time / 3000) * insideConfig.startSection;
        const insideLapTime = (target.time / 3000) * insideConfig.lapDistance;
        const inside3Laps = insideStartTime + (insideLapTime * 3);
        const inside5Laps = insideStartTime + (insideLapTime * 5);
        
        htmlInside += `<tr class="${target.highlight ? 'bg-blue-50' : ''}">`;
        htmlInside += `<td class="text-blue-700">${formatTime(target.time)}</td>`;
        htmlInside += `<td>${formatPace(pacePerKm)}</td>`;
        htmlInside += `<td>${formatTime(insideStartTime)}</td>`;
        htmlInside += `<td>${formatTime(insideLapTime)}</td>`;
        htmlInside += `<td>${formatTime(inside3Laps)}</td>`;
        htmlInside += `<td>${formatTime(inside5Laps)}</td>`;
        htmlInside += `<td class="font-bold">${formatTime(target.time)}</td>`;
        htmlInside += '</tr>';
        
        // 외측 계산
        const outsideStartTime = (target.time / 3000) * outsideConfig.startSection;
        const outsideLapTime = (target.time / 3000) * outsideConfig.lapDistance;
        const outside3Laps = outsideStartTime + (outsideLapTime * 3);
        const outside5Laps = outsideStartTime + (outsideLapTime * 5);
        
        htmlOutside += `<tr class="${target.highlight ? 'bg-purple-50' : ''}">`;
        htmlOutside += `<td class="text-purple-700">${formatTime(target.time)}</td>`;
        htmlOutside += `<td>${formatPace(pacePerKm)}</td>`;
        htmlOutside += `<td>${formatTime(outsideStartTime)}</td>`;
        htmlOutside += `<td>${formatTime(outsideLapTime)}</td>`;
        htmlOutside += `<td>${formatTime(outside3Laps)}</td>`;
        htmlOutside += `<td>${formatTime(outside5Laps)}</td>`;
        htmlOutside += `<td class="font-bold">${formatTime(target.time)}</td>`;
        htmlOutside += '</tr>';
      });
      
      htmlInside += '</tbody>';
      htmlOutside += '</tbody>';
      
      tableInside.innerHTML = htmlInside;
      tableOutside.innerHTML = htmlOutside;
    }
    
    // 레인 계산기 함수
    // 트랙 레인별 계산 함수들
    function calculateLaneAll() {
      console.log('calculateLaneAll 함수 호출됨 (모바일)');
      
      const targetTimeInput = document.getElementById('laneTargetTime');
      const selectedLaneInput = document.getElementById('laneLaneSelector');
      
      if (!targetTimeInput || !selectedLaneInput) {
        console.error('Input elements not found!');
        return;
      }
      
      const targetTime = parseFloat(targetTimeInput.value);
      const selectedLane = parseInt(selectedLaneInput.value);
      
      console.log('입력값:', { targetTime, selectedLane });
      
      // 입력값 검증
      if (isNaN(targetTime) || targetTime <= 0) {
        alert('올바른 목표 시간을 입력해주세요.');
        return;
      }
      
      // World Athletics (IAAF) 공식 표준 트랙 규격
      const STRAIGHT_LENGTH = 84.39; // 직선 구간 길이
      const LANE_WIDTH = 1.22; // 레인 폭
      const KERB_RADIUS = 36.50; // 내측 가장자리(kerb) 반경
      const MEASUREMENT_OFFSET_LANE1 = 0.30; // 레인 1 측정선 오프셋 (커브 있는 경우)
      const MEASUREMENT_OFFSET_OTHER = 0.20; // 레인 2-8 측정선 오프셋
      const BASE_RADIUS = KERB_RADIUS + MEASUREMENT_OFFSET_LANE1; // 레인 1 측정 반경 = 36.80m
      
      // 먼저 선택된 레인의 거리를 계산
      let selectedLaneDistance = 0;
      if (selectedLane === 1) {
        const radius = KERB_RADIUS + MEASUREMENT_OFFSET_LANE1;
        selectedLaneDistance = (STRAIGHT_LENGTH * 2) + (Math.PI * radius * 2);
      } else {
        const radius = KERB_RADIUS + (LANE_WIDTH * (selectedLane - 1)) + MEASUREMENT_OFFSET_OTHER;
        selectedLaneDistance = (STRAIGHT_LENGTH * 2) + (Math.PI * radius * 2);
      }
      
      // 선택한 레인에서의 속도 계산 (이 속도로 모든 레인 계산)
      const speedInSelectedLane = selectedLaneDistance / targetTime; // m/s
      
      // 레인별 계산 (World Athletics 공식 규격)
      const lanes = [];
      for (let lane = 1; lane <= 8; lane++) {
        // 각 레인의 측정 반경 계산
        let measurementRadius;
        if (lane === 1) {
          measurementRadius = KERB_RADIUS + MEASUREMENT_OFFSET_LANE1; // 36.80m
        } else {
          // 레인 2부터는 이전 레인의 바깥쪽 + 20cm에서 측정
          measurementRadius = KERB_RADIUS + (LANE_WIDTH * (lane - 1)) + MEASUREMENT_OFFSET_OTHER;
        }
        
        const curveLength = Math.PI * measurementRadius * 2; // 두 곡선 구간의 총 길이
        const totalDistance = (STRAIGHT_LENGTH * 2) + curveLength;
        const stagger = lane === 1 ? 0 : totalDistance - 400;
        
        // 구간별 거리 계산
        const sectionDistances = {
          straight1: STRAIGHT_LENGTH,
          curve1: curveLength / 2,
          straight2: STRAIGHT_LENGTH,
          curve2: curveLength / 2
        };
        
        // 각 구간을 해당 속도로 통과하는 시간
        const sectionTimes = {
          straight1: sectionDistances.straight1 / speedInSelectedLane,
          curve1: sectionDistances.curve1 / speedInSelectedLane,
          straight2: sectionDistances.straight2 / speedInSelectedLane,
          curve2: sectionDistances.curve2 / speedInSelectedLane
        };
        
        // 다른 레인에서 동일한 속도로 뛰었을 때의 총 시간
        const adjustedTime = totalDistance / speedInSelectedLane;
        
        lanes.push({
          lane,
          radius: measurementRadius,
          distance: totalDistance,
          stagger,
          adjustedTime,
          sectionDistances,
          sectionTimes,
          isSelected: lane === selectedLane,
          speedMPS: speedInSelectedLane,
          speedKMH: speedInSelectedLane * 3.6,
          pacePerKm: 1000 / speedInSelectedLane
        });
      }
      
      console.log('계산된 레인 데이터:', lanes.length, '개 레인');
      
      // 트랙 시각화 업데이트
      try {
        drawTrackLanes(lanes, selectedLane);
        console.log('트랙 시각화 완료');
      } catch (error) {
        console.error('트랙 시각화 에러:', error);
      }
      
      // 테이블 업데이트
      try {
        updateLaneTable(lanes, targetTime);
        console.log('테이블 업데이트 완료');
        console.log('테이블 tbody 상태:', document.getElementById('laneTimeTable')?.rows.length, '개 행');
      } catch (error) {
        console.error('테이블 업데이트 에러:', error);
      }
    }
    
    function drawTrackLanes(lanes, selectedLane) {
      const svg = document.getElementById('laneTrackLanes');
      if (!svg) return;
      
      svg.innerHTML = '';
      
      // 실제 트랙 비율에 맞게 조정 (모바일용 작게)
      const scaleFactor = 2.0; // 모바일에 맞게 작게 조정
      const straightLength = 84.39 * scaleFactor; // 약 169px
      const centerX = 400;
      const centerY = 200; // SVG viewBox에 맞게 조정
      
      // 레인 그리기
      lanes.forEach(lane => {
        const radius = lane.radius * scaleFactor;
        
        // 실제 트랙 형태로 그리기
        // 왼쪽 반원 중심점
        const leftCenterX = centerX - straightLength / 2;
        // 오른쪽 반원 중심점  
        const rightCenterX = centerX + straightLength / 2;
        
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        const d = `
          M ${leftCenterX} ${centerY - radius}
          L ${rightCenterX} ${centerY - radius}
          A ${radius} ${radius} 0 0 1 ${rightCenterX} ${centerY + radius}
          L ${leftCenterX} ${centerY + radius}
          A ${radius} ${radius} 0 0 1 ${leftCenterX} ${centerY - radius}
        `;
        
        path.setAttribute('d', d);
        path.setAttribute('class', `lane-${lane.lane} ${lane.isSelected ? 'lane-selected' : 'lane-unselected'}`);
        path.setAttribute('stroke-width', lane.isSelected ? '3' : '1.5');
        svg.appendChild(path);
        
        // 선택된 레인에 시간 표시
        if (lane.isSelected) {
          const scaleFactor = 2.0;
          const straightLength = 84.39 * scaleFactor;
          const radius = lane.radius * scaleFactor;
          const leftCenterX = centerX - straightLength / 2;
          const rightCenterX = centerX + straightLength / 2;
          
          // 직선① (백스트레치 - 상단)
          const text1 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
          text1.setAttribute('x', centerX);
          text1.setAttribute('y', centerY - radius - 10);
          text1.setAttribute('text-anchor', 'middle');
          text1.setAttribute('class', 'track-time-text');
          text1.setAttribute('fill', '#3b82f6');
          text1.textContent = `${lane.sectionTimes.straight1.toFixed(2)}초`;
          svg.appendChild(text1);
          
          // 곡선① (왼쪽)
          const text2 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
          text2.setAttribute('x', leftCenterX - radius - 10);
          text2.setAttribute('y', centerY);
          text2.setAttribute('text-anchor', 'middle');
          text2.setAttribute('class', 'track-time-text');
          text2.setAttribute('fill', '#ef4444');
          text2.textContent = `${lane.sectionTimes.curve1.toFixed(2)}초`;
          svg.appendChild(text2);
          
          // 직선② (홈스트레치 - 하단)
          const text3 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
          text3.setAttribute('x', centerX);
          text3.setAttribute('y', centerY + radius + 20);
          text3.setAttribute('text-anchor', 'middle');
          text3.setAttribute('class', 'track-time-text');
          text3.setAttribute('fill', '#3b82f6');
          text3.textContent = `${lane.sectionTimes.straight2.toFixed(2)}초`;
          svg.appendChild(text3);
          
          // 곡선② (오른쪽)
          const text4 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
          text4.setAttribute('x', rightCenterX + radius + 10);
          text4.setAttribute('y', centerY);
          text4.setAttribute('text-anchor', 'middle');
          text4.setAttribute('class', 'track-time-text');
          text4.setAttribute('fill', '#ef4444');
          text4.textContent = `${lane.sectionTimes.curve2.toFixed(2)}초`;
          svg.appendChild(text4);
        }
      });
    }
    
    function updateLaneTable(lanes, targetTime) {
      const tbody = document.getElementById('laneTimeTable');
      console.log('updateLaneTable 호출됨 (모바일), tbody 존재:', !!tbody);
      
      if (!tbody) {
        console.error('laneTimeTable tbody를 찾을 수 없음!');
        return;
      }
      
      tbody.innerHTML = '';
      console.log('tbody 초기화 완료');
      
      // 선택된 레인 정보
      const selectedLaneData = lanes.find(l => l.isSelected);
      
      lanes.forEach((lane, index) => {
        console.log(`레인 ${lane.lane} 행 추가 중...`);
        const row = tbody.insertRow();
        if (lane.isSelected) {
          row.className = 'bg-purple-100 font-semibold';
        } else if (Math.abs(lane.distance - 400) < 0.1) {
          row.className = 'bg-green-50';
        }
        
        row.innerHTML = `
          <td class="font-bold text-xs ${lane.isSelected ? 'text-purple-700' : ''}">${lane.lane}${lane.isSelected ? '✓' : ''}</td>
          <td class="text-xs">${lane.distance.toFixed(1)}m</td>
          <td class="font-bold">${lane.adjustedTime.toFixed(1)}초</td>
          <td class="text-xs text-blue-600">${lane.sectionTimes.straight1.toFixed(1)}</td>
          <td class="text-xs text-red-600">${lane.sectionTimes.curve1.toFixed(1)}</td>
          <td class="text-xs text-blue-600">${lane.sectionTimes.straight2.toFixed(1)}</td>
          <td class="text-xs text-red-600">${lane.sectionTimes.curve2.toFixed(1)}</td>
        `;
      });
      
      console.log(`테이블 업데이트 완료: ${tbody.rows.length}개 행 추가됨`);
      
      // 추가 정보 표시 영역 생성
      const infoContainer = document.getElementById('laneInfoContainer');
      if (infoContainer && selectedLaneData) {
        const lane1Time = 400 / selectedLaneData.speedInSelectedLane;
        infoContainer.innerHTML = `
          <div class="mt-3 p-3 bg-purple-50 rounded">
            <div class="grid grid-cols-2 gap-2 text-xs">
              <div class="bg-white p-2 rounded">
                <div class="text-gray-600">속도</div>
                <div class="font-bold text-purple-700">${selectedLaneData.speedKMH.toFixed(1)} km/h</div>
              </div>
              <div class="bg-white p-2 rounded">
                <div class="text-gray-600">400m 환산</div>
                <div class="font-bold text-purple-700">${lane1Time.toFixed(1)}초</div>
              </div>
            </div>
          </div>
        `;
      }
    }
    }
    
    // 목표 페이스 계산
    function calculateTargetPace() {
      const distance = document.getElementById('targetDistance').value;
      const hours = parseInt(document.getElementById('targetHours').value) || 0;
      const minutes = parseInt(document.getElementById('targetMinutes').value) || 0;
      const seconds = parseInt(document.getElementById('targetSeconds').value) || 0;
      
      if (distance === 'custom') {
        document.getElementById('customDistance').classList.remove('hidden');
        return;
      } else {
        document.getElementById('customDistance').classList.add('hidden');
      }
      
      const totalSeconds = hours * 3600 + minutes * 60 + seconds;
      if (totalSeconds === 0) return;
      
      const distanceMeters = parseFloat(distance);
      const pacePerKm = totalSeconds / (distanceMeters / 1000);
      const speed = (distanceMeters / totalSeconds) * 3.6;
      
      const resultsDiv = document.getElementById('targetPaceResults');
      resultsDiv.innerHTML = `
        <div class="result-card">
          <h3 class="font-bold text-sm mb-3">계산 결과</h3>
          <div class="grid grid-cols-2 gap-3 text-xs">
            <div class="bg-blue-50 p-3 rounded text-center">
              <span class="text-gray-600">km 페이스</span>
              <p class="font-bold text-xl text-blue-600">${formatPace(pacePerKm)}</p>
            </div>
            <div class="bg-green-50 p-3 rounded text-center">
              <span class="text-gray-600">시속</span>
              <p class="font-bold text-xl text-green-600">${speed.toFixed(1)} km/h</p>
            </div>
            <div class="bg-orange-50 p-3 rounded text-center">
              <span class="text-gray-600">400m</span>
              <p class="font-bold text-lg text-orange-600">${formatTime(pacePerKm * 0.4)}</p>
            </div>
            <div class="bg-purple-50 p-3 rounded text-center">
              <span class="text-gray-600">100m</span>
              <p class="font-bold text-lg text-purple-600">${formatTime(pacePerKm * 0.1)}</p>
            </div>
          </div>
        </div>
      `;
    }
    
    // 스플릿 계산
    function calculateSplits() {
      const distance = parseFloat(document.getElementById('splitDistance').value);
      const paceMin = parseInt(document.getElementById('splitPaceMin').value) || 0;
      const paceSec = parseInt(document.getElementById('splitPaceSec').value) || 0;
      const strategy = document.getElementById('paceStrategy').value;
      
      if (paceMin === 0 && paceSec === 0) return;
      
      const pacePerKm = paceMin * 60 + paceSec;
      const totalTime = (distance / 1000) * pacePerKm;
      
      const resultsDiv = document.getElementById('splitResults');
      let html = `
        <div class="result-card">
          <h3 class="font-bold text-sm mb-3">스플릿 타임</h3>
          <div class="overflow-x-auto">
            <table class="mobile-table">
              <thead>
                <tr>
                  <th>구간</th>
                  <th>누적 거리</th>
                  <th>구간 페이스</th>
                  <th>통과 시간</th>
                </tr>
              </thead>
              <tbody>
      `;
      
      const splitCount = Math.floor(distance / 1000);
      let cumulativeTime = 0;
      
      for (let i = 1; i <= splitCount; i++) {
        let splitPace = pacePerKm;
        
        if (strategy === 'negative') {
          splitPace = i <= splitCount / 2 ? pacePerKm + 5 : pacePerKm - 5;
        } else if (strategy === 'positive') {
          splitPace = i <= splitCount / 2 ? pacePerKm - 5 : pacePerKm + 5;
        }
        
        cumulativeTime += splitPace;
        
        html += `
          <tr>
            <td>${i}km</td>
            <td>${i}km</td>
            <td>${formatPace(splitPace)}</td>
            <td>${formatTime(cumulativeTime)}</td>
          </tr>
        `;
      }
      
      html += `
              </tbody>
            </table>
          </div>
          <div class="mt-3 p-3 bg-gray-50 rounded text-center">
            <span class="text-xs text-gray-600">예상 완주 시간</span>
            <p class="font-bold text-xl text-blue-600">${formatTime(totalTime, true)}</p>
          </div>
        </div>
      `;
      
      resultsDiv.innerHTML = html;
    }
    
    // 차트 다운로드 함수 (완전 구현)
    async function downloadChart(chartId, filename, format) {
      const loadingOverlay = document.getElementById('loadingOverlay');
      
      try {
        loadingOverlay.classList.add('active');
        
        const chartElement = document.getElementById(chartId);
        if (!chartElement) {
          throw new Error('차트를 찾을 수 없습니다');
        }
        
        const timestamp = new Date().toISOString().slice(0,10).replace(/-/g, '');
        const credit = 'AthleteTime_장호준코치제작';
        const fullFilename = `${credit}_${filename}_${timestamp}`;
        
        // PC 스타일 컨테이너 생성
        const downloadContainer = document.createElement('div');
        downloadContainer.style.cssText = `
          position: absolute;
          left: -9999px;
          background: white;
          padding: 40px;
          width: 1200px;
          font-family: -apple-system, BlinkMacSystemFont, 'Malgun Gothic', sans-serif;
        `;
        
        // 헤더
        const header = document.createElement('div');
        header.innerHTML = `
          <div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 20px; border-bottom: 3px solid #667eea; margin-bottom: 30px;">
            <div>
              <h3 style="font-size: 24px; font-weight: bold; color: #667eea;">러닝 페이스 차트</h3>
              <p style="color: #764ba2; font-size: 14px;">과학적 훈련을 위한 정밀 분석 도구</p>
            </div>
            <div style="text-align: right;">
              <div style="font-size: 12px; color: #667eea; text-transform: uppercase; letter-spacing: 1px; font-weight: 500;">Developer</div>
              <p style="font-size: 20px; font-weight: bold; color: #1a1a1a; margin: 5px 0;">장호준 코치</p>
              <p style="font-size: 14px; color: #764ba2; font-weight: 600;">ATHLETE TIME</p>
            </div>
          </div>
        `;
        downloadContainer.appendChild(header);
        
        // 차트 내용
        const contentClone = chartElement.cloneNode(true);
        contentClone.querySelectorAll('button').forEach(el => el.remove());
        contentClone.querySelectorAll('.mobile-table-container').forEach(el => {
          el.style.overflow = 'visible';
        });
        contentClone.querySelectorAll('[style*="sticky"]').forEach(el => {
          el.style.position = 'relative';
          el.style.left = 'auto';
        });
        downloadContainer.appendChild(contentClone);
        
        // 푸터
        const footer = document.createElement('div');
        footer.innerHTML = `
          <div style="margin-top: 40px; padding-top: 20px; border-top: 2px solid #e5e7eb; text-align: center;">
            <div style="font-size: 24px; font-weight: 900; letter-spacing: -1px; color: #1f2937;">
              <span style="font-style: italic;">ATHLETE</span> <span>TIME</span>
            </div>
            <div style="font-size: 14px; color: #666; margin-top: 5px;">제작: 장호준 코치</div>
            <p style="color: #999; font-size: 12px; margin-top: 10px;">
              © 2024 Athlete Time | 한국 육상인을 위한 페이스 계산기<br>
              <span style="font-size: 11px;">러닝 전문 트레이닝 프로그램</span>
            </p>
          </div>
        `;
        downloadContainer.appendChild(footer);
        
        document.body.appendChild(downloadContainer);
        
        await new Promise(resolve => setTimeout(resolve, 100));
        
        const canvas = await html2canvas(downloadContainer, {
          scale: 3,
          backgroundColor: '#ffffff',
          logging: false
        });
        
        if (format === 'pdf') {
          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF('l', 'mm', 'a4');
          const dataUrl = canvas.toDataURL('image/png');
          
          const maxWidth = 277;
          const maxHeight = 190;
          const imgRatio = canvas.height / canvas.width;
          
          let finalWidth = maxWidth;
          let finalHeight = maxWidth * imgRatio;
          
          if (finalHeight > maxHeight) {
            finalHeight = maxHeight;
            finalWidth = maxHeight / imgRatio;
          }
          
          const x = (297 - finalWidth) / 2;
          const y = (210 - finalHeight) / 2;
          
          pdf.addImage(dataUrl, 'PNG', x, y, finalWidth, finalHeight);
          pdf.setProperties({
            title: filename.replace(/_/g, ' '),
            author: '장호준 코치',
            creator: 'ATHLETE TIME'
          });
          pdf.save(fullFilename + '.pdf');
        } else {
          canvas.toBlob(blob => {
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.download = fullFilename + '.png';
            link.href = url;
            link.click();
            URL.revokeObjectURL(url);
          });
        }
        
        document.body.removeChild(downloadContainer);
        
      } catch (error) {
        console.error('다운로드 실패:', error);
        alert('다운로드 중 오류가 발생했습니다');
      } finally {
        loadingOverlay.classList.remove('active');
      }
    }
    
    // 빠른 메뉴 함수
    function showQuickMenu() {
      const modal = document.getElementById('quickMenuModal');
      const panel = document.getElementById('quickMenuPanel');
      modal.classList.remove('hidden');
      setTimeout(() => {
        panel.classList.remove('translate-y-full');
      }, 10);
    }
    
    function hideQuickMenu() {
      const modal = document.getElementById('quickMenuModal');
      const panel = document.getElementById('quickMenuPanel');
      panel.classList.add('translate-y-full');
      setTimeout(() => {
        modal.classList.add('hidden');
      }, 300);
    }
    
    // 페이지 로드 시 초기화
    window.addEventListener('DOMContentLoaded', () => {
      switchTab('chart');
      
      // 트랙 레인 계산기 초기화
      setTimeout(() => {
        if (document.getElementById('laneTargetTime') && document.getElementById('laneLaneSelector')) {
          console.log('트랙 레인 계산기 초기화 중 (모바일)...');
          calculateLaneAll();
        }
      }, 100);
    });
  </script>
</body>
</html>