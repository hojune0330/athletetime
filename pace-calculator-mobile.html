<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>페이스 계산기 | 애슬리트 타임</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="device-router.js"></script>
  
  <style>
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Malgun Gothic', '맑은 고딕', sans-serif;
      -webkit-tap-highlight-color: transparent;
      overscroll-behavior: contain;
    }
    
    /* iOS 안전영역 */
    .safe-top { padding-top: env(safe-area-inset-top); }
    .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
    
    /* 하단 네비게이션 */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top: 1px solid #e5e7eb;
      padding-bottom: env(safe-area-inset-bottom);
      z-index: 50;
    }
    
    /* 탭 스타일 */
    .tab-active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    /* 테이블 스타일 */
    .pace-table {
      font-size: 11px;
    }
    .pace-table td, .pace-table th {
      padding: 4px 2px;
      text-align: center;
      border: 1px solid #e5e7eb;
      white-space: nowrap;
    }
    .pace-table th {
      background: #f3f4f6;
      font-weight: bold;
      font-size: 10px;
    }
    
    /* 스크롤 가능 테이블 */
    .table-scroll {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    
    /* 입력 필드 스타일 */
    input[type="number"] {
      -webkit-appearance: none;
      -moz-appearance: textfield;
    }
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
  </style>
</head>
<body class="bg-gray-50 pb-16">
  <!-- 상단 헤더 -->
  <header class="bg-gradient-to-r from-purple-600 to-blue-600 text-white sticky top-0 z-40 safe-top">
    <div class="flex items-center justify-between p-3">
      <div class="flex items-center gap-2">
        <button onclick="window.location.href='index-mobile.html'" class="p-2">
          <i class="fas fa-arrow-left text-lg"></i>
        </button>
        <h1 class="text-lg font-bold">페이스 계산기</h1>
      </div>
      
      <button onclick="switchToDesktop()" 
              class="bg-white/20 backdrop-blur rounded-lg px-3 py-1.5 text-sm">
        <i class="fas fa-desktop mr-1"></i> PC
      </button>
    </div>
    
    <!-- 탭 메뉴 -->
    <div class="flex gap-2 px-3 pb-3 overflow-x-auto">
      <button onclick="switchTab('chart')" id="tab-chart" 
              class="tab-btn px-3 py-1.5 rounded-lg text-sm font-medium whitespace-nowrap tab-active">
        페이스 차트
      </button>
      <button onclick="switchTab('calculator')" id="tab-calculator" 
              class="tab-btn px-3 py-1.5 rounded-lg text-sm font-medium whitespace-nowrap bg-white/20">
        계산기
      </button>
      <button onclick="switchTab('target')" id="tab-target" 
              class="tab-btn px-3 py-1.5 rounded-lg text-sm font-medium whitespace-nowrap bg-white/20">
        목표 페이스
      </button>
      <button onclick="switchTab('lane')" id="tab-lane" 
              class="tab-btn px-3 py-1.5 rounded-lg text-sm font-medium whitespace-nowrap bg-white/20">
        레인 계산
      </button>
    </div>
  </header>
  
  <main class="p-3">
    <!-- 페이스 차트 탭 -->
    <div id="chart-content" class="tab-content">
      <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
        <h2 class="font-bold text-base mb-3 text-center">
          <i class="fas fa-tachometer-alt text-blue-500 mr-2"></i>
          km 페이스 → 완주 시간
        </h2>
        
        <div class="table-scroll">
          <table class="pace-table w-full">
            <thead>
              <tr>
                <th class="sticky left-0 bg-gray-100 z-10">km 페이스</th>
                <th>5km</th>
                <th>10km</th>
                <th>21.1km</th>
                <th>42.2km</th>
              </tr>
            </thead>
            <tbody id="paceChartMobile">
              <!-- JavaScript로 채워짐 -->
            </tbody>
          </table>
        </div>
        
        <div class="mt-3 flex gap-2">
          <button onclick="downloadChart('chart1', 'pace_chart')" 
                  class="flex-1 bg-blue-500 text-white py-2 rounded-lg text-sm font-medium">
            <i class="fas fa-download mr-1"></i> 저장
          </button>
          <button onclick="shareChart()" 
                  class="flex-1 bg-green-500 text-white py-2 rounded-lg text-sm font-medium">
            <i class="fas fa-share mr-1"></i> 공유
          </button>
        </div>
      </div>
    </div>
    
    <!-- 계산기 탭 -->
    <div id="calculator-content" class="tab-content hidden">
      <div class="bg-white rounded-lg shadow-sm p-4">
        <h2 class="font-bold text-base mb-3">페이스 계산기</h2>
        
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-1">거리 (km)</label>
            <input type="number" id="distance" placeholder="예: 10" 
                   class="w-full px-3 py-2 border rounded-lg text-lg">
          </div>
          
          <div class="grid grid-cols-3 gap-2">
            <div>
              <label class="block text-xs font-medium mb-1">시간</label>
              <input type="number" id="hours" placeholder="0" min="0" 
                     class="w-full px-2 py-2 border rounded-lg text-center">
            </div>
            <div>
              <label class="block text-xs font-medium mb-1">분</label>
              <input type="number" id="minutes" placeholder="0" min="0" max="59"
                     class="w-full px-2 py-2 border rounded-lg text-center">
            </div>
            <div>
              <label class="block text-xs font-medium mb-1">초</label>
              <input type="number" id="seconds" placeholder="0" min="0" max="59"
                     class="w-full px-2 py-2 border rounded-lg text-center">
            </div>
          </div>
          
          <button onclick="calculatePace()" 
                  class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 rounded-lg font-bold">
            페이스 계산하기
          </button>
          
          <div id="result" class="hidden p-4 bg-gray-50 rounded-lg">
            <h3 class="font-bold text-sm mb-2">계산 결과</h3>
            <div class="space-y-1 text-sm">
              <p>km당 페이스: <span id="kmPace" class="font-bold text-blue-600"></span></p>
              <p>400m 랩: <span id="lap400" class="font-bold text-purple-600"></span></p>
              <p>속도: <span id="speed" class="font-bold text-green-600"></span> km/h</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 목표 페이스 탭 -->
    <div id="target-content" class="tab-content hidden">
      <div class="bg-white rounded-lg shadow-sm p-4">
        <h2 class="font-bold text-base mb-3">목표 기록별 페이스</h2>
        
        <div class="space-y-3">
          <select id="targetDistance" onchange="updateTargetTable()" 
                  class="w-full px-3 py-2 border rounded-lg">
            <option value="5">5km</option>
            <option value="10">10km</option>
            <option value="21.1">하프마라톤</option>
            <option value="42.2">풀마라톤</option>
          </select>
          
          <div id="targetTableContainer" class="table-scroll">
            <!-- JavaScript로 채워짐 -->
          </div>
        </div>
      </div>
    </div>
    
    <!-- 레인 계산 탭 -->
    <div id="lane-content" class="tab-content hidden">
      <div class="bg-white rounded-lg shadow-sm p-4">
        <h2 class="font-bold text-base mb-3">400m 트랙 레인별 거리</h2>
        
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-1">레인 선택</label>
            <select id="laneNumber" onchange="calculateLane()" 
                    class="w-full px-3 py-2 border rounded-lg">
              <option value="1">1번 레인 (400.00m)</option>
              <option value="2">2번 레인 (407.67m)</option>
              <option value="3">3번 레인 (415.33m)</option>
              <option value="4">4번 레인 (423.00m)</option>
              <option value="5">5번 레인 (430.66m)</option>
              <option value="6">6번 레인 (438.33m)</option>
              <option value="7">7번 레인 (445.99m)</option>
              <option value="8">8번 레인 (453.66m)</option>
            </select>
          </div>
          
          <div>
            <label class="block text-sm font-medium mb-1">바퀴 수</label>
            <input type="number" id="laps" value="1" min="0.5" step="0.5" 
                   onchange="calculateLane()" 
                   class="w-full px-3 py-2 border rounded-lg">
          </div>
          
          <div id="laneResult" class="p-4 bg-blue-50 rounded-lg">
            <h3 class="font-bold text-sm mb-2">계산 결과</h3>
            <div class="space-y-1 text-sm">
              <p>총 거리: <span id="totalDistance" class="font-bold text-blue-600">400.00m</span></p>
              <p>1레인 대비: <span id="difference" class="font-bold text-purple-600">+0.00m</span></p>
              <p>추가 비율: <span id="percentage" class="font-bold text-green-600">0.0%</span></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  
  <!-- 하단 네비게이션 -->
  <nav class="bottom-nav">
    <div class="grid grid-cols-4 gap-1">
      <a href="index-mobile.html" class="flex flex-col items-center py-2 text-gray-600">
        <i class="fas fa-home text-xl mb-1"></i>
        <span class="text-xs">홈</span>
      </a>
      <a href="pace-calculator-mobile.html" class="flex flex-col items-center py-2 text-purple-600">
        <i class="fas fa-calculator text-xl mb-1"></i>
        <span class="text-xs">계산기</span>
      </a>
      <a href="community-mobile.html" class="flex flex-col items-center py-2 text-gray-600">
        <i class="fas fa-users text-xl mb-1"></i>
        <span class="text-xs">커뮤니티</span>
      </a>
      <a href="chat-mobile.html" class="flex flex-col items-center py-2 text-gray-600">
        <i class="fas fa-comments text-xl mb-1"></i>
        <span class="text-xs">채팅</span>
      </a>
    </div>
  </nav>
  
  <script>
    // 탭 전환
    function switchTab(tab) {
      // 모든 탭 컨텐츠 숨기기
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.add('hidden');
      });
      
      // 모든 탭 버튼 비활성화
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('tab-active');
        btn.classList.add('bg-white/20');
      });
      
      // 선택된 탭 표시
      document.getElementById(tab + '-content').classList.remove('hidden');
      document.getElementById('tab-' + tab).classList.add('tab-active');
      document.getElementById('tab-' + tab).classList.remove('bg-white/20');
    }
    
    // PC 버전으로 전환
    function switchToDesktop() {
      if (confirm('PC 버전으로 전환하시겠습니까?')) {
        DeviceRouter.switchVersion('desktop');
      }
    }
    
    // 페이스 차트 데이터 생성
    function generatePaceChart() {
      const tbody = document.getElementById('paceChartMobile');
      const paces = [
        {pace: '3:00', times: ['15:00', '30:00', '1:03:18', '2:06:37']},
        {pace: '3:30', times: ['17:30', '35:00', '1:13:53', '2:27:46']},
        {pace: '4:00', times: ['20:00', '40:00', '1:24:23', '2:48:47']},
        {pace: '4:30', times: ['22:30', '45:00', '1:34:54', '2:09:48']},
        {pace: '5:00', times: ['25:00', '50:00', '1:45:24', '3:30:49']},
        {pace: '5:30', times: ['27:30', '55:00', '1:55:55', '3:51:50']},
        {pace: '6:00', times: ['30:00', '1:00:00', '2:06:36', '4:12:50']}
      ];
      
      tbody.innerHTML = paces.map(p => `
        <tr>
          <td class="sticky left-0 bg-white font-bold">${p.pace}</td>
          ${p.times.map(t => `<td>${t}</td>`).join('')}
        </tr>
      `).join('');
    }
    
    // 페이스 계산
    function calculatePace() {
      const distance = parseFloat(document.getElementById('distance').value);
      const hours = parseInt(document.getElementById('hours').value) || 0;
      const minutes = parseInt(document.getElementById('minutes').value) || 0;
      const seconds = parseInt(document.getElementById('seconds').value) || 0;
      
      if (!distance || (hours === 0 && minutes === 0 && seconds === 0)) {
        alert('거리와 시간을 입력해주세요');
        return;
      }
      
      const totalSeconds = hours * 3600 + minutes * 60 + seconds;
      const paceSeconds = totalSeconds / distance;
      const paceMinutes = Math.floor(paceSeconds / 60);
      const paceRemainingSeconds = Math.round(paceSeconds % 60);
      
      const lap400Seconds = (totalSeconds / distance) * 0.4;
      const lap400Minutes = Math.floor(lap400Seconds / 60);
      const lap400RemainingSeconds = Math.round(lap400Seconds % 60);
      
      const speed = (distance / totalSeconds * 3600).toFixed(2);
      
      document.getElementById('kmPace').textContent = 
        `${paceMinutes}:${paceRemainingSeconds.toString().padStart(2, '0')}`;
      document.getElementById('lap400').textContent = 
        `${lap400Minutes}:${lap400RemainingSeconds.toString().padStart(2, '0')}`;
      document.getElementById('speed').textContent = speed;
      
      document.getElementById('result').classList.remove('hidden');
    }
    
    // 레인 계산
    function calculateLane() {
      const lane = parseInt(document.getElementById('laneNumber').value);
      const laps = parseFloat(document.getElementById('laps').value);
      
      const laneDistances = [400, 407.67, 415.33, 423, 430.66, 438.33, 445.99, 453.66];
      const distance = laneDistances[lane - 1];
      const totalDistance = distance * laps;
      const difference = totalDistance - (400 * laps);
      const percentage = ((difference / (400 * laps)) * 100).toFixed(1);
      
      document.getElementById('totalDistance').textContent = totalDistance.toFixed(2) + 'm';
      document.getElementById('difference').textContent = 
        difference > 0 ? `+${difference.toFixed(2)}m` : `${difference.toFixed(2)}m`;
      document.getElementById('percentage').textContent = percentage + '%';
    }
    
    // 차트 다운로드
    async function downloadChart(elementId, filename) {
      try {
        alert('차트 저장 기능은 PC 버전에서 사용 가능합니다.');
      } catch (error) {
        console.error('Download error:', error);
      }
    }
    
    // 공유 기능
    function shareChart() {
      if (navigator.share) {
        navigator.share({
          title: '페이스 차트',
          text: '애슬리트 타임 페이스 계산기',
          url: window.location.href
        });
      } else {
        alert('공유 기능이 지원되지 않는 브라우저입니다.');
      }
    }
    
    // 페이지 로드시 초기화
    document.addEventListener('DOMContentLoaded', () => {
      generatePaceChart();
      calculateLane();
    });
  </script>
</body>
</html>