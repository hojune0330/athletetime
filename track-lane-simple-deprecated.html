<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>400m 트랙 레인 계산기 | Athlete Time</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', '맑은 고딕', sans-serif;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .lane-1 { stroke: #ef4444; fill: none; }
    .lane-2 { stroke: #f97316; fill: none; }
    .lane-3 { stroke: #eab308; fill: none; }
    .lane-4 { stroke: #84cc16; fill: none; }
    .lane-5 { stroke: #22c55e; fill: none; }
    .lane-6 { stroke: #06b6d4; fill: none; }
    .lane-7 { stroke: #3b82f6; fill: none; }
    .lane-8 { stroke: #8b5cf6; fill: none; }
    
    .lane-selected {
      stroke-width: 3;
      opacity: 1;
    }
    
    .lane-unselected {
      stroke-width: 1.5;
      opacity: 0.4;
    }

    .section-time {
      font-size: 1.25rem;
      font-weight: bold;
    }

    .section-label {
      font-size: 0.875rem;
      color: #6b7280;
      margin-bottom: 0.25rem;
    }

    /* 트랙 SVG 안의 텍스트 스타일 */
    .track-text {
      font-size: 10px;
      font-weight: bold;
    }

    .track-time-text {
      font-size: 11px;
      font-weight: bold;
      fill: white;
    }

    .track-distance-text {
      font-size: 9px;
      fill: white;
      opacity: 0.9;
    }
  </style>
</head>
<body class="bg-gray-50">
  <div class="container mx-auto px-4 py-6 max-w-7xl">
    <!-- Header -->
    <div class="gradient-bg text-white p-4 rounded-lg mb-4">
      <div class="flex justify-between items-center">
        <div>
          <h1 class="text-2xl font-bold">400m 트랙 레인별 구간 시간 계산기</h1>
          <p class="text-sm opacity-90">4개 구간 (직선×2, 곡선×2) 시간 분석</p>
        </div>
        <button onclick="window.location.href='pace-calculator.html'" 
                class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded transition">
          <i class="fas fa-arrow-left mr-2"></i>돌아가기
        </button>
      </div>
    </div>

    <!-- 목표 시간 입력 섹션 -->
    <div class="bg-white rounded-lg shadow p-6 mb-4">
      <div class="flex flex-wrap items-center gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">400m 목표 시간 (초)</label>
          <div class="flex gap-2">
            <input type="number" id="targetTime" value="72" min="30" max="120" step="0.1"
                   class="w-32 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
            <button onclick="calculateAll()" 
                    class="bg-purple-600 text-white px-6 py-2 rounded-md hover:bg-purple-700 transition">
              계산하기
            </button>
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">선택 레인</label>
          <select id="laneSelector" onchange="calculateAll()" 
                  class="px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
            <option value="1">레인 1 (400.00m)</option>
            <option value="2">레인 2 (407.67m)</option>
            <option value="3">레인 3 (415.33m)</option>
            <option value="4">레인 4 (423.00m)</option>
            <option value="5">레인 5 (430.66m)</option>
            <option value="6">레인 6 (438.33m)</option>
            <option value="7">레인 7 (445.99m)</option>
            <option value="8">레인 8 (453.66m)</option>
          </select>
        </div>
      </div>
    </div>

    <!-- 큰 트랙 시각화 (상단으로 이동) -->
    <div class="bg-white rounded-lg shadow p-6 mb-4">
      <h3 class="font-bold text-xl mb-4">트랙 구간별 시간 시각화</h3>
      
      <!-- 큰 SVG 트랙 -->
      <div class="w-full overflow-x-auto">
        <svg viewBox="0 0 800 500" class="w-full" style="min-width: 700px; min-height: 450px;">
          <!-- 배경 -->
          <rect width="800" height="500" fill="#f0f0f0"/>
          
          <!-- 트랙 배경 (잔디) -->
          <rect x="50" y="50" width="700" height="400" rx="200" fill="#90EE90" opacity="0.3"/>
          
          <!-- 트랙 레인들 -->
          <g id="trackLanes">
            <!-- 동적으로 생성됨 -->
          </g>
          
          <!-- 중앙 잔디 -->
          <rect x="200" y="200" width="400" height="100" rx="50" fill="#90EE90"/>
          
          <!-- Start/Finish 라인 -->
          <line x1="400" y1="50" x2="400" y2="450" stroke="white" stroke-width="4"/>
          <rect x="380" y="240" width="40" height="20" fill="black"/>
          <text x="400" y="255" font-size="12" fill="white" text-anchor="middle" font-weight="bold">S/F</text>
          
          <!-- 100m, 200m, 300m 마커 -->
          <g id="distanceMarkers">
            <!-- 100m 지점 (첫 번째 곡선 끝) -->
            <line x1="200" y1="240" x2="200" y2="260" stroke="yellow" stroke-width="3"/>
            <text x="200" y="275" font-size="11" fill="black" text-anchor="middle" font-weight="bold">100m</text>
            
            <!-- 200m 지점 (백스트레치 끝) -->
            <line x1="400" y1="90" x2="400" y2="110" stroke="yellow" stroke-width="3"/>
            <text x="400" y="80" font-size="11" fill="black" text-anchor="middle" font-weight="bold">200m</text>
            
            <!-- 300m 지점 (두 번째 곡선 끝) -->
            <line x1="600" y1="240" x2="600" y2="260" stroke="yellow" stroke-width="3"/>
            <text x="600" y="275" font-size="11" fill="black" text-anchor="middle" font-weight="bold">300m</text>
          </g>
          
          <!-- 구간 라벨 -->
          <g id="sectionLabels">
            <!-- 홈스트레치 (직선2) -->
            <rect x="450" y="380" width="100" height="30" rx="5" fill="#3b82f6" opacity="0.8"/>
            <text x="500" y="398" font-size="14" fill="white" text-anchor="middle" font-weight="bold">직선② 홈</text>
            
            <!-- 백스트레치 (직선1) -->
            <rect x="250" y="90" width="100" height="30" rx="5" fill="#3b82f6" opacity="0.8"/>
            <text x="300" y="108" font-size="14" fill="white" text-anchor="middle" font-weight="bold">직선① 백</text>
            
            <!-- 첫 번째 곡선 -->
            <rect x="620" y="225" width="80" height="30" rx="5" fill="#ef4444" opacity="0.8"/>
            <text x="660" y="243" font-size="14" fill="white" text-anchor="middle" font-weight="bold">곡선①</text>
            
            <!-- 두 번째 곡선 -->
            <rect x="100" y="225" width="80" height="30" rx="5" fill="#ef4444" opacity="0.8"/>
            <text x="140" y="243" font-size="14" fill="white" text-anchor="middle" font-weight="bold">곡선②</text>
          </g>
          
          <!-- 진행 방향 화살표 -->
          <defs>
            <marker id="arrowhead" markerWidth="15" markerHeight="10" refX="15" refY="5" orient="auto">
              <polygon points="0 0, 15 5, 0 10" fill="#333" />
            </marker>
          </defs>
          
          <!-- 화살표들 -->
          <g opacity="0.7">
            <!-- 홈스트레치 화살표 -->
            <path d="M 420 410 L 550 410" stroke="#333" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
            
            <!-- 첫 번째 곡선 화살표 -->
            <path d="M 650 390 Q 680 250 650 110" stroke="#333" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
            
            <!-- 백스트레치 화살표 -->
            <path d="M 550 90 L 420 90" stroke="#333" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
            
            <!-- 두 번째 곡선 화살표 -->
            <path d="M 150 110 Q 120 250 150 390" stroke="#333" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
          </g>
          
          <!-- 레인별 시간 표시 영역 -->
          <g id="laneTimes">
            <!-- 동적으로 생성됨 -->
          </g>
        </svg>
      </div>
      
      <!-- 범례 -->
      <div class="flex justify-center gap-6 mt-4">
        <div class="flex items-center gap-2">
          <div class="w-6 h-3 bg-blue-500"></div>
          <span class="text-sm">직선 구간</span>
        </div>
        <div class="flex items-center gap-2">
          <div class="w-6 h-3 bg-red-500"></div>
          <span class="text-sm">곡선 구간</span>
        </div>
        <div class="flex items-center gap-2">
          <div class="w-6 h-3 bg-purple-500"></div>
          <span class="text-sm font-bold">선택 레인</span>
        </div>
      </div>
    </div>

    <!-- 4개 구간 시간 표시 -->
    <div class="bg-white rounded-lg shadow p-6 mb-4">
      <h2 class="text-xl font-bold mb-4">
        <span id="selectedLaneDisplay">레인 1</span> - 구간별 시간 상세
      </h2>
      
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
        <!-- 직선 1 -->
        <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
          <div class="section-label">직선구간 ①</div>
          <div class="section-time text-blue-600" id="straight1Time">0.00초</div>
          <div class="text-xs text-gray-600 mt-1">
            <span id="straight1Distance">84.39</span>m
          </div>
        </div>
        
        <!-- 곡선 1 -->
        <div class="bg-red-50 rounded-lg p-4 border border-red-200">
          <div class="section-label">곡선구간 ①</div>
          <div class="section-time text-red-600" id="curve1Time">0.00초</div>
          <div class="text-xs text-gray-600 mt-1">
            <span id="curve1Distance">115.61</span>m
          </div>
        </div>
        
        <!-- 직선 2 -->
        <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
          <div class="section-label">직선구간 ②</div>
          <div class="section-time text-blue-600" id="straight2Time">0.00초</div>
          <div class="text-xs text-gray-600 mt-1">
            <span id="straight2Distance">84.39</span>m
          </div>
        </div>
        
        <!-- 곡선 2 -->
        <div class="bg-red-50 rounded-lg p-4 border border-red-200">
          <div class="section-label">곡선구간 ②</div>
          <div class="section-time text-red-600" id="curve2Time">0.00초</div>
          <div class="text-xs text-gray-600 mt-1">
            <span id="curve2Distance">115.61</span>m
          </div>
        </div>
      </div>

      <!-- 합계 정보 -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <!-- 직선 합계 -->
        <div class="bg-blue-100 rounded-lg p-4 border-2 border-blue-300">
          <div class="text-sm font-medium text-blue-700">직선 총 시간</div>
          <div class="text-2xl font-bold text-blue-700" id="totalStraightTime">0.00초</div>
          <div class="text-sm text-gray-600 mt-1">
            총 <span id="totalStraightDistance">168.78</span>m
          </div>
        </div>
        
        <!-- 곡선 합계 -->
        <div class="bg-red-100 rounded-lg p-4 border-2 border-red-300">
          <div class="text-sm font-medium text-red-700">곡선 총 시간</div>
          <div class="text-2xl font-bold text-red-700" id="totalCurveTime">0.00초</div>
          <div class="text-sm text-gray-600 mt-1">
            총 <span id="totalCurveDistance">231.22</span>m
          </div>
        </div>
        
        <!-- 전체 합계 -->
        <div class="bg-green-100 rounded-lg p-4 border-2 border-green-300">
          <div class="text-sm font-medium text-green-700">총 소요 시간</div>
          <div class="text-2xl font-bold text-green-700" id="totalTime">0.00초</div>
          <div class="text-sm text-gray-600 mt-1">
            총 거리: <span id="totalDistance">400.00</span>m
          </div>
        </div>
      </div>
    </div>

    <!-- 전체 레인 비교 테이블 -->
    <div class="bg-white rounded-lg shadow p-4">
      <h3 class="font-bold text-lg mb-3">전체 레인 구간별 시간 비교</h3>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead class="bg-gray-100">
            <tr>
              <th rowspan="2" class="px-3 py-2 text-left border-r">레인</th>
              <th rowspan="2" class="px-3 py-2 text-center border-r">총 거리</th>
              <th colspan="2" class="px-3 py-2 text-center bg-blue-50 border-r">직선 구간</th>
              <th colspan="2" class="px-3 py-2 text-center bg-red-50 border-r">곡선 구간</th>
              <th rowspan="2" class="px-3 py-2 text-center bg-green-50">총 시간</th>
            </tr>
            <tr>
              <th class="px-2 py-1 text-center bg-blue-50 text-xs">거리(m)</th>
              <th class="px-2 py-1 text-center bg-blue-50 text-xs border-r">시간(초)</th>
              <th class="px-2 py-1 text-center bg-red-50 text-xs">거리(m)</th>
              <th class="px-2 py-1 text-center bg-red-50 text-xs border-r">시간(초)</th>
            </tr>
          </thead>
          <tbody id="laneTableBody">
            <!-- 동적으로 생성됨 -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // World Athletics (IAAF) 공식 표준 트랙 규격
    const STRAIGHT_LENGTH = 84.39; // 직선 구간 길이
    const LANE_WIDTH = 1.22; // 레인 폭
    const KERB_RADIUS = 36.50; // 내측 가장자리(kerb) 반경
    const MEASUREMENT_OFFSET_LANE1 = 0.30; // 레인 1 측정선 오프셋 (커브 있는 경우)
    const MEASUREMENT_OFFSET_OTHER = 0.20; // 레인 2-8 측정선 오프셋
    
    // 각 레인의 측정 반경 계산
    function getLaneMeasurementRadius(laneNumber) {
      if (laneNumber === 1) {
        return KERB_RADIUS + MEASUREMENT_OFFSET_LANE1; // 36.80m
      } else {
        return KERB_RADIUS + (LANE_WIDTH * (laneNumber - 1)) + MEASUREMENT_OFFSET_OTHER;
      }
    }
    
    const laneData = [
      { lane: 1, radius: getLaneMeasurementRadius(1), color: '#ef4444', name: 'Lane 1' },
      { lane: 2, radius: getLaneMeasurementRadius(2), color: '#f97316', name: 'Lane 2' },
      { lane: 3, radius: getLaneMeasurementRadius(3), color: '#eab308', name: 'Lane 3' },
      { lane: 4, radius: getLaneMeasurementRadius(4), color: '#84cc16', name: 'Lane 4' },
      { lane: 5, radius: getLaneMeasurementRadius(5), color: '#22c55e', name: 'Lane 5' },
      { lane: 6, radius: getLaneMeasurementRadius(6), color: '#06b6d4', name: 'Lane 6' },
      { lane: 7, radius: getLaneMeasurementRadius(7), color: '#3b82f6', name: 'Lane 7' },
      { lane: 8, radius: getLaneMeasurementRadius(8), color: '#8b5cf6', name: 'Lane 8' }
    ];

    // 레인 거리 계산
    function calculateLaneDistance(laneNumber) {
      const lane = laneData[laneNumber - 1];
      const oneStraight = STRAIGHT_LENGTH; // 직선 하나
      const oneCurve = Math.PI * lane.radius; // 곡선 하나 (반원)
      
      const totalStraight = oneStraight * 2; // 직선 2개 합계
      const totalCurve = oneCurve * 2; // 곡선 2개 합계
      const totalDistance = totalStraight + totalCurve;
      
      return {
        oneStraight: oneStraight,
        oneCurve: oneCurve,
        totalStraight: totalStraight,
        totalCurve: totalCurve,
        totalDistance: totalDistance,
        stagger: totalDistance - 400,
        straightPercentage: (totalStraight / totalDistance * 100),
        curvePercentage: (totalCurve / totalDistance * 100),
        radius: lane.radius
      };
    }

    // 시간 계산
    function calculateTimes(laneNumber, targetTime400m) {
      const distances = calculateLaneDistance(laneNumber);
      
      // 레인 1 기준 속도 계산
      const baseSpeed = 400 / targetTime400m; // m/s
      
      // 실제 레인의 조정된 시간 (거리에 비례)
      const adjustedTotalTime = distances.totalDistance / baseSpeed;
      
      // 각 구간별 시간 계산
      const oneStraightTime = distances.oneStraight / baseSpeed;
      const oneCurveTime = distances.oneCurve / baseSpeed;
      const totalStraightTime = distances.totalStraight / baseSpeed;
      const totalCurveTime = distances.totalCurve / baseSpeed;
      
      return {
        straight1Time: oneStraightTime,
        straight2Time: oneStraightTime,
        curve1Time: oneCurveTime,
        curve2Time: oneCurveTime,
        totalStraightTime: totalStraightTime,
        totalCurveTime: totalCurveTime,
        totalTime: adjustedTotalTime,
        avgSpeed: baseSpeed,
        avgKmh: baseSpeed * 3.6,
        pace100m: 100 / baseSpeed,
        ...distances
      };
    }

    // SVG 트랙 레인 그리기
    function drawTrackLanes(selectedLane, targetTime) {
      const svg = document.getElementById('trackLanes');
      const timesGroup = document.getElementById('laneTimes');
      svg.innerHTML = '';
      timesGroup.innerHTML = '';
      
      // 실제 트랙 비율에 맞게 조정
      const scaleFactor = 2.5;
      const straightLength = 84.39 * scaleFactor; // 약 211px
      const centerX = 400;
      const centerY = 250;
      
      // 레인 8부터 1까지 역순으로 그리기 (바깥쪽부터)
      for (let i = 8; i >= 1; i--) {
        const isSelected = i === selectedLane;
        const strokeWidth = isSelected ? 3 : 1.5;
        const opacity = isSelected ? 1 : 0.4;
        const color = isSelected ? '#9333ea' : laneData[i-1].color;
        
        // 각 레인의 측정 반경 계산
        const measurementRadius = getLaneMeasurementRadius(i);
        const radius = measurementRadius * scaleFactor;
        
        // 실제 트랙 형태로 그리기
        const leftCenterX = centerX - straightLength / 2;
        const rightCenterX = centerX + straightLength / 2;
        
        const lane = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        const d = `
          M ${leftCenterX} ${centerY - radius}
          L ${rightCenterX} ${centerY - radius}
          A ${radius} ${radius} 0 0 1 ${rightCenterX} ${centerY + radius}
          L ${leftCenterX} ${centerY + radius}
          A ${radius} ${radius} 0 0 1 ${leftCenterX} ${centerY - radius}
        `;
        
        lane.setAttribute('d', d);
        lane.setAttribute('fill', 'none');
        lane.setAttribute('stroke', color);
        lane.setAttribute('stroke-width', strokeWidth);
        lane.setAttribute('opacity', opacity);
        svg.appendChild(lane);
        
        // 레인 번호 표시
        const laneNumBg = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        laneNumBg.setAttribute('cx', x + width/2);
        laneNumBg.setAttribute('cy', y + height - 20);
        laneNumBg.setAttribute('r', '12');
        laneNumBg.setAttribute('fill', color);
        laneNumBg.setAttribute('opacity', isSelected ? '1' : '0.7');
        svg.appendChild(laneNumBg);
        
        const laneNum = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        laneNum.setAttribute('x', x + width/2);
        laneNum.setAttribute('y', y + height - 15);
        laneNum.setAttribute('text-anchor', 'middle');
        laneNum.setAttribute('font-size', '14');
        laneNum.setAttribute('font-weight', 'bold');
        laneNum.setAttribute('fill', 'white');
        laneNum.textContent = i;
        svg.appendChild(laneNum);
        
        // 선택된 레인의 구간별 시간 표시
        if (isSelected) {
          const result = calculateTimes(i, targetTime);
          
          // 홈스트레치 (직선2) 시간
          const homeStraightBg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
          homeStraightBg.setAttribute('x', x + width/2 + 30);
          homeStraightBg.setAttribute('y', y + height - 45);
          homeStraightBg.setAttribute('width', '80');
          homeStraightBg.setAttribute('height', '35');
          homeStraightBg.setAttribute('rx', '5');
          homeStraightBg.setAttribute('fill', '#3b82f6');
          timesGroup.appendChild(homeStraightBg);
          
          const homeStraightTime = document.createElementNS('http://www.w3.org/2000/svg', 'text');
          homeStraightTime.setAttribute('x', x + width/2 + 70);
          homeStraightTime.setAttribute('y', y + height - 30);
          homeStraightTime.setAttribute('text-anchor', 'middle');
          homeStraightTime.setAttribute('class', 'track-time-text');
          homeStraightTime.textContent = result.straight2Time.toFixed(2) + '초';
          timesGroup.appendChild(homeStraightTime);
          
          const homeStraightDist = document.createElementNS('http://www.w3.org/2000/svg', 'text');
          homeStraightDist.setAttribute('x', x + width/2 + 70);
          homeStraightDist.setAttribute('y', y + height - 18);
          homeStraightDist.setAttribute('text-anchor', 'middle');
          homeStraightDist.setAttribute('class', 'track-distance-text');
          homeStraightDist.textContent = result.oneStraight.toFixed(1) + 'm';
          timesGroup.appendChild(homeStraightDist);
          
          // 백스트레치 (직선1) 시간
          const backStraightBg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
          backStraightBg.setAttribute('x', x + width/2 - 110);
          backStraightBg.setAttribute('y', y + 10);
          backStraightBg.setAttribute('width', '80');
          backStraightBg.setAttribute('height', '35');
          backStraightBg.setAttribute('rx', '5');
          backStraightBg.setAttribute('fill', '#3b82f6');
          timesGroup.appendChild(backStraightBg);
          
          const backStraightTime = document.createElementNS('http://www.w3.org/2000/svg', 'text');
          backStraightTime.setAttribute('x', x + width/2 - 70);
          backStraightTime.setAttribute('y', y + 25);
          backStraightTime.setAttribute('text-anchor', 'middle');
          backStraightTime.setAttribute('class', 'track-time-text');
          backStraightTime.textContent = result.straight1Time.toFixed(2) + '초';
          timesGroup.appendChild(backStraightTime);
          
          const backStraightDist = document.createElementNS('http://www.w3.org/2000/svg', 'text');
          backStraightDist.setAttribute('x', x + width/2 - 70);
          backStraightDist.setAttribute('y', y + 37);
          backStraightDist.setAttribute('text-anchor', 'middle');
          backStraightDist.setAttribute('class', 'track-distance-text');
          backStraightDist.textContent = result.oneStraight.toFixed(1) + 'm';
          timesGroup.appendChild(backStraightDist);
          
          // 첫 번째 곡선 시간
          const curve1Bg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
          curve1Bg.setAttribute('x', x + width - 90);
          curve1Bg.setAttribute('y', y + height/2 - 17);
          curve1Bg.setAttribute('width', '75');
          curve1Bg.setAttribute('height', '35');
          curve1Bg.setAttribute('rx', '5');
          curve1Bg.setAttribute('fill', '#ef4444');
          timesGroup.appendChild(curve1Bg);
          
          const curve1Time = document.createElementNS('http://www.w3.org/2000/svg', 'text');
          curve1Time.setAttribute('x', x + width - 52);
          curve1Time.setAttribute('y', y + height/2 - 2);
          curve1Time.setAttribute('text-anchor', 'middle');
          curve1Time.setAttribute('class', 'track-time-text');
          curve1Time.textContent = result.curve1Time.toFixed(2) + '초';
          timesGroup.appendChild(curve1Time);
          
          const curve1Dist = document.createElementNS('http://www.w3.org/2000/svg', 'text');
          curve1Dist.setAttribute('x', x + width - 52);
          curve1Dist.setAttribute('y', y + height/2 + 10);
          curve1Dist.setAttribute('text-anchor', 'middle');
          curve1Dist.setAttribute('class', 'track-distance-text');
          curve1Dist.textContent = result.oneCurve.toFixed(1) + 'm';
          timesGroup.appendChild(curve1Dist);
          
          // 두 번째 곡선 시간
          const curve2Bg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
          curve2Bg.setAttribute('x', x + 15);
          curve2Bg.setAttribute('y', y + height/2 - 17);
          curve2Bg.setAttribute('width', '75');
          curve2Bg.setAttribute('height', '35');
          curve2Bg.setAttribute('rx', '5');
          curve2Bg.setAttribute('fill', '#ef4444');
          timesGroup.appendChild(curve2Bg);
          
          const curve2Time = document.createElementNS('http://www.w3.org/2000/svg', 'text');
          curve2Time.setAttribute('x', x + 52);
          curve2Time.setAttribute('y', y + height/2 - 2);
          curve2Time.setAttribute('text-anchor', 'middle');
          curve2Time.setAttribute('class', 'track-time-text');
          curve2Time.textContent = result.curve2Time.toFixed(2) + '초';
          timesGroup.appendChild(curve2Time);
          
          const curve2Dist = document.createElementNS('http://www.w3.org/2000/svg', 'text');
          curve2Dist.setAttribute('x', x + 52);
          curve2Dist.setAttribute('y', y + height/2 + 10);
          curve2Dist.setAttribute('text-anchor', 'middle');
          curve2Dist.setAttribute('class', 'track-distance-text');
          curve2Dist.textContent = result.oneCurve.toFixed(1) + 'm';
          timesGroup.appendChild(curve2Dist);
        }
      }
    }

    // 전체 계산 및 업데이트
    function calculateAll() {
      const targetTime = parseFloat(document.getElementById('targetTime').value) || 72;
      const selectedLane = parseInt(document.getElementById('laneSelector').value);
      
      // 선택된 레인 계산
      const result = calculateTimes(selectedLane, targetTime);
      
      // 메인 디스플레이 업데이트
      document.getElementById('selectedLaneDisplay').textContent = `레인 ${selectedLane}`;
      
      // 4개 구간 개별 시간
      document.getElementById('straight1Time').textContent = result.straight1Time.toFixed(2) + '초';
      document.getElementById('straight2Time').textContent = result.straight2Time.toFixed(2) + '초';
      document.getElementById('curve1Time').textContent = result.curve1Time.toFixed(2) + '초';
      document.getElementById('curve2Time').textContent = result.curve2Time.toFixed(2) + '초';
      
      // 4개 구간 개별 거리
      document.getElementById('straight1Distance').textContent = result.oneStraight.toFixed(2);
      document.getElementById('straight2Distance').textContent = result.oneStraight.toFixed(2);
      document.getElementById('curve1Distance').textContent = result.oneCurve.toFixed(2);
      document.getElementById('curve2Distance').textContent = result.oneCurve.toFixed(2);
      
      // 합계 시간
      document.getElementById('totalStraightTime').textContent = result.totalStraightTime.toFixed(2) + '초';
      document.getElementById('totalCurveTime').textContent = result.totalCurveTime.toFixed(2) + '초';
      document.getElementById('totalTime').textContent = result.totalTime.toFixed(2) + '초';
      
      // 합계 거리
      document.getElementById('totalStraightDistance').textContent = result.totalStraight.toFixed(2);
      document.getElementById('totalCurveDistance').textContent = result.totalCurve.toFixed(2);
      document.getElementById('totalDistance').textContent = result.totalDistance.toFixed(2);
      
      // SVG 트랙 업데이트
      drawTrackLanes(selectedLane, targetTime);
      
      // 테이블 업데이트
      updateLaneTable(targetTime, selectedLane);
      
      // 레인 선택자 옵션 텍스트 업데이트
      updateLaneSelector();
    }

    // 레인 선택자 업데이트
    function updateLaneSelector() {
      const selector = document.getElementById('laneSelector');
      for (let i = 1; i <= 8; i++) {
        const distances = calculateLaneDistance(i);
        selector.options[i-1].text = `레인 ${i} (${distances.totalDistance.toFixed(2)}m)`;
      }
    }

    // 테이블 업데이트
    function updateLaneTable(targetTime, selectedLane) {
      const tbody = document.getElementById('laneTableBody');
      tbody.innerHTML = '';
      
      for (let i = 1; i <= 8; i++) {
        const result = calculateTimes(i, targetTime);
        const isSelected = i === selectedLane;
        
        const row = `
          <tr class="${isSelected ? 'bg-purple-50 font-bold' : ''} hover:bg-gray-50 cursor-pointer" onclick="selectLane(${i})">
            <td class="px-3 py-2 border-r">
              <span class="inline-block w-3 h-3 rounded-full mr-2" 
                    style="background-color: ${laneData[i-1].color}"></span>
              레인 ${i}
            </td>
            <td class="px-3 py-2 text-center border-r">${result.totalDistance.toFixed(2)}m</td>
            <td class="px-2 py-2 text-center bg-blue-50 text-xs">${result.totalStraight.toFixed(2)}</td>
            <td class="px-2 py-2 text-center bg-blue-50 text-sm font-semibold text-blue-700 border-r">
              ${result.totalStraightTime.toFixed(2)}
            </td>
            <td class="px-2 py-2 text-center bg-red-50 text-xs">${result.totalCurve.toFixed(2)}</td>
            <td class="px-2 py-2 text-center bg-red-50 text-sm font-semibold text-red-700 border-r">
              ${result.totalCurveTime.toFixed(2)}
            </td>
            <td class="px-3 py-2 text-center bg-green-50 font-semibold text-green-700">
              ${result.totalTime.toFixed(2)}초
            </td>
          </tr>
        `;
        tbody.innerHTML += row;
      }
    }

    // 테이블에서 레인 선택
    function selectLane(laneNumber) {
      document.getElementById('laneSelector').value = laneNumber;
      calculateAll();
    }

    // 페이지 로드 시 초기 계산
    document.addEventListener('DOMContentLoaded', function() {
      calculateAll();
    });
  </script>
</body>
</html>