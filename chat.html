<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>ë¼ì´ë¸Œ ì±„íŒ… | ì• ìŠ¬ë¦¬íŠ¸ íƒ€ì„</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Malgun Gothic', sans-serif;
      -webkit-tap-highlight-color: transparent;
      overscroll-behavior-y: contain;
      background: #0a0a0a;
    }
    
    /* ë‹¤í¬ í…Œë§ˆ ìŠ¤í¬ë¡¤ë°” */
    ::-webkit-scrollbar {
      width: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
    }
    
    ::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    /* ë©”ì‹œì§€ ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    @keyframes fadeInUp {
      from {
        transform: translateY(10px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    /* ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
    .message-enter {
      animation: slideInRight 0.3s ease-out;
    }
    
    .message-item {
      padding: 8px 12px;
      margin: 4px 0;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.2s;
    }
    
    .message-item:hover {
      background: rgba(255, 255, 255, 0.08);
      transform: translateX(4px);
    }
    
    /* ìœ ì € ë ˆë²¨ ë°°ì§€ */
    .user-badge {
      display: inline-flex;
      align-items: center;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 600;
      margin-right: 4px;
    }
    
    .badge-vip {
      background: linear-gradient(135deg, #ffd700, #ffed4e);
      color: #000;
    }
    
    .badge-moderator {
      background: linear-gradient(135deg, #10b981, #34d399);
      color: #fff;
    }
    
    .badge-subscriber {
      background: linear-gradient(135deg, #8b5cf6, #a78bfa);
      color: #fff;
    }
    
    .badge-new {
      background: linear-gradient(135deg, #3b82f6, #60a5fa);
      color: #fff;
    }
    
    /* ì´ëª¨ì§€ ë¦¬ì•¡ì…˜ */
    .emoji-reaction {
      position: absolute;
      font-size: 24px;
      animation: floatUp 3s ease-out forwards;
      pointer-events: none;
    }
    
    @keyframes floatUp {
      0% {
        transform: translateY(0) scale(0);
        opacity: 1;
      }
      20% {
        transform: translateY(-20px) scale(1.2);
      }
      100% {
        transform: translateY(-200px) scale(0.8);
        opacity: 0;
      }
    }
    
    /* ìŠ¤íŠ¸ë¦¬ë¨¸ ë©”ì‹œì§€ í•˜ì´ë¼ì´íŠ¸ */
    .streamer-message {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(245, 158, 11, 0.2));
      border: 1px solid rgba(239, 68, 68, 0.5);
    }
    
    /* ë©˜ì…˜ í•˜ì´ë¼ì´íŠ¸ */
    .mention {
      color: #60a5fa;
      font-weight: 600;
      cursor: pointer;
    }
    
    .mention:hover {
      text-decoration: underline;
    }
    
    /* ì…ë ¥ì°½ ìŠ¤íƒ€ì¼ */
    .input-container {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .chat-input {
      background: transparent;
      color: white;
      resize: none;
      outline: none;
    }
    
    .chat-input::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }
    
    /* ì´ëª¨í‹°ì½˜ íŒ¨ë„ */
    .emoji-panel {
      background: rgba(20, 20, 20, 0.95);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .emoji-item {
      cursor: pointer;
      padding: 8px;
      transition: all 0.2s;
      border-radius: 8px;
    }
    
    .emoji-item:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: scale(1.2);
    }
    
    /* ìŠˆí¼ì±— ìŠ¤íƒ€ì¼ */
    .super-chat {
      background: linear-gradient(135deg, #ffd700, #ffed4e);
      color: #000;
      padding: 12px;
      margin: 8px 0;
      border-radius: 12px;
      border: 2px solid #ffd700;
      animation: pulse 2s infinite;
    }
    
    /* ì˜¨ë¼ì¸ ìœ ì € ì¹´ìš´í„° */
    .viewer-count {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid rgba(239, 68, 68, 0.5);
      border-radius: 20px;
    }
    
    .live-dot {
      width: 8px;
      height: 8px;
      background: #ef4444;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }
    
    /* ìƒˆ ë©”ì‹œì§€ ì•Œë¦¼ */
    .new-message-alert {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(59, 130, 246, 0.9);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      animation: bounce 1s infinite;
      z-index: 100;
    }
    
    /* ì±„íŒ… ì†ë„ ì œì–´ */
    .slow-mode-indicator {
      background: rgba(245, 158, 11, 0.2);
      border: 1px solid rgba(245, 158, 11, 0.5);
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 12px;
      color: #fbbf24;
    }
    
    /* ìœ ì € í”„ë¡œí•„ ì¹´ë“œ */
    .user-profile-card {
      position: absolute;
      background: rgba(20, 20, 20, 0.98);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 12px;
      z-index: 1000;
      min-width: 200px;
    }
    
    /* ì•¡ì…˜ ë²„íŠ¼ë“¤ */
    .action-button {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .action-button:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.1);
    }
    
    /* ëª¨ë°”ì¼ ìµœì í™” */
    @media (max-width: 640px) {
      .message-item {
        font-size: 14px;
      }
      
      .user-badge {
        font-size: 9px;
      }
    }
  </style>
</head>
<body>
  <div id="app" class="flex flex-col h-screen bg-black text-white">
    <!-- í—¤ë” -->
    <header class="bg-gradient-to-r from-purple-600 to-pink-600 p-3 shadow-xl">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <button onclick="history.back()" class="text-white">
            <i class="fas fa-arrow-left text-xl"></i>
          </button>
          <h1 class="text-lg font-bold">ë¼ì´ë¸Œ ì±„íŒ…</h1>
        </div>
        
        <!-- ì‹œì²­ì ìˆ˜ -->
        <div class="viewer-count">
          <div class="live-dot"></div>
          <span class="text-sm font-semibold" id="viewerCount">1,234</span>
          <i class="fas fa-users text-xs"></i>
        </div>
      </div>
    </header>

    <!-- ì±„íŒ… ì˜ì—­ -->
    <div class="flex-1 flex flex-col relative overflow-hidden">
      <!-- ì±„íŒ… ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆ -->
      <div id="chatContainer" class="flex-1 overflow-y-auto p-4 space-y-1">
        <!-- ì›°ì»´ ë©”ì‹œì§€ -->
        <div class="text-center py-8">
          <div class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600/20 to-pink-600/20 rounded-full border border-purple-500/30">
            <i class="fas fa-broadcast-tower text-purple-400"></i>
            <span class="text-sm text-gray-300">ì±„íŒ…ë°©ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</span>
          </div>
        </div>
        
        <!-- ì±„íŒ… ë©”ì‹œì§€ë“¤ì´ ì—¬ê¸°ì— ì¶”ê°€ë¨ -->
        <div id="messageList"></div>
      </div>
      
      <!-- ìƒˆ ë©”ì‹œì§€ ì•Œë¦¼ (ìˆ¨ê¹€ ìƒíƒœ) -->
      <div id="newMessageAlert" class="new-message-alert hidden">
        <i class="fas fa-arrow-down mr-2"></i>
        ìƒˆ ë©”ì‹œì§€
      </div>
      
      <!-- ì´ëª¨ì§€ ë¦¬ì•¡ì…˜ ì»¨í…Œì´ë„ˆ -->
      <div id="emojiReactionContainer" class="absolute inset-0 pointer-events-none"></div>
    </div>

    <!-- í•˜ë‹¨ ì…ë ¥ ì˜ì—­ -->
    <div class="input-container border-t p-3">
      <!-- ìŠ¬ë¡œìš° ëª¨ë“œ í‘œì‹œ -->
      <div id="slowModeIndicator" class="slow-mode-indicator mb-2 hidden">
        <i class="fas fa-clock mr-1"></i>
        ìŠ¬ë¡œìš° ëª¨ë“œ: <span id="slowModeTime">5</span>ì´ˆ ëŒ€ê¸°
      </div>
      
      <!-- ì…ë ¥ í•„ë“œ -->
      <div class="flex gap-2 items-end">
        <!-- ì´ëª¨í‹°ì½˜ ë²„íŠ¼ -->
        <button onclick="toggleEmojiPanel()" class="action-button">
          <i class="far fa-smile"></i>
        </button>
        
        <!-- í…ìŠ¤íŠ¸ ì…ë ¥ -->
        <div class="flex-1 relative">
          <textarea 
            id="messageInput"
            class="chat-input w-full px-3 py-2 rounded-lg"
            placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
            rows="1"
            maxlength="200"
            onkeydown="handleInputKeydown(event)"
            oninput="adjustTextareaHeight(this)"></textarea>
          
          <!-- ê¸€ì ìˆ˜ í‘œì‹œ -->
          <span class="absolute right-2 bottom-2 text-xs text-gray-500" id="charCount">0/200</span>
        </div>
        
        <!-- ì „ì†¡ ë²„íŠ¼ -->
        <button onclick="sendMessage()" class="action-button bg-gradient-to-r from-purple-600 to-pink-600">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
      
      <!-- ì´ëª¨í‹°ì½˜ íŒ¨ë„ -->
      <div id="emojiPanel" class="emoji-panel hidden absolute bottom-full mb-2 left-4 right-4 p-3 grid grid-cols-8 gap-1">
        <!-- ì´ëª¨í‹°ì½˜ë“¤ì´ ì—¬ê¸°ì— ì¶”ê°€ë¨ -->
      </div>
    </div>
    
    <!-- ìœ ì € í”„ë¡œí•„ ì¹´ë“œ (ìˆ¨ê¹€) -->
    <div id="userProfileCard" class="user-profile-card hidden">
      <!-- í”„ë¡œí•„ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë¨ -->
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

  <script>
    // Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyDKJGqP2E0qBMXZI4_4lXxcqtLLyWMNe9o",
      authDomain: "athlete-time-community.firebaseapp.com",
      projectId: "athlete-time-community",
      storageBucket: "athlete-time-community.appspot.com",
      messagingSenderId: "936784789813",
      appId: "1:936784789813:web:1234567890abcdef"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    
    // ì „ì—­ ë³€ìˆ˜
    let currentUser = null;
    let lastMessageTime = 0;
    let slowModeDelay = 0;
    let isAtBottom = true;
    let unsubscribe = null;
    
    // ì´ëª¨í‹°ì½˜ ëª©ë¡
    const emojis = ['ğŸ˜€', 'ğŸ˜‚', 'ğŸ¥°', 'ğŸ˜', 'ğŸ¤”', 'ğŸ‘', 'ğŸ‘', 'ğŸ’ª', 'ğŸ”¥', 'â¤ï¸', 'ğŸ‰', 'ğŸƒâ€â™‚ï¸', 'ğŸƒâ€â™€ï¸', 'âš¡', 'ğŸ’¯', 'ğŸš€', 'ğŸ˜­', 'ğŸ˜±', 'ğŸ¤£', 'ğŸ‘€'];
    const reactionEmojis = ['â¤ï¸', 'ğŸ‘', 'ğŸ˜‚', 'ğŸ˜®', 'ğŸ˜¢', 'ğŸ‘', 'ğŸ”¥'];
    
    // ìœ ì € ë°°ì§€ íƒ€ì…
    const userBadges = {
      vip: { icon: 'ğŸ‘‘', class: 'badge-vip', text: 'VIP' },
      moderator: { icon: 'ğŸ›¡ï¸', class: 'badge-moderator', text: 'MOD' },
      subscriber: { icon: 'â­', class: 'badge-subscriber', text: 'SUB' },
      new: { icon: 'ğŸŒŸ', class: 'badge-new', text: 'NEW' }
    };
    
    // ì´ˆê¸°í™”
    window.addEventListener('DOMContentLoaded', () => {
      initializeApp();
    });
    
    function initializeApp() {
      // ìµëª… ë¡œê·¸ì¸
      auth.signInAnonymously().then((result) => {
        currentUser = {
          uid: result.user.uid,
          name: generateRandomUsername(),
          badge: Math.random() > 0.7 ? 'new' : null,
          level: Math.floor(Math.random() * 50) + 1
        };
        
        // ì±„íŒ… êµ¬ë… ì‹œì‘
        subscribeToChat();
        
        // ì´ëª¨í‹°ì½˜ íŒ¨ë„ ì´ˆê¸°í™”
        initializeEmojiPanel();
        
        // ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        setupScrollListener();
        
        // ì˜¨ë¼ì¸ ì¹´ìš´í„° ì‹œì‘
        startViewerCounter();
      });
    }
    
    // ëœë¤ ìœ ì €ë„¤ì„ ìƒì„±
    function generateRandomUsername() {
      const adjectives = ['ë¹ ë¥¸', 'ê°•í•œ', 'ë¯¼ì²©í•œ', 'ì—´ì •ì ì¸', 'ìµœê³ ì˜', 'í”„ë¡œ'];
      const nouns = ['ëŸ¬ë„ˆ', 'ìŠ¤í”„ë¦°í„°', 'ë§ˆë¼í† ë„ˆ', 'ì„ ìˆ˜', 'ì±”í”¼ì–¸', 'ì—ì´ìŠ¤'];
      return adjectives[Math.floor(Math.random() * adjectives.length)] + 
             nouns[Math.floor(Math.random() * nouns.length)] +
             Math.floor(Math.random() * 999);
    }
    
    // ì±„íŒ… êµ¬ë…
    function subscribeToChat() {
      const chatRef = db.collection('liveChat')
        .orderBy('timestamp', 'desc')
        .limit(100);
      
      unsubscribe = chatRef.onSnapshot((snapshot) => {
        snapshot.docChanges().forEach((change) => {
          if (change.type === 'added') {
            const message = change.doc.data();
            displayMessage(message);
          }
        });
        
        if (isAtBottom) {
          scrollToBottom();
        } else {
          showNewMessageAlert();
        }
      });
    }
    
    // ë©”ì‹œì§€ í‘œì‹œ
    function displayMessage(message) {
      const messageList = document.getElementById('messageList');
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message-item message-enter';
      
      // ìŠ¤íŠ¸ë¦¬ë¨¸ ë©”ì‹œì§€ í™•ì¸
      if (message.isStreamer) {
        messageDiv.classList.add('streamer-message');
      }
      
      // ìŠˆí¼ì±— í™•ì¸
      if (message.superChat) {
        messageDiv.className = 'super-chat message-enter';
      }
      
      // ë°°ì§€ HTML
      let badgeHTML = '';
      if (message.badge && userBadges[message.badge]) {
        const badge = userBadges[message.badge];
        badgeHTML = `<span class="user-badge ${badge.class}">${badge.icon} ${badge.text}</span>`;
      }
      
      // ë ˆë²¨ í‘œì‹œ
      const levelColor = message.level > 30 ? 'text-yellow-400' : 
                        message.level > 10 ? 'text-blue-400' : 
                        'text-gray-400';
      
      // ë©˜ì…˜ ì²˜ë¦¬
      let processedMessage = escapeHtml(message.text);
      processedMessage = processedMessage.replace(/@(\w+)/g, '<span class="mention">@$1</span>');
      
      messageDiv.innerHTML = `
        <div class="flex items-start gap-2">
          <div class="flex-shrink-0">
            <span class="${levelColor} text-xs font-bold">Lv.${message.level || 1}</span>
          </div>
          <div class="flex-1">
            <div class="flex items-center gap-1 mb-1">
              ${badgeHTML}
              <span class="font-semibold text-sm ${message.isStreamer ? 'text-red-400' : 'text-gray-300'}">${escapeHtml(message.username)}</span>
              <span class="text-xs text-gray-500">${formatTime(message.timestamp)}</span>
            </div>
            <div class="text-gray-100">${processedMessage}</div>
            ${message.superChat ? `<div class="text-xs mt-1 font-bold">ğŸ’° ${message.superChat}ì›</div>` : ''}
          </div>
        </div>
      `;
      
      // í´ë¦­ ì´ë²¤íŠ¸ (ìœ ì € í”„ë¡œí•„)
      messageDiv.addEventListener('click', (e) => {
        if (e.target.classList.contains('mention')) {
          const username = e.target.textContent.substring(1);
          showUserProfile(username, e.clientX, e.clientY);
        }
      });
      
      messageList.appendChild(messageDiv);
      
      // ì˜¤ë˜ëœ ë©”ì‹œì§€ ì œê±°
      while (messageList.children.length > 100) {
        messageList.removeChild(messageList.firstChild);
      }
      
      // ì´ëª¨ì§€ ë¦¬ì•¡ì…˜ íŠ¸ë¦¬ê±°
      if (message.text.includes('â¤ï¸') || message.text.includes('ğŸ”¥')) {
        triggerEmojiReaction(message.text.includes('â¤ï¸') ? 'â¤ï¸' : 'ğŸ”¥');
      }
    }
    
    // ë©”ì‹œì§€ ì „ì†¡
    function sendMessage() {
      const input = document.getElementById('messageInput');
      const text = input.value.trim();
      
      if (!text) return;
      
      // ìŠ¬ë¡œìš° ëª¨ë“œ ì²´í¬
      const now = Date.now();
      if (slowModeDelay > 0 && now - lastMessageTime < slowModeDelay * 1000) {
        showSlowModeWarning();
        return;
      }
      
      // ë©”ì‹œì§€ ì „ì†¡
      db.collection('liveChat').add({
        username: currentUser.name,
        text: text,
        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
        userId: currentUser.uid,
        badge: currentUser.badge,
        level: currentUser.level,
        isStreamer: false,
        superChat: null
      });
      
      input.value = '';
      adjustTextareaHeight(input);
      updateCharCount();
      lastMessageTime = now;
      
      // ì „ì†¡ ì• ë‹ˆë©”ì´ì…˜
      animateSendButton();
    }
    
    // ì´ëª¨í‹°ì½˜ íŒ¨ë„
    function initializeEmojiPanel() {
      const panel = document.getElementById('emojiPanel');
      emojis.forEach(emoji => {
        const emojiDiv = document.createElement('div');
        emojiDiv.className = 'emoji-item text-2xl text-center';
        emojiDiv.textContent = emoji;
        emojiDiv.onclick = () => insertEmoji(emoji);
        panel.appendChild(emojiDiv);
      });
    }
    
    function toggleEmojiPanel() {
      const panel = document.getElementById('emojiPanel');
      panel.classList.toggle('hidden');
    }
    
    function insertEmoji(emoji) {
      const input = document.getElementById('messageInput');
      input.value += emoji;
      updateCharCount();
      toggleEmojiPanel();
      input.focus();
    }
    
    // ì´ëª¨ì§€ ë¦¬ì•¡ì…˜
    function triggerEmojiReaction(emoji) {
      const container = document.getElementById('emojiReactionContainer');
      const reaction = document.createElement('div');
      reaction.className = 'emoji-reaction';
      reaction.textContent = emoji;
      reaction.style.left = Math.random() * 80 + 10 + '%';
      reaction.style.bottom = '100px';
      
      container.appendChild(reaction);
      
      setTimeout(() => {
        container.removeChild(reaction);
      }, 3000);
    }
    
    // ìŠ¤í¬ë¡¤ ê´€ë ¨
    function setupScrollListener() {
      const container = document.getElementById('chatContainer');
      container.addEventListener('scroll', () => {
        const threshold = 100;
        isAtBottom = container.scrollHeight - container.scrollTop - container.clientHeight < threshold;
        
        if (isAtBottom) {
          hideNewMessageAlert();
        }
      });
    }
    
    function scrollToBottom() {
      const container = document.getElementById('chatContainer');
      container.scrollTop = container.scrollHeight;
    }
    
    function showNewMessageAlert() {
      if (!isAtBottom) {
        document.getElementById('newMessageAlert').classList.remove('hidden');
      }
    }
    
    function hideNewMessageAlert() {
      document.getElementById('newMessageAlert').classList.add('hidden');
    }
    
    // ìƒˆ ë©”ì‹œì§€ ì•Œë¦¼ í´ë¦­
    document.getElementById('newMessageAlert')?.addEventListener('click', () => {
      scrollToBottom();
      hideNewMessageAlert();
    });
    
    // ì‹œì²­ì ì¹´ìš´í„°
    function startViewerCounter() {
      updateViewerCount();
      setInterval(updateViewerCount, 5000);
    }
    
    function updateViewerCount() {
      const base = 1000;
      const variation = Math.floor(Math.random() * 500);
      const count = base + variation;
      document.getElementById('viewerCount').textContent = count.toLocaleString();
    }
    
    // ìŠ¬ë¡œìš° ëª¨ë“œ
    function showSlowModeWarning() {
      const indicator = document.getElementById('slowModeIndicator');
      indicator.classList.remove('hidden');
      
      let timeLeft = slowModeDelay;
      const interval = setInterval(() => {
        timeLeft--;
        document.getElementById('slowModeTime').textContent = timeLeft;
        
        if (timeLeft <= 0) {
          clearInterval(interval);
          indicator.classList.add('hidden');
        }
      }, 1000);
    }
    
    // ìœ ì € í”„ë¡œí•„
    function showUserProfile(username, x, y) {
      const card = document.getElementById('userProfileCard');
      card.innerHTML = `
        <div class="flex items-center gap-3 mb-2">
          <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center">
            <span class="text-white font-bold">${username[0].toUpperCase()}</span>
          </div>
          <div>
            <div class="font-bold">${username}</div>
            <div class="text-xs text-gray-400">ë ˆë²¨ ${Math.floor(Math.random() * 50) + 1}</div>
          </div>
        </div>
        <div class="flex gap-2">
          <button class="px-3 py-1 bg-purple-600 rounded-full text-xs">íŒ”ë¡œìš°</button>
          <button class="px-3 py-1 bg-gray-700 rounded-full text-xs">ì°¨ë‹¨</button>
        </div>
      `;
      
      card.style.left = Math.min(x, window.innerWidth - 220) + 'px';
      card.style.top = Math.min(y, window.innerHeight - 150) + 'px';
      card.classList.remove('hidden');
      
      setTimeout(() => {
        card.classList.add('hidden');
      }, 3000);
    }
    
    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
    function handleInputKeydown(event) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
      }
    }
    
    function adjustTextareaHeight(textarea) {
      textarea.style.height = 'auto';
      textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
    }
    
    function updateCharCount() {
      const input = document.getElementById('messageInput');
      const count = input.value.length;
      document.getElementById('charCount').textContent = `${count}/200`;
    }
    
    function animateSendButton() {
      const button = document.querySelector('.action-button.bg-gradient-to-r');
      button.style.transform = 'scale(0.9)';
      setTimeout(() => {
        button.style.transform = 'scale(1)';
      }, 100);
    }
    
    function formatTime(timestamp) {
      if (!timestamp) return '';
      const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
      return date.toLocaleTimeString('ko-KR', { 
        hour: '2-digit', 
        minute: '2-digit' 
      });
    }
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // ì…ë ¥ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    document.getElementById('messageInput')?.addEventListener('input', updateCharCount);
    
    // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì •ë¦¬
    window.addEventListener('beforeunload', () => {
      if (unsubscribe) {
        unsubscribe();
      }
    });
    
    // í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ìƒì„± (ê°œë°œìš©)
    function generateTestMessages() {
      const testMessages = [
        { username: 'ë¹ ë¥¸ëŸ¬ë„ˆ123', text: 'ì™€ ëŒ€ë°•ì´ë‹¤ ã…‹ã…‹ã…‹', badge: 'vip', level: 45 },
        { username: 'í”„ë¡œë§ˆë¼í† ë„ˆ', text: 'ì˜¤ëŠ˜ ê¸°ë¡ ì§„ì§œ ì¢‹ë„¤ìš”! ğŸ”¥', badge: 'subscriber', level: 23 },
        { username: 'ìŠ¤íŠ¸ë¦¬ë¨¸', text: 'ì—¬ëŸ¬ë¶„ ê°ì‚¬í•©ë‹ˆë‹¤! â¤ï¸', isStreamer: true, level: 99 },
        { username: 'ì—´ì •ëŸ¬ë„ˆ', text: 'ì €ë„ í•œë²ˆ ë„ì „í•´ë³´ê³  ì‹¶ì–´ìš”!', badge: 'new', level: 5 },
        { username: 'ìµœê³ ì˜ì„ ìˆ˜', text: '@í”„ë¡œë§ˆë¼í† ë„ˆ ë‹˜ ëŒ€ë‹¨í•˜ì‹œë„¤ìš” ğŸ‘', badge: null, level: 15 },
        { username: 'VIPí›„ì›ì', text: 'ì‘ì›í•©ë‹ˆë‹¤! í™”ì´íŒ…!', superChat: 10000, badge: 'vip', level: 50 }
      ];
      
      testMessages.forEach((msg, index) => {
        setTimeout(() => {
          displayMessage({
            ...msg,
            timestamp: new Date(),
            userId: 'test' + index
          });
        }, index * 1000);
      });
    }
    
    // ê°œë°œ ëª¨ë“œì—ì„œ í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ í™œì„±í™”
    if (window.location.hostname === 'localhost') {
      setTimeout(generateTestMessages, 2000);
    }
  </script>
</body>
</html>